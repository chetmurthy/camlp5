

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Language Extensions &mdash; Camlp5 7.10 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Camlp5 7.10 documentation" href="index.html"/>
        <link rel="next" title="Appendix" href="appendix.html"/>
        <link rel="prev" title="Printing tools" href="prtools.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Camlp5
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="strict.html">Transitional and Strict modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="pptools.html">Parsing and Printing tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="patools.html">Parsing tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="prtools.html">Printing tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Language Extensions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#locations">Locations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#definitions">Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-locations">Building locations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#raising-with-a-location">Raising with a location</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-functions">Other functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ml-syntax-tree">ML Syntax tree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transitional-and-strict-modes">Transitional and Strict modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compatibility">Compatibility</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-quotations-expanders">Two quotations expanders</a></li>
<li class="toctree-l3"><a class="reference internal" href="#syntax-tree-and-quotations-in-the-two-modes">Syntax tree and Quotations in the two modes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ml-syntax-tree-transitional-mode">ML Syntax tree - transitional mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#location">Location</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#in-expressions">In expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-patterns">In patterns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#antiquotations">Antiquotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nodes-and-quotations">Nodes and Quotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#expr">expr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#patt">patt</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ctyp">ctyp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#modules">modules…</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#str-item">str_item</a></li>
<li class="toctree-l5"><a class="reference internal" href="#sig-item">sig_item</a></li>
<li class="toctree-l5"><a class="reference internal" href="#module-expr">module_expr</a></li>
<li class="toctree-l5"><a class="reference internal" href="#module-type">module_type</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#classes">classes…</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#class-expr">class_expr</a></li>
<li class="toctree-l5"><a class="reference internal" href="#class-type">class_type</a></li>
<li class="toctree-l5"><a class="reference internal" href="#class-str-item">class_str_item</a></li>
<li class="toctree-l5"><a class="reference internal" href="#class-sig-item">class_sig_item</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#other">other</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#type-decl">type_decl</a></li>
<li class="toctree-l5"><a class="reference internal" href="#with-constr">with_constr</a></li>
<li class="toctree-l5"><a class="reference internal" href="#poly-variant">poly_variant</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ml-syntax-tree-strict-mode">ML Syntax tree - strict mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Location</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">In expressions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id5">In patterns</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Antiquotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#two-kinds-of-antiquotations">Two kinds of antiquotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preliminary-remark">Preliminary remark</a></li>
<li class="toctree-l4"><a class="reference internal" href="#antiquoting">Antiquoting</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#direct-antiquoting">direct antiquoting</a></li>
<li class="toctree-l5"><a class="reference internal" href="#general-antiquoting">general antiquoting</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#remarks">Remarks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Nodes and Quotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id8">expr</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">patt</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">ctyp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id11">modules…</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id12">str_item</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id13">sig_item</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id14">module_expr</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id15">module_type</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id16">classes…</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id17">class_expr</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id18">class_type</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id19">class_str_item</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id20">class_sig_item</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id21">other</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id22">type_decl</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id23">with_constr</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id24">poly_variant</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#nodes-without-quotations">Nodes without quotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#type-var">type_var</a></li>
<li class="toctree-l4"><a class="reference internal" href="#class-infos">class_infos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#syntax-tree-quotations-in-user-syntax">Syntax tree quotations in user syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id25">Antiquotations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-pcaml-module">The Pcaml module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#language-parsing">Language parsing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#main-parsing-functions">Main parsing functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#grammar">Grammar</a></li>
<li class="toctree-l4"><a class="reference internal" href="#entries">Entries</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#language-printing">Language printing</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#main-printing-functions">Main printing functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#printers">Printers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#quotation-management">Quotation management</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extensible-directives-and-options">Extensible directives and options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#equalities-over-syntax-trees">Equalities over syntax trees</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generalities">Generalities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#directives">Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#predefined-directives">Predefined directives</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#load-name"><code class="docutils literal"><span class="pre">#load</span> <span class="pre">&quot;name&quot;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#directory-name"><code class="docutils literal"><span class="pre">#directory</span> <span class="pre">&quot;name&quot;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-name"><code class="docutils literal"><span class="pre">#use</span> <span class="pre">&quot;name&quot;</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-option"><code class="docutils literal"><span class="pre">#option</span> <span class="pre">&quot;option&quot;</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#user-directives">User directives</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extensions-of-syntax">Extensions of syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id27">Entries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#syntax-tree-quotations">Syntax tree quotations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#an-example-repeat-until">An example : repeat..until</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-code">The code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compilation">Compilation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing">Testing</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#in-the-ocaml-toplevel">In the OCaml toplevel</a></li>
<li class="toctree-l5"><a class="reference internal" href="#in-a-file">In a file</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extensions-of-printing">Extensions of printing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id28">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#principles">Principles</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-module-pretty">Using module Pretty</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-extend-printer-statement">Using EXTEND_PRINTER statement</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dangling-else-bar-semicolon">Dangling else, bar, semicolon</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-level">By level</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#the-prtools-module">The Prtools module</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#comments">Comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="#meta-functions-for-lists">Meta functions for lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#example-repeat-until">Example : repeat..until</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id29">The code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id30">Compilation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">Testing</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#redefining-ocaml-syntax">Redefining OCaml syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#starting-with-an-example">Starting with an example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#a-file-for-an-ocaml-syntax">A file for an OCaml syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quotations">Quotations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id32">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quotation-expander">Quotation expander</a></li>
<li class="toctree-l3"><a class="reference internal" href="#defining-a-quotation">Defining a quotation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#by-syntax-tree">By syntax tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="#by-string">By string</a></li>
<li class="toctree-l4"><a class="reference internal" href="#default-quotation">Default quotation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id33">Antiquotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-without-antiquotation-node">Example without antiquotation node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-with-antiquotation-node">Example with antiquotation node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-conclusion">In conclusion</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#locations-in-quotations-and-antiquotations">Locations in quotations and antiquotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#in-the-quotation">In the quotation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#in-antiquotations">In antiquotations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#located-errors">Located errors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-quotation-module">The Quotation module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#predefined-quotations">Predefined quotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#q-mlast-cmo">q_MLast.cmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q-ast-cmo">q_ast.cmo</a></li>
<li class="toctree-l4"><a class="reference internal" href="#q-phony-cmo">q_phony.cmo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#a-full-example-lambda-terms">A full example: lambda terms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lexer">Lexer</a></li>
<li class="toctree-l4"><a class="reference internal" href="#parser">Parser</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compilation-and-test">Compilation and test</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#the-revised-syntax">The revised syntax</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lexing">Lexing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modules-structure-and-signature-items">Modules, Structure and Signature items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#expressions-and-patterns">Expressions and Patterns</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#imperative-constructions">Imperative constructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tuples-and-lists">Tuples and Lists</a></li>
<li class="toctree-l4"><a class="reference internal" href="#records">Records</a></li>
<li class="toctree-l4"><a class="reference internal" href="#irrefutable-patterns">Irrefutable patterns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#constructions-with-matching">Constructions with matching</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mutables-and-assignment">Mutables and Assignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id34">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#types-and-constructors">Types and Constructors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#streams-and-parsers">Streams and Parsers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#classes-and-objects">Classes and Objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="#labels-and-variants">Labels and Variants</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scheme-and-lisp-syntaxes">Scheme and Lisp syntaxes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#common">Common</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scheme-syntax">Scheme syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lisp-syntax">Lisp syntax</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#macros">Macros</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#added-syntax">Added syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#added-command-options">Added command options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#semantics">Semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#predefined-macros">Predefined macros</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pragma-directive">Pragma directive</a></li>
<li class="toctree-l2"><a class="reference internal" href="#extensible-functions">Extensible functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id40">Semantics</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Camlp5</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Language Extensions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/langext.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="language-extensions">
<h1>Language Extensions<a class="headerlink" href="#language-extensions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="locations">
<span id="id1"></span><h2>Locations<a class="headerlink" href="#locations" title="Permalink to this headline">¶</a></h2>
<p>The location is a concept often used in Camlp5, bound to where errors
occur in the source. The basic type is <code class="docutils literal"><span class="pre">Ploc.t</span></code> which is an
abstract type.</p>
<div class="section" id="definitions">
<h3>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h3>
<p>Internally a location is a pair of source &lt;em&gt;positions&lt;/em&gt;: the
beginning and the end of an element in the source (file or
interactive).  A located element can be a character (the end is just
the beginning plus one), a token, or a longer sequence generally
corresponding to a grammar rule.</p>
<p>A <em>position</em> is a count of characters since the beginning of
the file, starting at zero. When a couple of positions define a
location, the first position is the position of the first character of
the element, and the last position is the first character &lt;em&gt;not&lt;/em&gt;
part of the element. The location length is the difference between
those two numbers. Notice that the position corresponds exactly to the
character count in the streams of characters.</p>
<p>In <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">Extensible grammars</span></a>, a variable with the specific name <code class="docutils literal"><span class="pre">loc</span></code> is
predefined in all semantic actions: it is the location of the
associated rule. Since the <a class="reference internal" href="#ml-ast"><span class="std std-ref">ML Syntax tree</span></a> generate nodes with <code class="docutils literal"><span class="pre">loc</span></code>
as location part, this allow to generate grammars without having to
consider source locations</p>
<p>It is possible to change the name <code class="docutils literal"><span class="pre">loc</span></code> to another name, through the
parameter <code class="docutils literal"><span class="pre">-loc</span></code> of the Camlp5 commands.</p>
<p>Remark: the reason why the type <code class="docutils literal"><span class="pre">location</span></code> is abstract is that in
future versions, it may contain other informations, such as the
associated comments, the type (for expressions nodes), things like
that, without having to change the already written programs.</p>
</div>
<div class="section" id="building-locations">
<h3>Building locations<a class="headerlink" href="#building-locations" title="Permalink to this headline">¶</a></h3>
<p>Tools are provided in the module <code class="docutils literal"><span class="pre">Ploc</span></code> to manage locations.</p>
<p>First, <code class="docutils literal"><span class="pre">Ploc.dummy</span></code> is a dummy location used when the element does
not correspond to any source, or if the programmer does not want to
worry about locations.</p>
<p>The function <code class="docutils literal"><span class="pre">Ploc.make</span></code> builds a location from three
parameters:</p>
<ul class="simple">
<li>the line number, starting at 1</li>
<li>the position of the first column of the line</li>
<li>a couple of positions of the location: the first one belonging to
the given line, the second one being able to belong to another line,
further.</li>
</ul>
<p>If the line number is not known, it is possible to use the function
<code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code> taking only the couple of positions of the
location. In this case, error messages may indicate the first line and
a big count of characters from this line (actually from the beginning
of the file). With a good text editor, it is possible, to find the
good location, anyway.</p>
<p>If the location is built with <code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>, and if your
program displays a source location itself, it is possible to use the
function <code class="docutils literal"><span class="pre">Ploc.from_file</span></code> which takes the file name and the location
as parameters and return, by reading that file, the line number, and
the character positions of the location.</p>
</div>
<div class="section" id="raising-with-a-location">
<h3>Raising with a location<a class="headerlink" href="#raising-with-a-location" title="Permalink to this headline">¶</a></h3>
<p>The function <code class="docutils literal"><span class="pre">Ploc.raise</span></code> allows one to raise an exception together
with a location. All exceptions raised in the <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">Extensible grammars</span></a>
extensible grammars&lt;/a&gt; use <code class="docutils literal"><span class="pre">Ploc.raise</span></code>. The raised exception is
<code class="docutils literal"><span class="pre">Ploc.Exc</span></code> with two parameters: the location and the exception
itself.</p>
<p>Notice that <code class="docutils literal"><span class="pre">Ploc.raise</span></code> just reraises the exception if it is
already the exception <code class="docutils literal"><span class="pre">Ploc.Exc</span></code>, ignoring then the new given
location.</p>
<p>A paradigm to print exceptions possibly enclosed by <code class="docutils literal"><span class="pre">Ploc.Exc</span></code> is to
write the <code class="docutils literal"><span class="pre">try..with</span></code> statement like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="o">...</span> <span class="k">with</span> <span class="n">exn</span> <span class="o">-&gt;</span>
  <span class="n">let</span> <span class="n">exn</span> <span class="o">=</span>
    <span class="n">match</span> <span class="n">exn</span> <span class="k">with</span>
    <span class="p">[</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">Exc</span> <span class="n">loc</span> <span class="n">exn</span> <span class="o">-&gt;</span> <span class="n">do</span> <span class="p">{</span> <span class="o">...</span> <span class="nb">print</span> <span class="n">the</span> <span class="n">location</span> <span class="o">...</span><span class="p">;</span> <span class="n">exn</span> <span class="p">}</span>
    <span class="o">|</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="n">exn</span> <span class="p">]</span>
  <span class="ow">in</span>
  <span class="n">match</span> <span class="n">exn</span> <span class="k">with</span>
  <span class="o">...</span><span class="n">print</span> <span class="n">the</span> <span class="n">exception</span> <span class="n">which</span> <span class="ow">is</span> <span class="o">*</span><span class="ow">not</span><span class="o">*</span> <span class="n">located</span><span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="other-functions">
<h3>Other functions<a class="headerlink" href="#other-functions" title="Permalink to this headline">¶</a></h3>
<p>Some other functions are provided:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Ploc.first_pos</span></code>: returns the first position (an integer) of the
location.</li>
<li><code class="docutils literal"><span class="pre">Ploc.last_pos</span></code>: returns the last position (an integer) of the
location (position of the first character not belonging to the
element.</li>
<li><code class="docutils literal"><span class="pre">Ploc.line_nb</span></code>: returns the line number of the location or <code class="docutils literal"><span class="pre">-1</span></code>
if the location does not contain a line number (i.e. built by
<code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>).</li>
<li><code class="docutils literal"><span class="pre">Ploc.bol_pos</span></code>: returns the position of the beginning of the line
of the location. It is zero if the location does not contain a line
number (i.e. built by <code class="docutils literal"><span class="pre">Ploc.make_unlined</span></code>).</li>
</ul>
<p>And still other ones used in Camlp5 sources:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Ploc.encl</span></code>: <code class="docutils literal"><span class="pre">Ploc.encl</span> <span class="pre">loc1</span> <span class="pre">loc2</span></code> returns the location starting
at the smallest begin of <code class="docutils literal"><span class="pre">loc1</span></code> and <code class="docutils literal"><span class="pre">loc2</span></code> and ending at their
greatest end.. In simple words, it is the location enclosing
<code class="docutils literal"><span class="pre">loc1</span></code> and <code class="docutils literal"><span class="pre">loc2</span></code> and all what is between them.</li>
<li><code class="docutils literal"><span class="pre">Ploc.shift</span></code>: <code class="docutils literal"><span class="pre">Ploc.shift</span> <span class="pre">sh</span> <span class="pre">loc</span></code> returns the location <code class="docutils literal"><span class="pre">loc</span></code>
shifted with <code class="docutils literal"><span class="pre">sh</span></code> characters. The line number is not recomputed.</li>
<li><code class="docutils literal"><span class="pre">Ploc.sub</span></code>: <code class="docutils literal"><span class="pre">Ploc.sub</span> <span class="pre">loc</span> <span class="pre">sh</span> <span class="pre">len</span></code> is the location <code class="docutils literal"><span class="pre">loc</span></code>
shifted with <code class="docutils literal"><span class="pre">sh</span></code> characters and with length <code class="docutils literal"><span class="pre">len</span></code>. The previous
ending position of the location is lost.</li>
<li><code class="docutils literal"><span class="pre">Ploc.after</span></code>: <code class="docutils literal"><span class="pre">Ploc.after</span> <span class="pre">loc</span> <span class="pre">sh</span> <span class="pre">len</span></code> is the location just after
<code class="docutils literal"><span class="pre">loc</span></code> (i.e. starting at the end position of <code class="docutils literal"><span class="pre">loc</span></code>), shifted with
<code class="docutils literal"><span class="pre">sh</span></code> characters, and of length <code class="docutils literal"><span class="pre">len</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="ml-syntax-tree">
<span id="ml-ast"></span><h2>ML Syntax tree<a class="headerlink" href="#ml-syntax-tree" title="Permalink to this headline">¶</a></h2>
<p>In Camlp5, one often uses syntax trees. For example, in grammars of
the language (semantic actions), in pretty printing (as patterns), in
optimizing syntax code (typically stream parsers). Syntax trees are
mainly defined by sum types, one for each kind of tree: <code class="docutils literal"><span class="pre">expr</span></code> for
expressions, <code class="docutils literal"><span class="pre">patt</span></code> for patterns, <code class="docutils literal"><span class="pre">ctyp</span></code> for types, <code class="docutils literal"><span class="pre">str_item</span></code>
for structure items, and so on. Each node corresponds to a possible
value of this type.</p>
<div class="section" id="transitional-and-strict-modes">
<h3>Transitional and Strict modes<a class="headerlink" href="#transitional-and-strict-modes" title="Permalink to this headline">¶</a></h3>
<p>Since version 5.00 of Camlp5, the definition of the syntax tree has
been different according to the mode Camlp5 has been installed:</p>
<ul class="simple">
<li>In <a class="reference internal" href="#ast-transi"><span class="std std-ref">ML Syntax tree - transitional mode</span></a> mode, this definition is the same than in the
previous Camlp5 versions.</li>
<li>In <a class="reference internal" href="#ast-strict"><span class="std std-ref">ML Syntax tree - strict mode</span></a> mode, many constructor parameters have a type
enclosed by the predefined type <code class="docutils literal"><span class="pre">Ploc.vala</span></code>.</li>
</ul>
<p>The advantage of the transitional mode is that the abstract syntax
tree is fully compatible with previous versions of Camlp5. Its
drawback is that when using the <a class="reference internal" href="#q-ast"><span class="std std-ref">Syntax tree quotations in user syntax</span></a>, it is not possible to
use antiquotations, a significatant limitation.</p>
<p>In strict mode, the abstract syntax is not compatible with versions of
Camlp5 previous to 5.00. Most of the parameters of the constructor are
enclosed with the type <code class="docutils literal"><span class="pre">Ploc.vala</span></code> whose aim is to allow nodes to be
either of the type argument, or an antiquotation. In this mode, the
syntax tree quotations in user syntax can be used, with the same power
of the previous syntax tree quotations provided by Camlp5.</p>
</div>
<div class="section" id="compatibility">
<h3>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h3>
<p>As there is a problem of compatibility in strict mode, a good
solution, for the programmer, is to always use syntax trees using
quotations, which is backward compatible. See the chapter about
<a class="reference internal" href="#ast-strict"><span class="std std-ref">ML Syntax tree - strict mode</span></a>.</p>
<p>For example, if the program made a value of the syntax tree of the
“let” statement, like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ExLet</span> <span class="n">loc</span> <span class="n">rf</span> <span class="n">pel</span> <span class="n">e</span>
</pre></div>
</div>
<p>In strict mode, to be equivalent, this expression should be rewritten
like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ExLet</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="n">rf</span><span class="p">)</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="n">pel</span><span class="p">)</span> <span class="n">e</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">Ploc.VaVal</span></code> is a value of the type <code class="docutils literal"><span class="pre">vala</span></code> defined in the
module <a class="reference internal" href="appendix.html#library"><span class="std std-ref">Ploc</span></a> (see its section <code class="docutils literal"><span class="pre">pervasives</span></code>).</p>
<p>This necessary conversion is a drawback if the programmer wants that
his programs remain compilable with previous versions of Camlp5.</p>
<p>The recommended solution is to always write this code with quotations,
namely, in this example, like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; let $flag:rf$ $list:pel$ in $e$ &gt;&gt;
</pre></div>
</div>
<p>The quotation expanders ensure that, in strict mode, the variable <code class="docutils literal"><span class="pre">rf</span></code>
is still of type <code class="docutils literal"><span class="pre">bool</span></code>, and that the variable <code class="docutils literal"><span class="pre">pel</span></code> of type <code class="docutils literal"><span class="pre">list</span>
<span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">expr)</span></code>, by enclosing them around <code class="docutils literal"><span class="pre">Ploc.VaVal</span></code>.</p>
<p>In transitional mode, it is equivalent to the first form above.  In
strict mode, it is equivalent to the second form. And the previous
versions of Camlp5 also recognizes this form.</p>
</div>
<div class="section" id="two-quotations-expanders">
<h3>Two quotations expanders<a class="headerlink" href="#two-quotations-expanders" title="Permalink to this headline">¶</a></h3>
<p>Camlp5 provides two quotations expanders of syntax trees:
<code class="docutils literal"><span class="pre">q_MLast.cmo</span></code> and <code class="docutils literal"><span class="pre">q_ast.cmo</span></code>.</p>
<p>Both allow writing syntax trees in concrete syntax as explained in the
previous section.</p>
<p>The first one, <code class="docutils literal"><span class="pre">q_MLast.cmo</span></code> requires that the contents of the
quotation be in <a class="reference internal" href="#revsynt"><span class="std std-ref">The revised syntax</span></a> without any syntax extension (even the
<a class="reference internal" href="patools.html#parsers"><span class="std std-ref">Stream parsers</span></a>). It works in transitional and in strict modes.</p>
<p>The second one, <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> requires that the contents of the
quotation be in the current user syntax (normal, revised, lisp,
scheme, or other) and can accept all the syntax extensions he added to
compile his program. It fully works only in strict mode. In
transitional mode, the antiquotations are not available.</p>
</div>
<div class="section" id="syntax-tree-and-quotations-in-the-two-modes">
<h3>Syntax tree and Quotations in the two modes<a class="headerlink" href="#syntax-tree-and-quotations-in-the-two-modes" title="Permalink to this headline">¶</a></h3>
<p>For the detail of the syntax tree and the quotations forms, see the
chapters about the <a class="reference internal" href="#ast-transi"><span class="std std-ref">ML Syntax tree - transitional mode</span></a> and the <a class="reference internal" href="#ast-strict"><span class="std std-ref">ML Syntax tree - strict mode</span></a>.</p>
</div>
</div>
<div class="section" id="ml-syntax-tree-transitional-mode">
<span id="ast-transi"></span><h2>ML Syntax tree - transitional mode<a class="headerlink" href="#ml-syntax-tree-transitional-mode" title="Permalink to this headline">¶</a></h2>
<p>This chapter presents the Camlp5 syntax tree when Camlp5 is installed
in <em>transitional</em> mode.</p>
<div class="section" id="introduction">
<h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>This syntax tree is defined in the module <code class="docutils literal"><span class="pre">MLast</span></code> provided
by Camlp5. Each node corresponds to a syntactic entity of the
corresponding type.</p>
<p>For example, the syntax tree of the statement <code class="docutils literal"><span class="pre">if</span></code> can
be written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExIfe</span> <span class="n">loc</span> <span class="n">e1</span> <span class="n">e2</span> <span class="n">e3</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">loc</span></code> is the location in the source, and
<code class="docutils literal"><span class="pre">e1</span></code>, <code class="docutils literal"><span class="pre">e2</span></code> and <code class="docutils literal"><span class="pre">e3</span></code> are
respectively the expression after the <code class="docutils literal"><span class="pre">if</span></code>, the one after
the <code class="docutils literal"><span class="pre">then</span></code> and the one after the <code class="docutils literal"><span class="pre">else</span></code>.</p>
<p>If a program needs to manipulate syntax trees, it can use the nodes
defined in the module <code class="docutils literal"><span class="pre">MLast</span></code>. The programmer must know how
the concrete syntax is transformed into this abstract syntax.</p>
<p>A simpler solution is to use one of the quotation kit
<code class="docutils literal"><span class="pre">q_MLast.cmo</span></code>. It proposes <a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a> which
represent the abstract syntax (the nodes of the module <code class="docutils literal"><span class="pre">MLast</span></code>) into
concrete syntax with antiquotations to bind variables inside. The
example above can be written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; if $e1$ then $e2$ else $e3$ &gt;&gt;
</pre></div>
</div>
<p>This representation is very interesting when one wants to
manipulate complicated syntax trees. Here is an example taken from
the Camlp5 sources themselves:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt;
  match try Some $f$ with [ Stream.Failure -&gt; None ] with
  [ Some $p$ -&gt; $e$
  | _ -&gt; raise (Stream.Error $e2$) ]
&gt;&gt;
</pre></div>
</div>
<p>This example was in a position of a pattern. In abstract syntax, it
should have been written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExMat</span> <span class="n">_</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExTry</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="s2">&quot;Some&quot;</span><span class="p">)</span> <span class="n">f</span><span class="p">)</span>
     <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaAcc</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">_</span> <span class="s2">&quot;Stream&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">_</span> <span class="s2">&quot;Failure&quot;</span><span class="p">),</span>
       <span class="kc">None</span><span class="p">,</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="s2">&quot;None&quot;</span><span class="p">)])</span>
  <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaApp</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">_</span> <span class="s2">&quot;Some&quot;</span><span class="p">)</span> <span class="n">p</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
   <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaAny</span> <span class="n">_</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLid</span> <span class="n">_</span> <span class="s2">&quot;raise&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">_</span>
         <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExAcc</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="s2">&quot;Stream&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="s2">&quot;Error&quot;</span><span class="p">))</span>
         <span class="n">e2</span><span class="p">))]</span>
</pre></div>
</div>
<p>Which is less readable and much more complicated to build and
update.</p>
<p>Instead of thinking of “a syntax tree”, the programmer can think of
“a piece of program”.</p>
</div>
<div class="section" id="location">
<h3>Location<a class="headerlink" href="#location" title="Permalink to this headline">¶</a></h3>
<p>In all syntax tree nodes, the first parameter is the source
location of the node.</p>
<div class="section" id="in-expressions">
<h4>In expressions<a class="headerlink" href="#in-expressions" title="Permalink to this headline">¶</a></h4>
<p>When a quotation is in the context of an expression, the location
parameter is <code class="docutils literal"><span class="pre">loc</span></code> in the node and in all its possible
sub-nodes. Example: if we consider the quotation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">sig_item</span><span class="o">&lt;</span> <span class="n">value</span> <span class="n">foo</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>This quotation, in a context of an expression, is equivalent
to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">SgVal</span> <span class="n">loc</span> <span class="s2">&quot;foo&quot;</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyArr</span> <span class="n">loc</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">loc</span> <span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">loc</span> <span class="s2">&quot;bool&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>The name <code class="docutils literal"><span class="pre">loc</span></code> is predefined. However, it is possible to
change it, using the argument <code class="docutils literal"><span class="pre">-loc</span></code> of the Camlp5 shell
commands.</p>
<p>Consequently, if there is no variable <code class="docutils literal"><span class="pre">loc</span></code> defined in the
context of the quotation, or if it is not of the correct type, a
semantic error occur in the OCaml compiler (“Unbound value
loc”).</p>
<p>Note that in the <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">Extensible grammars</span></a>,
the variable <code class="docutils literal"><span class="pre">loc</span></code> is bound, in all semantic actions, to
the location of the rule.</p>
<p>If the created node has no location, the programmer can define a
variable named <code class="docutils literal"><span class="pre">loc</span></code> equal to <code class="docutils literal"><span class="pre">Ploc.dummy</span></code>.</p>
</div>
<div class="section" id="in-patterns">
<h4>In patterns<a class="headerlink" href="#in-patterns" title="Permalink to this headline">¶</a></h4>
<p>When a quotation is in the context of a pattern, the location
parameter of all nodes and possible sub-nodes is set to the wildcard
(<code class="docutils literal"><span class="pre">_</span></code>). The same example above:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">sig_item</span><span class="o">&lt;</span> <span class="n">value</span> <span class="n">foo</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>is equivalent, in a pattern, to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">SgVal</span> <span class="n">_</span> <span class="s2">&quot;foo&quot;</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyArr</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="s2">&quot;bool&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>However, it is possible to generate a binding of the variable
<code class="docutils literal"><span class="pre">loc</span></code> on the top node by writing a “colon” before the
“less” in the quotation. The same example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">sig_item</span><span class="p">:</span><span class="o">&lt;</span> <span class="n">value</span> <span class="n">foo</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">SgVal</span> <span class="n">loc</span> <span class="s2">&quot;foo&quot;</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyArr</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="s2">&quot;bool&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="antiquotations">
<h3>Antiquotations<a class="headerlink" href="#antiquotations" title="Permalink to this headline">¶</a></h3>
<p>The expressions or patterns between dollar ($) characters are
called <em>antiquotations</em>. In opposition to quotations which
has its own syntax rules, the antiquotation is an area in the syntax
of the enclosing context (expression or pattern). See the chapter
about <a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a>.</p>
<p>If a quotation is in the context of an expression, the
antiquotation must be an expression. It can be any expression,
including function calls. Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>value f e el = &lt;:expr&lt; [$e$ :: $loop False el$] &gt;&gt;;
value patt_list p pl = &lt;:patt&lt; ( $list:[p::pl]$) &gt;&gt;;
</pre></div>
</div>
<p>If a quotation is in the context of an pattern, the antiquotation
is a pattern. Any pattern is possible, including the wildcard
character (<code class="docutils literal"><span class="pre">_</span></code>). Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>fun [ &lt;:expr&lt; $lid:op$ $_$ $_$ &gt;&gt; -&gt; op ]
match p with [ &lt;:patt&lt; $_$ | $_$ &gt;&gt; -&gt; Some p ]
</pre></div>
</div>
</div>
<div class="section" id="nodes-and-quotations">
<h3>Nodes and Quotations<a class="headerlink" href="#nodes-and-quotations" title="Permalink to this headline">¶</a></h3>
<p>This section describes all nodes defined in the module “MLast” of
Camlp5 and how to write them with quotations. Notice that, inside
quotations, one is not restricted to these elementary cases, but
any complex value can be used, resulting on possibly complex combined
nodes.</p>
<p>Variables names give information of their types:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">e</span></code>, <code class="docutils literal"><span class="pre">e1</span></code>, <code class="docutils literal"><span class="pre">e2</span></code>, <code class="docutils literal"><span class="pre">e3</span></code>: <code class="docutils literal"><span class="pre">expr</span></code></li>
<li><code class="docutils literal"><span class="pre">p</span></code>, <code class="docutils literal"><span class="pre">p1</span></code>, <code class="docutils literal"><span class="pre">p2</span></code>, <code class="docutils literal"><span class="pre">p3</span></code>: <code class="docutils literal"><span class="pre">patt</span></code></li>
<li><code class="docutils literal"><span class="pre">t</span></code>, <code class="docutils literal"><span class="pre">t1</span></code>, <code class="docutils literal"><span class="pre">t2</span></code>, <code class="docutils literal"><span class="pre">e3</span></code>: <code class="docutils literal"><span class="pre">ctyp</span></code></li>
<li><code class="docutils literal"><span class="pre">s</span></code>: <code class="docutils literal"><span class="pre">string</span></code></li>
<li><code class="docutils literal"><span class="pre">b</span></code>: <code class="docutils literal"><span class="pre">bool</span></code></li>
<li><code class="docutils literal"><span class="pre">me</span></code>, <code class="docutils literal"><span class="pre">me1</span></code>, <code class="docutils literal"><span class="pre">me2</span></code>: <code class="docutils literal"><span class="pre">module_expr</span></code></li>
<li><code class="docutils literal"><span class="pre">mt</span></code>, <code class="docutils literal"><span class="pre">mt1</span></code>, <code class="docutils literal"><span class="pre">mt2</span></code>: <code class="docutils literal"><span class="pre">module_type</span></code></li>
<li><code class="docutils literal"><span class="pre">le</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">expr</span></code></li>
<li><code class="docutils literal"><span class="pre">lp</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">patt</span></code></li>
<li><code class="docutils literal"><span class="pre">lt</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">ctyp</span></code></li>
<li><code class="docutils literal"><span class="pre">ls</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">string</span></code></li>
<li><code class="docutils literal"><span class="pre">lse</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(string</span> <span class="pre">*</span> <span class="pre">expr)</span></code></li>
<li><code class="docutils literal"><span class="pre">lpe</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">expr)</span></code></li>
<li><code class="docutils literal"><span class="pre">lpp</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">patt)</span></code></li>
<li><code class="docutils literal"><span class="pre">lpee</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">option</span> <span class="pre">expr</span> <span class="pre">*</span> <span class="pre">expr)</span></code></li>
<li><code class="docutils literal"><span class="pre">op</span></code>: <code class="docutils literal"><span class="pre">option</span> <span class="pre">patt</span></code></li>
<li><code class="docutils literal"><span class="pre">lcsi</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">class_str_item</span></code></li>
<li><code class="docutils literal"><span class="pre">lcsi</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">class_sig_item</span></code></li>
</ul>
<div class="section" id="expr">
<h4>expr<a class="headerlink" href="#expr" title="Permalink to this headline">¶</a></h4>
<p>Expressions of the language.</p>
<table border="1" class="docutils" id="id41">
<caption><span class="caption-text">Expressions of the language</span><a class="headerlink" href="#id41" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:expr&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExAcc</span> <span class="pre">loc</span> <span class="pre">e1</span> <span class="pre">e2</span></code></td>
<td><code class="docutils literal"><span class="pre">$e1$</span> <span class="pre">.</span> <span class="pre">$e2$</span></code></td>
<td>access</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExAnt</span> <span class="pre">loc</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">$anti:e$</span></code></td>
<td>&lt;a href=”#expr_1”&gt;(1)&lt;/a&gt;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExApp</span> <span class="pre">loc</span> <span class="pre">e1</span> <span class="pre">e2</span></code></td>
<td><code class="docutils literal"><span class="pre">$e1$</span> <span class="pre">$e2$</span></code></td>
<td>application</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExAre</span> <span class="pre">loc</span> <span class="pre">e1</span> <span class="pre">e2</span></code></td>
<td><code class="docutils literal"><span class="pre">$e1$</span> <span class="pre">.(</span> <span class="pre">$e2$</span> <span class="pre">)</span></code></td>
<td>array element</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExArr</span> <span class="pre">loc</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">[|</span> <span class="pre">$list:le$</span> <span class="pre">|]</span></code></td>
<td>array</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExAsr</span> <span class="pre">loc</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">assert</span> <span class="pre">$e$</span></code></td>
<td>assert</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExAss</span> <span class="pre">loc</span> <span class="pre">e1</span> <span class="pre">e2</span></code></td>
<td><code class="docutils literal"><span class="pre">$e1$</span> <span class="pre">:=</span> <span class="pre">$e2$</span></code></td>
<td>assignment</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExBae</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">$e$</span> <span class="pre">.{</span> <span class="pre">$list:le$</span> <span class="pre">}</span></code></td>
<td>big array element</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExChr</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$chr:s$</span></code></td>
<td>character constant</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExCoe</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">None</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">($e$</span> <span class="pre">:&gt;</span> <span class="pre">$t2$)</span></code></td>
<td>coercion</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExCoe</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">(Some</span> <span class="pre">t1)</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">($e$</span> <span class="pre">:</span> <span class="pre">$t1$</span> <span class="pre">:&gt;</span> <span class="pre">$t2$)</span></code></td>
<td>coercion</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExFlo</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$flo:s$</span></code></td>
<td>float constant</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExFor</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">e1</span> <span class="pre">e2</span> <span class="pre">True</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">for</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e1$</span> <span class="pre">to</span> <span class="pre">$e2$</span> <span class="pre">do</span> <span class="pre">{</span> <span class="pre">$list:le$</span> <span class="pre">}</span></code></td>
<td>for (increasing)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExFor</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">e1</span> <span class="pre">e2</span> <span class="pre">False</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">for</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e1$</span> <span class="pre">downto</span> <span class="pre">$e2$</span> <span class="pre">do</span> <span class="pre">{</span> <span class="pre">$list:le$</span> <span class="pre">}</span></code></td>
<td>for (decreasing)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExFor</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">e1</span> <span class="pre">e2</span> <span class="pre">b</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">for</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e1$</span> <span class="pre">$to:b$</span> <span class="pre">$e2$</span> <span class="pre">do</span> <span class="pre">{</span> <span class="pre">$list:le$</span> <span class="pre">}</span></code></td>
<td>for</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExFun</span> <span class="pre">loc</span> <span class="pre">lpee</span></code></td>
<td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">[</span> <span class="pre">$list:lpee$</span> <span class="pre">]</span></code></td>
<td>function &lt;a href=”#expr_2”&gt;(2)&lt;/a&gt;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExIfe</span> <span class="pre">loc</span> <span class="pre">e1</span> <span class="pre">e2</span> <span class="pre">e3</span></code></td>
<td><code class="docutils literal"><span class="pre">if</span> <span class="pre">$e1$</span> <span class="pre">then</span> <span class="pre">$e2$</span> <span class="pre">else</span> <span class="pre">$e3$</span></code></td>
<td>if</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$int:s1$</span></code></td>
<td>integer constant</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;l&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$int32:s1$</span></code></td>
<td>integer 32 bits</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;L&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$int64:s1$</span></code></td>
<td>integer 64 bits</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;n&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$nativeint:s1$</span></code></td>
<td>native integer</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExLab</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">~{$p$}</span></code></td>
<td>label</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExLab</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">(Some</span> <span class="pre">e)</span></code></td>
<td><code class="docutils literal"><span class="pre">~{$p$</span> <span class="pre">=</span> <span class="pre">$e$}</span></code></td>
<td>label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExLab</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">oe</span></code></td>
<td><code class="docutils literal"><span class="pre">~{$p$</span> <span class="pre">$opt:oe$}</span></code></td>
<td>label</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExLaz</span> <span class="pre">loc</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">lazy</span> <span class="pre">$e$</span></code></td>
<td>lazy</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExLet</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">lpe</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">rec</span> <span class="pre">$list:lpe$</span> <span class="pre">in</span> <span class="pre">$e$</span></code></td>
<td>let rec</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExLet</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">lpe</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">$list:lpe$</span> <span class="pre">in</span> <span class="pre">$e$</span></code></td>
<td>let not rec</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExLet</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">lpe</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">$flag:b$</span> <span class="pre">$list:lpe$</span> <span class="pre">in</span> <span class="pre">$e$</span></code></td>
<td>let</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExLid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$lid:s$</span></code></td>
<td>lowercase identifier</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExLmd</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">me</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">module</span> <span class="pre">$uid:s$</span> <span class="pre">=</span> <span class="pre">$me$</span> <span class="pre">in</span> <span class="pre">$e$</span></code></td>
<td>let module</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExMat</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">lpee</span></code></td>
<td><code class="docutils literal"><span class="pre">match</span> <span class="pre">$e$</span> <span class="pre">with</span> <span class="pre">[</span> <span class="pre">$list:lpee$</span> <span class="pre">]</span></code></td>
<td>match &lt;a href=”#expr_2”&gt;(2)&lt;/a&gt;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExNew</span> <span class="pre">loc</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">new</span> <span class="pre">$list:ls$</span></code></td>
<td>new</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExObj</span> <span class="pre">loc</span> <span class="pre">None</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object expression</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExObj</span> <span class="pre">loc</span> <span class="pre">(Some</span> <span class="pre">p)</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">($p$)</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object expression</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExObj</span> <span class="pre">loc</span> <span class="pre">op</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">$opt:op$</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object expression</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExOlb</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">?{$p$}</span></code></td>
<td>option label</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExOlb</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">(Some</span> <span class="pre">e)</span></code></td>
<td><code class="docutils literal"><span class="pre">?{$p$</span> <span class="pre">=</span> <span class="pre">$e$}</span></code></td>
<td>option label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExOlb</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">oe</span></code></td>
<td><code class="docutils literal"><span class="pre">?{$p$</span> <span class="pre">$opt:oe$}</span></code></td>
<td>option label</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExOvr</span> <span class="pre">loc</span> <span class="pre">lse</span></code></td>
<td><code class="docutils literal"><span class="pre">{&lt;</span> <span class="pre">$list:lse$</span> <span class="pre">&gt;}</span></code></td>
<td>override</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExPck</span> <span class="pre">loc</span> <span class="pre">me</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">$me$)</span></code></td>
<td>module packing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExPck</span> <span class="pre">loc</span> <span class="pre">me</span> <span class="pre">(Some</span> <span class="pre">mt)</span></code></td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">$me$</span> <span class="pre">:</span> <span class="pre">$mt$)</span></code></td>
<td>module packing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExRec</span> <span class="pre">loc</span> <span class="pre">lpe</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">{$list:lpe$}</span></code></td>
<td>record</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExRec</span> <span class="pre">loc</span> <span class="pre">lpe</span> <span class="pre">(Some</span> <span class="pre">e)</span></code></td>
<td><code class="docutils literal"><span class="pre">{($e$)</span> <span class="pre">with</span> <span class="pre">$list:lpe$}</span></code></td>
<td>record</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExSeq</span> <span class="pre">loc</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">do</span> <span class="pre">{</span> <span class="pre">$list:le$</span> <span class="pre">}</span></code></td>
<td>sequence</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExSnd</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$e$</span> <span class="pre">#</span> <span class="pre">$s$</span></code></td>
<td>method call</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExSte</span> <span class="pre">loc</span> <span class="pre">e1</span> <span class="pre">e2</span></code></td>
<td><code class="docutils literal"><span class="pre">$e1$</span> <span class="pre">.[</span> <span class="pre">$e2$</span> <span class="pre">]</span></code></td>
<td>string element</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExStr</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$str:s$</span></code></td>
<td>string</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExTry</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">lpee</span></code></td>
<td><code class="docutils literal"><span class="pre">try</span> <span class="pre">$e$</span> <span class="pre">with</span> <span class="pre">[</span> <span class="pre">$list:lpee$</span> <span class="pre">]</span></code></td>
<td>try &lt;a href=”#expr_2”&gt;(2)&lt;/a&gt;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExTup</span> <span class="pre">loc</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">($list:le$)</span></code></td>
<td>t-uple</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExTyc</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">($e$</span> <span class="pre">:</span> <span class="pre">$t$)</span></code></td>
<td>type constraint</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExUid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$uid:s$</span></code></td>
<td>uppercase identifier</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">ExVrn</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">`</span> <span class="pre">$s$</span></code></td>
<td>variant</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">ExWhi</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">le</span></code></td>
<td><code class="docutils literal"><span class="pre">while</span> <span class="pre">$e$</span> <span class="pre">do</span> <span class="pre">{</span> <span class="pre">$list:le$</span> <span class="pre">}</span></code></td>
<td>while</td>
</tr>
</tbody>
</table>
<p>1. Node used in the quotation expanders to tells at conversion to
OCaml compiler syntax tree time, that all locations of the
sub-tree is correcty located in the quotation. By default, in
quotations, the locations of all generated nodes are the location
of the whole quotation. This node allows to make an exception to
this rule, since we know that the antiquotation belongs to the
universe of the enclosing program. See the chapter
about <a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a> and, in particular, its
section about antiquotations.</p>
<p>2. The variable <code class="docutils literal"><span class="pre">lpee</span></code> found in “function”, “match” and “try”
statements correspond to a list of <code class="docutils literal"><span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">option</span> <span class="pre">expr</span> <span class="pre">*</span>
<span class="pre">expr)</span></code> where the <code class="docutils literal"><span class="pre">option</span> <span class="pre">expr</span></code> is the “when”
optionally following the pattern:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">-&gt;</span> <span class="n">e</span>
</pre></div>
</div>
<p>is represented by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="n">when</span> <span class="n">e1</span> <span class="o">-&gt;</span> <span class="n">e</span>


<span class="ow">is</span> <span class="n">represented</span> <span class="n">by</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Some</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>&lt;/div&gt;</p>
</div>
<div class="section" id="patt">
<h4>patt<a class="headerlink" href="#patt" title="Permalink to this headline">¶</a></h4>
<p>Patterns of the language.</p>
<table border="1" class="docutils" id="id42">
<caption><span class="caption-text">Patterns of the language</span><a class="headerlink" href="#id42" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:patt&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaAcc</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">p2</span></code></td>
<td><code class="docutils literal"><span class="pre">$p1$</span> <span class="pre">.</span> <span class="pre">$p2$</span></code></td>
<td>access</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaAli</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">p2</span></code></td>
<td><code class="docutils literal"><span class="pre">($p1$</span> <span class="pre">as</span> <span class="pre">$p2$)</span></code></td>
<td>alias</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaAnt</span> <span class="pre">loc</span> <span class="pre">p</span></code></td>
<td><code class="docutils literal"><span class="pre">$anti:p$</span></code></td>
<td>antiquotation &lt;a href=”#patt_1”&gt;(1)&lt;/a&gt;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaAny</span> <span class="pre">loc</span></code></td>
<td><code class="docutils literal"><span class="pre">_</span></code></td>
<td>wildcard</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaApp</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">p2</span></code></td>
<td><code class="docutils literal"><span class="pre">$p1$</span> <span class="pre">$p2$</span></code></td>
<td>application</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaArr</span> <span class="pre">loc</span> <span class="pre">lp</span></code></td>
<td><code class="docutils literal"><span class="pre">[|</span> <span class="pre">$list:lp$</span> <span class="pre">|]</span></code></td>
<td>array</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaChr</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$chr:s$</span></code></td>
<td>character</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaFlo</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$flo:s$</span></code></td>
<td>float</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$int:s1$</span></code></td>
<td>integer constant</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;l&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$int32:s1$</span></code></td>
<td>integer 32 bits</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;L&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$int64:s1$</span></code></td>
<td>integer 64 bits</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaInt</span> <span class="pre">loc</span> <span class="pre">s1</span> <span class="pre">&quot;n&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">$nativeint:s1$</span></code></td>
<td>native integer</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaLab</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">~{$p1$}</span></code></td>
<td>label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaLab</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">(Some</span> <span class="pre">p2)</span></code></td>
<td><code class="docutils literal"><span class="pre">~{$p1$</span> <span class="pre">=</span> <span class="pre">$p2$}</span></code></td>
<td>label</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaLab</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">op2</span></code></td>
<td><code class="docutils literal"><span class="pre">~{$p1$</span> <span class="pre">$opt:op2$}</span></code></td>
<td>label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaLaz</span> <span class="pre">loc</span> <span class="pre">p</span></code></td>
<td><code class="docutils literal"><span class="pre">lazy</span> <span class="pre">$p$</span></code></td>
<td>lazy</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaLid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$lid:s$</span></code></td>
<td>lowercase identifier</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaNty</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">(type</span> <span class="pre">$lid:s$)</span></code></td>
<td>new type</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaOlb</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">?{$p$}</span></code></td>
<td>option label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaOlb</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">(Some</span> <span class="pre">e)</span></code></td>
<td><code class="docutils literal"><span class="pre">?{$p$</span> <span class="pre">=</span> <span class="pre">$e$}</span></code></td>
<td>option label</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaOlb</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">oe</span></code></td>
<td><code class="docutils literal"><span class="pre">?{$p$</span> <span class="pre">$opt:oe$}</span></code></td>
<td>option label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaOrp</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">p2</span></code></td>
<td><code class="docutils literal"><span class="pre">$p1$</span> <span class="pre">|</span> <span class="pre">$p2$</span></code></td>
<td>or</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaRec</span> <span class="pre">loc</span> <span class="pre">lpp</span></code></td>
<td><code class="docutils literal"><span class="pre">{</span> <span class="pre">$list:lpp$</span> <span class="pre">}</span></code></td>
<td>record</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaRng</span> <span class="pre">loc</span> <span class="pre">p1</span> <span class="pre">p2</span></code></td>
<td><code class="docutils literal"><span class="pre">$p1$</span> <span class="pre">..</span> <span class="pre">$p2$</span></code></td>
<td>range</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaStr</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$str:s$</span></code></td>
<td>string</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaTup</span> <span class="pre">loc</span> <span class="pre">lp</span></code></td>
<td><code class="docutils literal"><span class="pre">($list:lp$)</span></code></td>
<td>t-uple</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaTyc</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">($p$</span> <span class="pre">:</span> <span class="pre">$t$)</span></code></td>
<td>type constraint</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaTyp</span> <span class="pre">loc</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$list:ls$</span></code></td>
<td>type pattern</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaUid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$uid:s$</span></code></td>
<td>uppercase identifier</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaUnp</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">$uid:s$)</span></code></td>
<td>module unpacking</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PaUnp</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">mt)</span></code></td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">$uid:s$</span> <span class="pre">:</span> <span class="pre">$mt$)</span></code></td>
<td>module unpacking</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PaVrn</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">`</span> <span class="pre">$s$</span></code></td>
<td>variant</td>
</tr>
</tbody>
</table>
<p>1. Node used to specify an antiquotation area, like for the equivalent
node in expressions. See above.</p>
</div>
<div class="section" id="ctyp">
<h4>ctyp<a class="headerlink" href="#ctyp" title="Permalink to this headline">¶</a></h4>
<p>Type expressions of the language.</p>
<table border="1" class="docutils" id="id43">
<caption><span class="caption-text">Type expressions of the language</span><a class="headerlink" href="#id43" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:ctyp&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyAcc</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">.</span> <span class="pre">$t2$</span></code></td>
<td>access</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyAli</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">as</span> <span class="pre">$t2$</span></code></td>
<td>alias</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyAny</span> <span class="pre">loc</span></code></td>
<td><code class="docutils literal"><span class="pre">_</span></code></td>
<td>wildcard</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyApp</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">$t2$</span></code></td>
<td>application</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyArr</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">-&gt;</span> <span class="pre">$t2$</span></code></td>
<td>arrow</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyCls</span> <span class="pre">loc</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$list:ls$</span></code></td>
<td>class</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyLab</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">~$s$:</span> <span class="pre">$t$</span></code></td>
<td>label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyLid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$lid:s$</span></code></td>
<td>lowercase identifier</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyMan</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">True</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">==</span> <span class="pre">private</span> <span class="pre">$t2$</span></code></td>
<td>manifest</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyMan</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">False</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">==</span> <span class="pre">$t2$</span></code></td>
<td>manifest</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyMan</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">b</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">$t1$</span> <span class="pre">==</span> <span class="pre">$priv:b$</span> <span class="pre">$t2$</span></code></td>
<td>manifest</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyObj</span> <span class="pre">loc</span> <span class="pre">lst</span> <span class="pre">True</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;</span> <span class="pre">$list:lst$</span> <span class="pre">..</span> <span class="pre">&gt;</span></code></td>
<td>object</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyObj</span> <span class="pre">loc</span> <span class="pre">lst</span> <span class="pre">False</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;</span> <span class="pre">$list:lst$</span> <span class="pre">&gt;</span></code></td>
<td>object</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyObj</span> <span class="pre">loc</span> <span class="pre">lst</span> <span class="pre">b</span></code></td>
<td><code class="docutils literal"><span class="pre">&lt;</span> <span class="pre">$list:lst$</span> <span class="pre">$flag:b$</span> <span class="pre">&gt;</span></code></td>
<td>object</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyOlb</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">?$s$:</span> <span class="pre">$t$</span></code></td>
<td>option label</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyPck</span> <span class="pre">loc</span> <span class="pre">mt</span></code></td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">$mt$)</span></code></td>
<td>package</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyPol</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">!</span> <span class="pre">$list:ls$</span> <span class="pre">.</span> <span class="pre">$t$</span></code></td>
<td>polymorph</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyQuo</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">'$s$</span></code></td>
<td>variable</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyRec</span> <span class="pre">loc</span> <span class="pre">llsbt</span></code></td>
<td><code class="docutils literal"><span class="pre">{</span> <span class="pre">$list:llsbt$</span> <span class="pre">}</span></code></td>
<td>record</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TySum</span> <span class="pre">loc</span> <span class="pre">llslt</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">$list:llslt$</span> <span class="pre">]</span></code></td>
<td>sum</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyTup</span> <span class="pre">loc</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">(</span> <span class="pre">$list:lt$</span> <span class="pre">)</span></code></td>
<td>t-uple</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyUid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$uid:s$</span></code></td>
<td>uppercase identifier</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyVrn</span> <span class="pre">loc</span> <span class="pre">lpv</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">=</span> <span class="pre">$list:lpv$</span> <span class="pre">]</span></code></td>
<td>variant</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyVrn</span> <span class="pre">loc</span> <span class="pre">lpv</span> <span class="pre">(Some</span> <span class="pre">None)</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">&gt;</span> <span class="pre">$list:lpv$</span> <span class="pre">]</span></code></td>
<td>variant</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">TyVrn</span> <span class="pre">loc</span> <span class="pre">lpv</span> <span class="pre">(Some</span> <span class="pre">(Some</span> <span class="pre">[]))</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">&lt;</span> <span class="pre">$list:lpv$</span> <span class="pre">]</span></code></td>
<td>variant</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">TyVrn</span> <span class="pre">loc</span> <span class="pre">lpv</span> <span class="pre">(Some</span> <span class="pre">(Some</span> <span class="pre">ls))</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">&lt;</span> <span class="pre">$list:lpv$</span> <span class="pre">&gt;</span> <span class="pre">$list:ls$</span> <span class="pre">]</span></code></td>
<td>variant</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modules">
<h4>modules…<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h4>
<div class="section" id="str-item">
<h5>str_item<a class="headerlink" href="#str-item" title="Permalink to this headline">¶</a></h5>
<p>Structure items, i.e. phrases in a <code class="docutils literal"><span class="pre">.ml</span></code> file or <code class="docutils literal"><span class="pre">struct</span></code>
elements.</p>
<table border="1" class="docutils" id="id44">
<caption><span class="caption-text">Structure items of the language</span><a class="headerlink" href="#id44" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:str_item&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StCls</span> <span class="pre">loc</span> <span class="pre">lcice</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">$list:lcice$</span></code></td>
<td>class declaration</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StClt</span> <span class="pre">loc</span> <span class="pre">lcict</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">type</span> <span class="pre">$list:lcict$</span></code></td>
<td>class type declaration</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StDcl</span> <span class="pre">loc</span> <span class="pre">lsi</span></code></td>
<td><code class="docutils literal"><span class="pre">declare</span> <span class="pre">$list:lsi$</span> <span class="pre">end</span></code></td>
<td>declare</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StDir</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$lid:s$</span></code></td>
<td>directive</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StDir</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">e)</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$lid:s$</span> <span class="pre">$e$</span></code></td>
<td>directive</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StDir</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">oe</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:oe$</span></code></td>
<td>directive</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StExc</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">[]</span> <span class="pre">[]</span></code></td>
<td><code class="docutils literal"><span class="pre">exception</span> <span class="pre">$uid:s$</span></code></td>
<td>exception</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StExc</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">lt</span> <span class="pre">[]</span></code></td>
<td><code class="docutils literal"><span class="pre">exception</span> <span class="pre">$uid:s$</span> <span class="pre">of</span> <span class="pre">$list:lt$</span></code></td>
<td>exception</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StExc</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">[]</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">exception</span> <span class="pre">$uid:s$</span> <span class="pre">=</span> <span class="pre">$list:ls$</span></code></td>
<td>exception</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StExc</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">lt</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">exception</span> <span class="pre">$uid:s$</span> <span class="pre">of</span> <span class="pre">$list:lt$</span> <span class="pre">=</span> <span class="pre">$list:ls$</span></code></td>
<td>exception</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StExp</span> <span class="pre">loc</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">$exp:e$</span></code></td>
<td>expression</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StExt</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">t</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">external</span> <span class="pre">$s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$list:ls$</span></code></td>
<td>external</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StInc</span> <span class="pre">loc</span> <span class="pre">me</span></code></td>
<td><code class="docutils literal"><span class="pre">include</span> <span class="pre">$me$</span></code></td>
<td>include</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StMod</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">lsme</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">rec</span> <span class="pre">$list:lsme$</span></code></td>
<td>module rec</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StMod</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">lsme</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">$list:lsme$</span></code></td>
<td>module non rec</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StMod</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">lsme</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">$flag:b$</span> <span class="pre">$list:lsme$</span></code></td>
<td>module</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StMty</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">mt</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">type</span> <span class="pre">$s$</span> <span class="pre">=</span> <span class="pre">$mt$</span></code></td>
<td>module type</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StOpn</span> <span class="pre">loc</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">open</span> <span class="pre">$list:ls$</span></code></td>
<td>open</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StTyp</span> <span class="pre">loc</span> <span class="pre">ltd</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$list:ltd$</span></code></td>
<td>type declaration</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StUse</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">lsil</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$str:s$</span> <span class="pre">$list:lsil$</span></code></td>
<td>… internal use … &lt;a href=”#t_str_item_1”&gt;(1)&lt;/a&gt;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StVal</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">lpe</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">rec</span> <span class="pre">$list:lpe$</span></code></td>
<td>value rec</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">StVal</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">lpe</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$list:lpe$</span></code></td>
<td>value non rec</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">StVal</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">lpe</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$flag:b$</span> <span class="pre">$list:lpe$</span></code></td>
<td>value</td>
</tr>
</tbody>
</table>
<p>1. Node internally used to specify a different file name applying to
the whole subtree. This is generated by the directive “use” and
used when converting to the OCaml syntax tree which needs the file
name in its location type.</p>
</div>
<div class="section" id="sig-item">
<h5>sig_item<a class="headerlink" href="#sig-item" title="Permalink to this headline">¶</a></h5>
<p>Signature items, i.e. phrases in a “.mli” file or elements
inside “sig … end”.</p>
<table border="1" class="docutils" id="id45">
<caption><span class="caption-text">Signature items of the language</span><a class="headerlink" href="#id45" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:sig_item&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgCls</span> <span class="pre">loc</span> <span class="pre">lcict</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">$list:lcict$</span></code></td>
<td>class</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgClt</span> <span class="pre">loc</span> <span class="pre">lcict</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">type</span> <span class="pre">$list:lcict$</span></code></td>
<td>class type</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgDcl</span> <span class="pre">loc</span> <span class="pre">lsi</span></code></td>
<td><code class="docutils literal"><span class="pre">declare</span> <span class="pre">$list:lsi$</span> <span class="pre">end</span></code></td>
<td>declare</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgDir</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$lid:s$</span></code></td>
<td>directive</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgDir</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">e)</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$lid:s$</span> <span class="pre">$e$</span></code></td>
<td>directive</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgDir</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">oe</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:oe$</span></code></td>
<td>directive</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgExc</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">[]</span></code></td>
<td><code class="docutils literal"><span class="pre">exception</span> <span class="pre">$s$</span></code></td>
<td>exception</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgExc</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">exception</span> <span class="pre">$s$</span> <span class="pre">of</span> <span class="pre">$list:lt$</span></code></td>
<td>exception</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgExt</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">t</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">external</span> <span class="pre">$s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$list:ls$</span></code></td>
<td>external</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgInc</span> <span class="pre">loc</span> <span class="pre">mt</span></code></td>
<td><code class="docutils literal"><span class="pre">include</span> <span class="pre">$mt$</span></code></td>
<td>include</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgMod</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">lsmt</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">rec</span> <span class="pre">$list:lsmt$</span></code></td>
<td>module rec</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgMod</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">lsmt</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">$list:lsmt$</span></code></td>
<td>module non rec</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgMod</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">lsmt</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">$flag:b$</span> <span class="pre">$list:lsmt$</span></code></td>
<td>module</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgMty</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">mt</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">type</span> <span class="pre">$s$</span> <span class="pre">=</span> <span class="pre">$mt$</span></code></td>
<td>module type</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgOpn</span> <span class="pre">loc</span> <span class="pre">ls</span></code></td>
<td><code class="docutils literal"><span class="pre">open</span> <span class="pre">$list:ls$</span></code></td>
<td>open</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgTyp</span> <span class="pre">loc</span> <span class="pre">ltd</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$list:ltd$</span></code></td>
<td>type declaration</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SgUse</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">lsil</span></code></td>
<td><code class="docutils literal"><span class="pre">#</span> <span class="pre">$str:s$</span> <span class="pre">$list:lsil$</span></code></td>
<td>… internal use … &lt;a href=”#t_sig_item_1”&gt;(1)&lt;/a&gt;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SgVal</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>value</td>
</tr>
</tbody>
</table>
<ol class="arabic simple">
<li>Same remark as for <code class="docutils literal"><span class="pre">str_item</span></code> above.</li>
</ol>
</div>
<div class="section" id="module-expr">
<h5>module_expr<a class="headerlink" href="#module-expr" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id46">
<caption><span class="caption-text">Module expressions of the language</span><a class="headerlink" href="#id46" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:module_expr&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MeAcc</span> <span class="pre">loc</span> <span class="pre">me1</span> <span class="pre">me2</span></code></td>
<td><code class="docutils literal"><span class="pre">$me1$</span> <span class="pre">.</span> <span class="pre">$me2$</span></code></td>
<td>access</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MeApp</span> <span class="pre">loc</span> <span class="pre">me1</span> <span class="pre">me2</span></code></td>
<td><code class="docutils literal"><span class="pre">$me1$</span> <span class="pre">$me2$</span></code></td>
<td>application</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MeFun</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">mt</span> <span class="pre">me</span></code></td>
<td><code class="docutils literal"><span class="pre">functor</span> <span class="pre">($s$</span> <span class="pre">:</span> <span class="pre">$mt$)</span> <span class="pre">-&gt;</span> <span class="pre">$me$</span></code></td>
<td>functor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MeStr</span> <span class="pre">loc</span> <span class="pre">lsi</span></code></td>
<td><code class="docutils literal"><span class="pre">struct</span> <span class="pre">$list:lsi$</span> <span class="pre">end</span></code></td>
<td>struct</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MeTyc</span> <span class="pre">loc</span> <span class="pre">me</span> <span class="pre">mt</span></code></td>
<td><code class="docutils literal"><span class="pre">($me$</span> <span class="pre">:</span> <span class="pre">$mt$)</span></code></td>
<td>module type constraint</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MeUid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$uid:s$</span></code></td>
<td>uppercase identifier</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MeUnp</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">(value</span> <span class="pre">$e$)</span></code></td>
<td>module unpacking</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MeUnp</span> <span class="pre">loc</span> <span class="pre">e</span> <span class="pre">(Some</span> <span class="pre">mt)</span></code></td>
<td><code class="docutils literal"><span class="pre">(value</span> <span class="pre">$e$</span> <span class="pre">:</span> <span class="pre">$mt$)</span></code></td>
<td>module unpacking</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="module-type">
<h5>module_type<a class="headerlink" href="#module-type" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id47">
<caption><span class="caption-text">Module expressions of the language</span><a class="headerlink" href="#id47" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:module_type&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MtAcc</span> <span class="pre">loc</span> <span class="pre">mt1</span> <span class="pre">mt2</span></code></td>
<td><code class="docutils literal"><span class="pre">$mt1$</span> <span class="pre">.</span> <span class="pre">$mt2$</span></code></td>
<td>access</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MtApp</span> <span class="pre">loc</span> <span class="pre">mt1</span> <span class="pre">mt2</span></code></td>
<td><code class="docutils literal"><span class="pre">$mt1$</span> <span class="pre">$mt2$</span></code></td>
<td>application</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MtFun</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">mt1</span> <span class="pre">mt2</span></code></td>
<td><code class="docutils literal"><span class="pre">functor</span> <span class="pre">($s$</span> <span class="pre">:</span> <span class="pre">$mt1$)</span> <span class="pre">-&gt;</span> <span class="pre">$mt2$</span></code></td>
<td>functor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MtLid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$lid:s$</span></code></td>
<td>lowercase identifier</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MtQuo</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">'</span> <span class="pre">$s$</span></code></td>
<td>abstract</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MtSig</span> <span class="pre">loc</span> <span class="pre">lsi</span></code></td>
<td><code class="docutils literal"><span class="pre">sig</span> <span class="pre">$list:lsi$</span> <span class="pre">end</span></code></td>
<td>signature</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MtTyo</span> <span class="pre">loc</span> <span class="pre">me</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">type</span> <span class="pre">of</span> <span class="pre">$me$</span></code></td>
<td>of module expression</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MtUid</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$uid:s$</span></code></td>
<td>uppercase identifier</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MtWit</span> <span class="pre">loc</span> <span class="pre">mt</span> <span class="pre">lwc</span></code></td>
<td><code class="docutils literal"><span class="pre">$mt$</span> <span class="pre">with</span> <span class="pre">$list:lwc$</span></code></td>
<td>with construction</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="classes">
<h4>classes…<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="class-expr">
<h5>class_expr<a class="headerlink" href="#class-expr" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id48">
<caption><span class="caption-text">Class expressions of the language</span><a class="headerlink" href="#id48" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:class_expr&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CeApp</span> <span class="pre">loc</span> <span class="pre">ce</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">$ce$</span> <span class="pre">$e$</span></code></td>
<td>application</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CeCon</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">$list:lt$</span> <span class="pre">]</span> <span class="pre">$list:ls$</span></code></td>
<td>constructor</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CeFun</span> <span class="pre">loc</span> <span class="pre">p</span> <span class="pre">ce</span></code></td>
<td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">$p$</span> <span class="pre">-&gt;</span> <span class="pre">$ce$</span></code></td>
<td>function</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CeLet</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">lpe</span> <span class="pre">ce</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">rec</span> <span class="pre">$list:lpe$</span> <span class="pre">in</span> <span class="pre">$ce$</span></code></td>
<td>let rec</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CeLet</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">lpe</span> <span class="pre">ce</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">$list:lpe$</span> <span class="pre">in</span> <span class="pre">$ce$</span></code></td>
<td>let non rec</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CeLet</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">lpe</span> <span class="pre">ce</span></code></td>
<td><code class="docutils literal"><span class="pre">let</span> <span class="pre">$flag:b$</span> <span class="pre">$list:lpe$</span> <span class="pre">in</span> <span class="pre">$ce$</span></code></td>
<td>let</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CeStr</span> <span class="pre">loc</span> <span class="pre">None</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CeStr</span> <span class="pre">loc</span> <span class="pre">(Some</span> <span class="pre">p)</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">($p$)</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CeStr</span> <span class="pre">loc</span> <span class="pre">op</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">$opt:op$</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CeTyc</span> <span class="pre">loc</span> <span class="pre">ce</span> <span class="pre">ct</span></code></td>
<td><code class="docutils literal"><span class="pre">($ce$</span> <span class="pre">:</span> <span class="pre">$ct$)</span></code></td>
<td>class type constraint</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-type">
<h5>class_type<a class="headerlink" href="#class-type" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id49">
<caption><span class="caption-text">Class expressions of the language</span><a class="headerlink" href="#id49" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:class_type&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CtAcc</span> <span class="pre">loc</span> <span class="pre">ct1</span> <span class="pre">ct2</span></code></td>
<td><code class="docutils literal"><span class="pre">$ct1$</span> <span class="pre">.</span> <span class="pre">$ct2$</span></code></td>
<td>access</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CtApp</span> <span class="pre">loc</span> <span class="pre">ct1</span> <span class="pre">ct2</span></code></td>
<td><code class="docutils literal"><span class="pre">$ct1$</span> <span class="pre">$ct2$</span></code></td>
<td>application</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CtCon</span> <span class="pre">loc</span> <span class="pre">ct</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">$ct$</span> <span class="pre">[</span> <span class="pre">$list:lt$</span> <span class="pre">]</span></code></td>
<td>constructor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CtFun</span> <span class="pre">loc</span> <span class="pre">t</span> <span class="pre">ct</span></code></td>
<td><code class="docutils literal"><span class="pre">[</span> <span class="pre">$t$</span> <span class="pre">]</span> <span class="pre">-&gt;</span> <span class="pre">$ct$</span></code></td>
<td>arrow</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CtIde</span> <span class="pre">loc</span> <span class="pre">s</span></code></td>
<td><code class="docutils literal"><span class="pre">$id:s$</span></code></td>
<td>identifier</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CtSig</span> <span class="pre">loc</span> <span class="pre">None</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CtSig</span> <span class="pre">loc</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">($t$)</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CtSig</span> <span class="pre">loc</span> <span class="pre">ot</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">$opt:ot$</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>object</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-str-item">
<h5>class_str_item<a class="headerlink" href="#class-str-item" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id50">
<caption><span class="caption-text">Class structure items of the language</span><a class="headerlink" href="#id50" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:class_str_item&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrCtr</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$t1$</span> <span class="pre">=</span> <span class="pre">$t2$</span></code></td>
<td>type constraint</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrDcl</span> <span class="pre">loc</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">declare</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>declaration list</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrInh</span> <span class="pre">loc</span> <span class="pre">ce</span> <span class="pre">None</span></code></td>
<td><code class="docutils literal"><span class="pre">inherit</span> <span class="pre">$ce$</span></code></td>
<td>inheritance</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrInh</span> <span class="pre">loc</span> <span class="pre">ce</span> <span class="pre">(Some</span> <span class="pre">s)</span></code></td>
<td><code class="docutils literal"><span class="pre">inherit</span> <span class="pre">$ce$</span> <span class="pre">$opt:Some</span> <span class="pre">s$</span></code></td>
<td>inheritance</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrInh</span> <span class="pre">loc</span> <span class="pre">ce</span> <span class="pre">os</span></code></td>
<td><code class="docutils literal"><span class="pre">inherit</span> <span class="pre">$ce$</span> <span class="pre">$opt:os$</span></code></td>
<td>inheritance</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrIni</span> <span class="pre">loc</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">initializer</span> <span class="pre">$e$</span></code></td>
<td>initialization</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method!</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">None</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">(Some</span> <span class="pre">t)</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrMth</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">ot</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$!:b1$</span> <span class="pre">$priv:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">$opt:ot$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value!</span> <span class="pre">mutable</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value!</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value!</span> <span class="pre">$flag:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">mutable</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$flag:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$!:b1$</span> <span class="pre">mutable</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$!:b1$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVal</span> <span class="pre">loc</span> <span class="pre">b1</span> <span class="pre">b2</span> <span class="pre">s</span> <span class="pre">e</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$!:b1$</span> <span class="pre">$flag:b2$</span> <span class="pre">$lid:s$</span> <span class="pre">=</span> <span class="pre">$e$</span></code></td>
<td>value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVav</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">virtual</span> <span class="pre">mutable</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVav</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">virtual</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVav</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">virtual</span> <span class="pre">$flag:b$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVir</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CrVir</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CrVir</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">$flag:b$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual method</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-sig-item">
<h5>class_sig_item<a class="headerlink" href="#class-sig-item" title="Permalink to this headline">¶</a></h5>
<table border="1" class="docutils" id="id51">
<caption><span class="caption-text">Class signature items of the language</span><a class="headerlink" href="#id51" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:class_sig_item&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CgCtr</span> <span class="pre">loc</span> <span class="pre">t1</span> <span class="pre">t2</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$t1$</span> <span class="pre">=</span> <span class="pre">$t2$</span></code></td>
<td>type constraint</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CgDcl</span> <span class="pre">loc</span> <span class="pre">lcsi</span></code></td>
<td><code class="docutils literal"><span class="pre">declare</span> <span class="pre">$list:lcsi$</span> <span class="pre">end</span></code></td>
<td>declare</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CgInh</span> <span class="pre">loc</span> <span class="pre">ct</span></code></td>
<td><code class="docutils literal"><span class="pre">inherit</span> <span class="pre">$ct$</span></code></td>
<td>inheritance</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CgMth</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CgMth</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CgMth</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">$flag:b$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CgVal</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">mutable</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CgVal</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>value</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CgVal</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">$flag:b$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>value</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CgVir</span> <span class="pre">loc</span> <span class="pre">True</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">private</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual method</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">CgVir</span> <span class="pre">loc</span> <span class="pre">False</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual method</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">CgVir</span> <span class="pre">loc</span> <span class="pre">b</span> <span class="pre">s</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">$flag:b$</span> <span class="pre">$lid:s$</span> <span class="pre">:</span> <span class="pre">$t$</span></code></td>
<td>virtual method</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="other">
<h4>other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h4>
<div class="section" id="type-decl">
<h5>type_decl<a class="headerlink" href="#type-decl" title="Permalink to this headline">¶</a></h5>
<p>What is after ‘type’ or ‘and’ in a type declaration.</p>
<table border="1" class="docutils" id="id52">
<caption><span class="caption-text">Type declarations of the language</span><a class="headerlink" href="#id52" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:type_decl&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{tdNam=ls;tdPrm=ltv;tdPrv=True;tdDef=t;tdCon=ltt}</span></code></td>
<td><code class="docutils literal"><span class="pre">$tp:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">=</span> <span class="pre">private</span> <span class="pre">$t$</span> <span class="pre">$list:ltt$</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">{tdNam=ls;tdPrm=ltv;tdPrv=False;tdDef=t;tdCon=ltt}</span></code></td>
<td><code class="docutils literal"><span class="pre">$tp:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">=</span> <span class="pre">$t$</span> <span class="pre">$list:ltt$</span></code></td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{tdNam=ls;tdPrm=ltv;tdPrv=b;tdDef=t;tdCon=ltt}</span></code></td>
<td><code class="docutils literal"><span class="pre">$tp:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">=</span> <span class="pre">$priv:b$</span> <span class="pre">$t$</span> <span class="pre">$list:ltt$</span></code></td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="with-constr">
<h5>with_constr<a class="headerlink" href="#with-constr" title="Permalink to this headline">¶</a></h5>
<p>“With” possibly following a module type.</p>
<table border="1" class="docutils" id="id53">
<caption><span class="caption-text">“With” possibly following a module type.</span><a class="headerlink" href="#id53" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:with_constr&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">WcMod</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">me</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">$list:ls$</span> <span class="pre">=</span> <span class="pre">$me$</span></code></td>
<td>with module</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">WcMos</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">me</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">$list:ls$</span> <span class="pre">:=</span> <span class="pre">$me$</span></code></td>
<td>with module substitution</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">WcTyp</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">ltv</span> <span class="pre">True</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$list:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">=</span> <span class="pre">private</span> <span class="pre">$t$</span></code></td>
<td>with type</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">WcTyp</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">ltv</span> <span class="pre">False</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$list:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">=</span> <span class="pre">$t$</span></code></td>
<td>with type</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">WcTyp</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">ltv</span> <span class="pre">b</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$list:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">=</span> <span class="pre">$flag:b$</span> <span class="pre">$t$</span></code></td>
<td>with type</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">WcTys</span> <span class="pre">loc</span> <span class="pre">ls</span> <span class="pre">ltv</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">$list:ls$</span> <span class="pre">$list:ltv$</span> <span class="pre">:=</span> <span class="pre">$t$</span></code></td>
<td>with type substitution</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="poly-variant">
<h5>poly_variant<a class="headerlink" href="#poly-variant" title="Permalink to this headline">¶</a></h5>
<p>Polymorphic variants.</p>
<table border="1" class="docutils" id="id54">
<caption><span class="caption-text">“With” possibly following a module type.</span><a class="headerlink" href="#id54" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Node</th>
<th class="head"><code class="docutils literal"><span class="pre">&lt;:poly_variant&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code></th>
<th class="head">Comment</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PvTag</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">True</span> <span class="pre">[]</span></code></td>
<td><code class="docutils literal"><span class="pre">`$s$</span></code></td>
<td>constructor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PvTag</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">True</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">`$s$</span> <span class="pre">of</span> <span class="pre">&amp;amp;</span> <span class="pre">$list:lt$</span></code></td>
<td>constructor</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PvTag</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">False</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">`$s$</span> <span class="pre">of</span> <span class="pre">$list:lt$</span></code></td>
<td>constructor</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">PvTag</span> <span class="pre">loc</span> <span class="pre">s</span> <span class="pre">b</span> <span class="pre">lt</span></code></td>
<td><code class="docutils literal"><span class="pre">`$s$</span> <span class="pre">of</span> <span class="pre">$flag:b$</span> <span class="pre">$list:lt$</span></code></td>
<td>constructor</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">PvInh</span> <span class="pre">loc</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">$t$</span></code></td>
<td>type</td>
</tr>
</tbody>
</table>
<style> .red {color:red} </style>
<style> .blue {color:blue} </style></div>
</div>
</div>
</div>
<div class="section" id="ml-syntax-tree-strict-mode">
<span id="ast-strict"></span><h2>ML Syntax tree - strict mode<a class="headerlink" href="#ml-syntax-tree-strict-mode" title="Permalink to this headline">¶</a></h2>
<p>This chapter presents the Camlp5 syntax tree when Camlp5 is installed
in <em>strict</em> mode.</p>
<div class="section" id="id2">
<h3>Introduction<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>This syntax tree is defined in the module <code class="docutils literal"><span class="pre">MLast</span></code> provided
by Camlp5. Each node corresponds to a syntactic entity of the
corresponding type.</p>
<p>For example, the syntax tree of the statement <code class="docutils literal"><span class="pre">if</span></code> can
be written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExIfe</span> <span class="n">loc</span> <span class="n">e1</span> <span class="n">e2</span> <span class="n">e3</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">loc</span></code> is the location in the source, and <code class="docutils literal"><span class="pre">e1</span></code>, <code class="docutils literal"><span class="pre">e2</span></code> and
<code class="docutils literal"><span class="pre">e3</span></code> are respectively the expression after the <code class="docutils literal"><span class="pre">if</span></code>, the one after
the <code class="docutils literal"><span class="pre">then</span></code> and the one after the <code class="docutils literal"><span class="pre">else</span></code>.</p>
<p>If a program needs to manipulate syntax trees, it can use the nodes
defined in the module <code class="docutils literal"><span class="pre">MLast</span></code>. The programmer must know how the
concrete syntax is transformed into this abstract syntax.</p>
<p>A simpler solution is to use one of the quotation kits
<code class="docutils literal"><span class="pre">q_MLast.cmo</span></code> or <code class="docutils literal"><span class="pre">q_ast.cmo</span></code>. Both propose
<a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a> which represent the abstract
syntax (the nodes of the module <code class="docutils literal"><span class="pre">MLast</span></code>) into concrete
syntax with antiquotations to bind variables inside. The example
above can be written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; if $e1$ then $e2$ else $e3$ &gt;&gt;
</pre></div>
</div>
<p>This representation is very interesting when one wants to
manipulate complicated syntax trees. Here is an example taken from
the Camlp5 sources themselves:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt;
  match try Some $f$ with [ Stream.Failure -&gt; None ] with
  [ Some $p$ -&gt; $e$
  | _ -&gt; raise (Stream.Error $e2$) ]
&gt;&gt;
</pre></div>
</div>
<p>This example was in a position of a pattern. In abstract syntax, it
should have been written:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExMat</span> <span class="n">_</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExTry</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;Some&quot;</span><span class="p">))</span> <span class="n">f</span><span class="p">)</span>
     <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span>
        <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaAcc</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;Stream&quot;</span><span class="p">))</span>
           <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;Failure&quot;</span><span class="p">)),</span>
          <span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="kc">None</span><span class="p">,</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;None&quot;</span><span class="p">))]))</span>
  <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span>
     <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaApp</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;Some&quot;</span><span class="p">))</span> <span class="n">p</span><span class="p">,</span>
       <span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="kc">None</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
      <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaAny</span> <span class="n">_</span><span class="p">,</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="kc">None</span><span class="p">,</span>
       <span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;raise&quot;</span><span class="p">))</span>
         <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">_</span>
            <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExAcc</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;Stream&quot;</span><span class="p">))</span>
               <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;Error&quot;</span><span class="p">)))</span>
            <span class="n">e2</span><span class="p">))])</span>
</pre></div>
</div>
<p>Which is less readable and much more complicated to build and update.</p>
<p>Instead of thinking of “a syntax tree”, the programmer can think of “a
piece of program”.</p>
</div>
<div class="section" id="id3">
<h3>Location<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>In all syntax tree nodes, the first parameter is the source location
of the node.</p>
<div class="section" id="id4">
<h4>In expressions<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>When a quotation is in the context of an expression, the location
parameter is <code class="docutils literal"><span class="pre">loc</span></code> in the node and in all its possible
sub-nodes. Example: if we consider the quotation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">sig_item</span><span class="o">&lt;</span> <span class="n">value</span> <span class="n">foo</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>This quotation, in a context of an expression, is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">SgVal</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyArr</span> <span class="n">loc</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;int&quot;</span><span class="p">))</span>
     <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;bool&quot;</span><span class="p">)));</span>
</pre></div>
</div>
<p>The name <code class="docutils literal"><span class="pre">loc</span></code> is predefined. However, it is possible to change it,
using the argument <code class="docutils literal"><span class="pre">-loc</span></code> of the Camlp5 shell commands.</p>
<p>Consequently, if there is no variable <code class="docutils literal"><span class="pre">loc</span></code> defined in the context
of the quotation, or if it is not of the good type, a semantic error
occur in the OCaml compiler (<code class="docutils literal"><span class="pre">Unbound</span> <span class="pre">value</span> <span class="pre">loc</span></code>).</p>
<p>Note that in the <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">Extensible grammars</span></a>, the variable <code class="docutils literal"><span class="pre">loc</span></code> is bound, in
all semantic actions, to the location of the rule.</p>
<p>If the created node has no location, the programmer can define a
variable named <code class="docutils literal"><span class="pre">loc</span></code> equal to <code class="docutils literal"><span class="pre">Ploc.dummy</span></code>.</p>
</div>
<div class="section" id="id5">
<h4>In patterns<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>When a quotation is in the context of a pattern, the location
parameter of all nodes and possible sub-nodes is set to the wildcard
(<code class="docutils literal"><span class="pre">_</span></code>). The same example above:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">sig_item</span><span class="o">&lt;</span> <span class="n">value</span> <span class="n">foo</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>is equivalent, in a pattern, to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">SgVal</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyArr</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;int&quot;</span><span class="p">))</span>
     <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;bool&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>However, it is possible to generate a binding of the variable
<code class="docutils literal"><span class="pre">loc</span></code> on the top node by writing a “colon” before the
“less” in the quotation. The same example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">sig_item</span><span class="p">:</span><span class="o">&lt;</span> <span class="n">value</span> <span class="n">foo</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">SgVal</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;foo&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyArr</span> <span class="n">_</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;int&quot;</span><span class="p">))</span>
     <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">TyLid</span> <span class="n">_</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;bool&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>Antiquotations<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The expressions or patterns between dollar ($) characters are
called <em>antiquotations</em>. In opposition to quotations which
has its own syntax rules, the antiquotation is an area in the syntax
of the enclosing context (expression or pattern). See the chapter
about <a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a>.</p>
<p>If a quotation is in the context of an expression, the
antiquotation must be an expression. It could be any expression,
including function calls. Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>value f e el = &lt;:expr&lt; [$e$ :: $loop False el$] &gt;&gt;;
value patt_list p pl = &lt;:patt&lt; ( $list:[p::pl]$) &gt;&gt;;
</pre></div>
</div>
<p>If a quotation is in the context of an pattern, the antiquotation
is a pattern. Any pattern is possible, including the wildcard
character (<code class="docutils literal"><span class="pre">_</span></code>). Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>fun [ &lt;:expr&lt; $lid:op$ $_$ $_$ &gt;&gt; -&gt; op ]
match p with [ &lt;:patt&lt; $_$ | $_$ &gt;&gt; -&gt; Some p ]
</pre></div>
</div>
</div>
<div class="section" id="two-kinds-of-antiquotations">
<h3>Two kinds of antiquotations<a class="headerlink" href="#two-kinds-of-antiquotations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="preliminary-remark">
<h4>Preliminary remark<a class="headerlink" href="#preliminary-remark" title="Permalink to this headline">¶</a></h4>
<p>In strict mode, we remark that most constructors defined of the
module <code class="docutils literal"><span class="pre">MLast</span></code> are of type <code class="docutils literal"><span class="pre">Ploc.vala</span></code>. This type
is defined like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">vala</span> <span class="s1">&#39;a =</span>
  <span class="p">[</span> <span class="n">VaAnt</span> <span class="n">of</span> <span class="n">string</span>
  <span class="o">|</span> <span class="n">VaVal</span> <span class="n">of</span> <span class="s1">&#39;a ]</span>
<span class="p">;</span>
</pre></div>
</div>
<p>The type argument is the real type of the node. For example, a
value of type <code class="docutils literal"><span class="pre">bool</span></code> in transitional mode is frequently
represented by a value of type <code class="docutils literal"><span class="pre">Ploc.vala</span> <span class="pre">bool</span></code>.</p>
<p>The first case of the type <code class="docutils literal"><span class="pre">vala</span></code> corresponds to an
antiquotation in the concrete syntax. The second case to a normal
syntax situation, without antiquotation.</p>
<p>Example: in the “let” statement, the fact that it is “rec” or not
is represented by a boolean. This boolean is, in the syntax tree,
encapsulated with the type <code class="docutils literal"><span class="pre">Ploc.vala</span></code>. The syntax tree of
the two following lines:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">z</span>
<span class="n">let</span> <span class="n">rec</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">z</span>
</pre></div>
</div>
<p>start with, respectively:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLet</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="kc">False</span><span class="p">)</span>
  <span class="o">...</span> <span class="p">(</span><span class="o">*</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLet</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="kc">True</span><span class="p">)</span>
  <span class="o">...</span> <span class="p">(</span><span class="o">*</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>The case <code class="docutils literal"><span class="pre">Ploc.VaAnt</span> <span class="pre">s</span></code> is internally used by the parsers
and by the quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to record
antiquotation strings representing the expression or the patterns
having this value. For example, in this “let” statement:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLet</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaAnt</span> <span class="n">s</span><span class="p">)</span>
  <span class="o">...</span> <span class="p">(</span><span class="o">*</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>The contents of this <code class="docutils literal"><span class="pre">s</span></code> is internally handled. For
information, it contains the antiquotation string (kind included)
together with representation of the location of the antiquotation
in the quotation. See the next section.</p>
</div>
<div class="section" id="antiquoting">
<h4>Antiquoting<a class="headerlink" href="#antiquoting" title="Permalink to this headline">¶</a></h4>
<p>To antiquote the fact that the “let” is with or without rec (a flag
of type boolean), there are two ways.</p>
<div class="section" id="direct-antiquoting">
<h5>direct antiquoting<a class="headerlink" href="#direct-antiquoting" title="Permalink to this headline">¶</a></h5>
<p>The first way, hiding the type <code class="docutils literal"><span class="pre">Ploc.val</span></code>, can be
written with the antiquotation kind “flag”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; let $flag:rf$ x = y in z &gt;&gt;
</pre></div>
</div>
<p>This corresponds to the syntax tree:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLet</span> <span class="n">loc</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="n">rf</span><span class="p">)</span>
   <span class="o">...</span> <span class="p">(</span><span class="o">*</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>And, therefore, the type of the variable <code class="docutils literal"><span class="pre">rf</span></code> is simply
<code class="docutils literal"><span class="pre">bool</span></code>.</p>
</div>
<div class="section" id="general-antiquoting">
<h5>general antiquoting<a class="headerlink" href="#general-antiquoting" title="Permalink to this headline">¶</a></h5>
<p>The second way, introducing variables of type <code class="docutils literal"><span class="pre">Ploc.vala</span></code>
can be written a kind prefixed by <code class="docutils literal"><span class="pre">_</span></code>, namely here
<code class="docutils literal"><span class="pre">_flag</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; let $_flag:rf$ x = y in z &gt;&gt;
</pre></div>
</div>
<p>In that case, it corresponds to the syntax tree:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLet</span> <span class="n">loc</span> <span class="n">rf</span>
   <span class="o">...</span> <span class="p">(</span><span class="o">*</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span> <span class="o">*</span><span class="p">)</span>
</pre></div>
</div>
<p>And, therefore, the type of the variable <code class="docutils literal"><span class="pre">rf</span></code> is now
<code class="docutils literal"><span class="pre">Ploc.vala</span> <span class="pre">bool</span></code>.</p>
</div>
</div>
<div class="section" id="remarks">
<h4>Remarks<a class="headerlink" href="#remarks" title="Permalink to this headline">¶</a></h4>
<p>The first form of antiquotation ensures the compatibility with
previous versions of Camlp5. The syntax tree is <em>not</em> the
same, but the bound variables keep the same type.</p>
<p>All antiquotations kinds have these two forms: one with some name
(e.g. “flag”) and one with the same name prefixed by “a”
(e.g. “aflag”).</p>
</div>
</div>
<div class="section" id="id7">
<h3>Nodes and Quotations<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>This section describes all nodes defined in the module “MLast” of
Camlp5 and how to write them with quotations. Notice that, inside
quotations, one is not restricted to these elementary cases, but
any complex value can be used, resulting on possibly complex combined
nodes.</p>
<p>The quotation forms are described here in <a class="reference internal" href="#revsynt"><span class="std std-ref">The revised syntax</span></a> (like the
rest of this document). In reality, it depends on which quotation kit
is loaded:</p>
<ul class="simple">
<li>If <code class="docutils literal"><span class="pre">q_MLast.cmo</span></code> is used, the revised syntax is mandatory: the
quotations must be in that syntax without any extension.</li>
<li>If <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> is used, the quotation syntax <em>must</em> be in the
current user syntax with all extensions added to compile the file.</li>
</ul>
<p>Last remark: in the following tables, the variables names give
information of their types. The details can be found in the
distributed source file <code class="docutils literal"><span class="pre">mLast.mli</span></code>.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">e</span></code>, <code class="docutils literal"><span class="pre">e1</span></code>, <code class="docutils literal"><span class="pre">e2</span></code>, <code class="docutils literal"><span class="pre">e3</span></code>: <code class="docutils literal"><span class="pre">expr</span></code></li>
<li><code class="docutils literal"><span class="pre">p</span></code>, <code class="docutils literal"><span class="pre">p1</span></code>, <code class="docutils literal"><span class="pre">p2</span></code>, <code class="docutils literal"><span class="pre">p3</span></code>: <code class="docutils literal"><span class="pre">patt</span></code></li>
<li><code class="docutils literal"><span class="pre">t</span></code>, <code class="docutils literal"><span class="pre">t1</span></code>, <code class="docutils literal"><span class="pre">t2</span></code>, <code class="docutils literal"><span class="pre">e3</span></code>: <code class="docutils literal"><span class="pre">ctyp</span></code></li>
<li><code class="docutils literal"><span class="pre">s</span></code>: <code class="docutils literal"><span class="pre">string</span></code></li>
<li><code class="docutils literal"><span class="pre">b</span></code>: <code class="docutils literal"><span class="pre">bool</span></code></li>
<li><code class="docutils literal"><span class="pre">me</span></code>, <code class="docutils literal"><span class="pre">me1</span></code>, <code class="docutils literal"><span class="pre">me2</span></code>: <code class="docutils literal"><span class="pre">module_expr</span></code></li>
<li><code class="docutils literal"><span class="pre">mt</span></code>, <code class="docutils literal"><span class="pre">mt1</span></code>, <code class="docutils literal"><span class="pre">mt2</span></code>: <code class="docutils literal"><span class="pre">module_type</span></code></li>
<li><code class="docutils literal"><span class="pre">le</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">expr</span></code></li>
<li><code class="docutils literal"><span class="pre">lp</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">patt</span></code></li>
<li><code class="docutils literal"><span class="pre">lt</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">ctyp</span></code></li>
<li><code class="docutils literal"><span class="pre">ls</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">string</span></code></li>
<li><code class="docutils literal"><span class="pre">lse</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(string</span> <span class="pre">*</span> <span class="pre">expr)</span></code></li>
<li><code class="docutils literal"><span class="pre">lpe</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">expr)</span></code></li>
<li><code class="docutils literal"><span class="pre">lpp</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">patt)</span></code></li>
<li><code class="docutils literal"><span class="pre">lpoee</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">option</span> <span class="pre">expr</span> <span class="pre">*</span> <span class="pre">expr)</span></code></li>
<li><code class="docutils literal"><span class="pre">op</span></code>: <code class="docutils literal"><span class="pre">option</span> <span class="pre">patt</span></code></li>
<li><code class="docutils literal"><span class="pre">lcstri</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">class_str_item</span></code></li>
<li><code class="docutils literal"><span class="pre">lcsigi</span></code>: <code class="docutils literal"><span class="pre">list</span> <span class="pre">class_sig_item</span></code></li>
</ul>
<div class="section" id="id8">
<h4>expr<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Expressions of the language.</p>
<ul class="simple">
<li>access<ul>
<li><span class="blue">&lt;:expr&lt; $e1$ . $e2$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExAcc loc e1 e2</span></li>
</ul>
</li>
<li>antiquotation &lt;a href=”#expr_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">&lt;:expr&lt; $anti:e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExAnt loc e</span></li>
</ul>
</li>
<li>application<ul>
<li><span class="blue">&lt;:expr&lt; $e1$ $e2$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExApp loc e1 e2</span></li>
</ul>
</li>
<li>array element<ul>
<li><span class="blue">&lt;:expr&lt; $e1$ .( $e2$ ) &gt;&gt;</span></li>
<li><span class="red">MLast.ExAre loc e1 e2</span></li>
</ul>
</li>
<li>array<ul>
<li><span class="blue">&lt;:expr&lt; [| $list:le$ |] &gt;&gt;</span></li>
<li><span class="red">MLast.ExArr loc (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; [| $_list:le$ |] &gt;&gt;</span></li>
<li><span class="red">MLast.ExArr loc le</span></li>
</ul>
</li>
<li>assert<ul>
<li><span class="blue">&lt;:expr&lt; assert $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExAsr loc e</span></li>
</ul>
</li>
<li>assignment<ul>
<li><span class="blue">&lt;:expr&lt; $e1$ := $e2$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExAss loc e1 e2</span></li>
</ul>
</li>
<li>big array element<ul>
<li><span class="blue">&lt;:expr&lt; $e$ .{ $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExBae loc e (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; $e$ .{ $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExBae loc e le</span></li>
</ul>
</li>
<li>character constant<ul>
<li><span class="blue">&lt;:expr&lt; $chr:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExChr loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; $_chr:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExChr loc s</span></li>
</ul>
</li>
<li>coercion<ul>
<li><span class="blue">&lt;:expr&lt; ($e$ :&gt; $t2$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExCoe loc e None t2</span></li>
<li><span class="blue">&lt;:expr&lt; ($e$ : $t1$ :&gt; $t2$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExCoe loc e (Some t1) t2</span></li>
</ul>
</li>
<li>float constant<ul>
<li><span class="blue">&lt;:expr&lt; $flo:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExFlo loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; $_flo:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExFlo loc s</span></li>
</ul>
</li>
<li>for (increasing)<ul>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ to $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 (Ploc.VaVal True) (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ to $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 (Ploc.VaVal True) le</span></li>
</ul>
</li>
<li>for (decreasing)<ul>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ downto $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 (Ploc.VaVal False) (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ downto $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 (Ploc.VaVal False) le</span></li>
</ul>
</li>
<li>for<ul>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ $to:b$ $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 (Ploc.VaVal b) (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ $to:b$ $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 (Ploc.VaVal b) le</span></li>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ $_to:b$ $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 b (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $lid:s$ = $e1$ $_to:b$ $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc (Ploc.VaVal s) e1 e2 b le</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ to $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 (Ploc.VaVal True) (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ to $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 (Ploc.VaVal True) le</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ downto $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 (Ploc.VaVal False) (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ downto $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 (Ploc.VaVal False) le</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ $to:b$ $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 (Ploc.VaVal b) (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ $to:b$ $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 (Ploc.VaVal b) le</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ $_to:b$ $e2$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 b (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; for $_lid:s$ = $e1$ $_to:b$ $e2$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExFor loc s e1 e2 b le</span></li>
</ul>
</li>
<li>function<ul>
<li><span class="blue">&lt;:expr&lt; fun [ $list:lpee$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExFun loc (Ploc.VaVal lpee)</span></li>
<li><span class="blue">&lt;:expr&lt; fun [ $_list:lpee$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExFun loc lpee</span></li>
</ul>
</li>
<li>if<ul>
<li><span class="blue">&lt;:expr&lt; if $e1$ then $e2$ else $e3$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExIfe loc e1 e2 e3</span></li>
</ul>
</li>
<li>integer constant<ul>
<li><span class="blue">&lt;:expr&lt; $int:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc (Ploc.VaVal s1) “”</span></li>
<li><span class="blue">&lt;:expr&lt; $_int:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc s1 “”</span></li>
</ul>
</li>
<li>integer 32 bits<ul>
<li><span class="blue">&lt;:expr&lt; $int32:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc (Ploc.VaVal s1) “l”</span></li>
<li><span class="blue">&lt;:expr&lt; $_int32:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc s1 “l”</span></li>
</ul>
</li>
<li>integer 64 bits<ul>
<li><span class="blue">&lt;:expr&lt; $int64:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc (Ploc.VaVal s1) “L”</span></li>
<li><span class="blue">&lt;:expr&lt; $_int64:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc s1 “L”</span></li>
</ul>
</li>
<li>native integer<ul>
<li><span class="blue">&lt;:expr&lt; $nativeint:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc (Ploc.VaVal s1) “n”</span></li>
<li><span class="blue">&lt;:expr&lt; $_nativeint:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExInt loc s1 “n”</span></li>
</ul>
</li>
<li>label<ul>
<li><span class="blue">&lt;:expr&lt; ~{$p$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExLab loc p (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:expr&lt; ~{$p$ = $e$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExLab loc p (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:expr&lt; ~{$p$ $opt:oe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExLab loc p (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:expr&lt; ~{$p$ $_opt:oe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExLab loc p oe</span></li>
</ul>
</li>
<li>lazy<ul>
<li><span class="blue">&lt;:expr&lt; lazy $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLaz loc e</span></li>
</ul>
</li>
<li>let rec<ul>
<li><span class="blue">&lt;:expr&lt; let rec $list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc (Ploc.VaVal True) (Ploc.VaVal lpe) e</span></li>
<li><span class="blue">&lt;:expr&lt; let rec $_list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc (Ploc.VaVal True) lpe e</span></li>
</ul>
</li>
<li>let not rec<ul>
<li><span class="blue">&lt;:expr&lt; let $list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc (Ploc.VaVal False) (Ploc.VaVal lpe) e</span></li>
<li><span class="blue">&lt;:expr&lt; let $_list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc (Ploc.VaVal False) lpe e</span></li>
</ul>
</li>
<li>let<ul>
<li><span class="blue">&lt;:expr&lt; let $flag:b$ $list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc (Ploc.VaVal b) (Ploc.VaVal lpe) e</span></li>
<li><span class="blue">&lt;:expr&lt; let $flag:b$ $_list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc (Ploc.VaVal b) lpe e</span></li>
<li><span class="blue">&lt;:expr&lt; let $_flag:b$ $list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc b (Ploc.VaVal lpe) e</span></li>
<li><span class="blue">&lt;:expr&lt; let $_flag:b$ $_list:lpe$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLet loc b lpe e</span></li>
</ul>
</li>
<li>lowercase identifier<ul>
<li><span class="blue">&lt;:expr&lt; $lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; $_lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLid loc s</span></li>
</ul>
</li>
<li>let module<ul>
<li><span class="blue">&lt;:expr&lt; let module $uid:s$ = $me$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLmd loc (Ploc.VaVal s) me e</span></li>
<li><span class="blue">&lt;:expr&lt; let module $_uid:s$ = $me$ in $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExLmd loc s me e</span></li>
</ul>
</li>
<li>match<ul>
<li><span class="blue">&lt;:expr&lt; match $e$ with [ $list:lpee$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExMat loc e (Ploc.VaVal lpee)</span></li>
<li><span class="blue">&lt;:expr&lt; match $e$ with [ $_list:lpee$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExMat loc e lpee</span></li>
</ul>
</li>
<li>new<ul>
<li><span class="blue">&lt;:expr&lt; new $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExNew loc (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:expr&lt; new $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExNew loc ls</span></li>
</ul>
</li>
<li>object expression<ul>
<li><span class="blue">&lt;:expr&lt; object $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc (Ploc.VaVal None) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:expr&lt; object $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc (Ploc.VaVal None) lcsi</span></li>
<li><span class="blue">&lt;:expr&lt; object ($p$) $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc (Ploc.VaVal (Some p)) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:expr&lt; object ($p$) $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc (Ploc.VaVal (Some p)) lcsi</span></li>
<li><span class="blue">&lt;:expr&lt; object $opt:op$ $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc (Ploc.VaVal op) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:expr&lt; object $opt:op$ $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc (Ploc.VaVal op) lcsi</span></li>
<li><span class="blue">&lt;:expr&lt; object $_opt:op$ $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc op (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:expr&lt; object $_opt:op$ $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.ExObj loc op lcsi</span></li>
</ul>
</li>
<li>option label<ul>
<li><span class="blue">&lt;:expr&lt; ?{$p$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExOlb loc p (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:expr&lt; ?{$p$ = $e$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExOlb loc p (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:expr&lt; ?{$p$ $opt:oe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExOlb loc p (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:expr&lt; ?{$p$ $_opt:oe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExOlb loc p oe</span></li>
</ul>
</li>
<li>override<ul>
<li><span class="blue">&lt;:expr&lt; {&lt; $list:lse$ &gt;} &gt;&gt;</span></li>
<li><span class="red">MLast.ExOvr loc (Ploc.VaVal lse)</span></li>
<li><span class="blue">&lt;:expr&lt; {&lt; $_list:lse$ &gt;} &gt;&gt;</span></li>
<li><span class="red">MLast.ExOvr loc lse</span></li>
</ul>
</li>
<li>module packing<ul>
<li><span class="blue">&lt;:expr&lt; (module $me$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExPck loc me None</span></li>
<li><span class="blue">&lt;:expr&lt; (module $me$ : $mt$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExPck loc me (Some mt)</span></li>
</ul>
</li>
<li>record<ul>
<li><span class="blue">&lt;:expr&lt; {$list:lpe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExRec loc (Ploc.VaVal lpe) None</span></li>
<li><span class="blue">&lt;:expr&lt; {($e$) with $list:lpe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExRec loc (Ploc.VaVal lpe) (Some e)</span></li>
<li><span class="blue">&lt;:expr&lt; {$_list:lpe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExRec loc lpe None</span></li>
<li><span class="blue">&lt;:expr&lt; {($e$) with $_list:lpe$} &gt;&gt;</span></li>
<li><span class="red">MLast.ExRec loc lpe (Some e)</span></li>
</ul>
</li>
<li>sequence<ul>
<li><span class="blue">&lt;:expr&lt; do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExSeq loc (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExSeq loc le</span></li>
</ul>
</li>
<li>method call<ul>
<li><span class="blue">&lt;:expr&lt; $e$ # $s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExSnd loc e (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; $e$ # $_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExSnd loc e s</span></li>
</ul>
</li>
<li>string element<ul>
<li><span class="blue">&lt;:expr&lt; $e1$ .[ $e2$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExSte loc e1 e2</span></li>
</ul>
</li>
<li>string<ul>
<li><span class="blue">&lt;:expr&lt; $str:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExStr loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; $_str:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExStr loc s</span></li>
</ul>
</li>
<li>try<ul>
<li><span class="blue">&lt;:expr&lt; try $e$ with [ $list:lpee$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExTry loc e (Ploc.VaVal lpee)</span></li>
<li><span class="blue">&lt;:expr&lt; try $e$ with [ $_list:lpee$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.ExTry loc e lpee</span></li>
</ul>
</li>
<li>t-uple<ul>
<li><span class="blue">&lt;:expr&lt; ($list:le$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExTup loc (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; ($_list:le$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExTup loc le</span></li>
</ul>
</li>
<li>type constraint<ul>
<li><span class="blue">&lt;:expr&lt; ($e$ : $t$) &gt;&gt;</span></li>
<li><span class="red">MLast.ExTyc loc e t</span></li>
</ul>
</li>
<li>uppercase identifier<ul>
<li><span class="blue">&lt;:expr&lt; $uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExUid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; $_uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExUid loc s</span></li>
</ul>
</li>
<li>variant<ul>
<li><span class="blue">&lt;:expr&lt; ` $s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExVrn loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:expr&lt; ` $_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.ExVrn loc s</span></li>
</ul>
</li>
<li>while<ul>
<li><span class="blue">&lt;:expr&lt; while $e$ do { $list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExWhi loc e (Ploc.VaVal le)</span></li>
<li><span class="blue">&lt;:expr&lt; while $e$ do { $_list:le$ } &gt;&gt;</span></li>
<li><span class="red">MLast.ExWhi loc e le</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#expr_2”&gt;(2)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.ExXtr loc s oe</span></li>
</ul>
</li>
</ul>
<p>1. Node used in the quotation expanders to tells at conversion to
OCaml compiler syntax tree time, that all locations of the
sub-tree is correcty located in the quotation. By default, in
quotations, the locations of all generated nodes are the location
of the whole quotation. This node allows to make an exception to
this rule, since we know that the antiquotation belongs to the
universe of the enclosing program. See the chapter
about <a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a> and, in particular, its
section about antiquotations.</p>
<p>2. Extra node internally used by the quotation kit
<code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to build antiquotations of expressions.</p>
</div>
<div class="section" id="id9">
<h4>patt<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>Patterns of the language.</p>
<ul class="simple">
<li>access<ul>
<li><span class="blue">&lt;:patt&lt; $p1$ . $p2$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaAcc loc p1 p2</span></li>
</ul>
</li>
<li>alias<ul>
<li><span class="blue">&lt;:patt&lt; ($p1$ as $p2$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaAli loc p1 p2</span></li>
</ul>
</li>
<li>antiquotation &lt;a href=”#patt_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">&lt;:patt&lt; $anti:p$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaAnt loc p</span></li>
</ul>
</li>
<li>wildcard<ul>
<li><span class="blue">&lt;:patt&lt; _ &gt;&gt;</span></li>
<li><span class="red">MLast.PaAny loc</span></li>
</ul>
</li>
<li>application<ul>
<li><span class="blue">&lt;:patt&lt; $p1$ $p2$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaApp loc p1 p2</span></li>
</ul>
</li>
<li>array<ul>
<li><span class="blue">&lt;:patt&lt; [| $list:lp$ |] &gt;&gt;</span></li>
<li><span class="red">MLast.PaArr loc (Ploc.VaVal lp)</span></li>
<li><span class="blue">&lt;:patt&lt; [| $_list:lp$ |] &gt;&gt;</span></li>
<li><span class="red">MLast.PaArr loc lp</span></li>
</ul>
</li>
<li>character<ul>
<li><span class="blue">&lt;:patt&lt; $chr:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaChr loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; $_chr:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaChr loc s</span></li>
</ul>
</li>
<li>float<ul>
<li><span class="blue">&lt;:patt&lt; $flo:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaFlo loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; $_flo:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaFlo loc s</span></li>
</ul>
</li>
<li>integer constant<ul>
<li><span class="blue">&lt;:patt&lt; $int:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc (Ploc.VaVal s1) “”</span></li>
<li><span class="blue">&lt;:patt&lt; $_int:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc s1 “”</span></li>
</ul>
</li>
<li>integer 32 bits<ul>
<li><span class="blue">&lt;:patt&lt; $int32:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc (Ploc.VaVal s1) “l”</span></li>
<li><span class="blue">&lt;:patt&lt; $_int32:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc s1 “l”</span></li>
</ul>
</li>
<li>integer 64 bits<ul>
<li><span class="blue">&lt;:patt&lt; $int64:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc (Ploc.VaVal s1) “L”</span></li>
<li><span class="blue">&lt;:patt&lt; $_int64:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc s1 “L”</span></li>
</ul>
</li>
<li>native integer<ul>
<li><span class="blue">&lt;:patt&lt; $nativeint:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc (Ploc.VaVal s1) “n”</span></li>
<li><span class="blue">&lt;:patt&lt; $_nativeint:s1$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaInt loc s1 “n”</span></li>
</ul>
</li>
<li>label<ul>
<li><span class="blue">&lt;:patt&lt; ~{$p1$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaLab loc p1 (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:patt&lt; ~{$p1$ = $p2$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaLab loc p1 (Ploc.VaVal (Some p2))</span></li>
<li><span class="blue">&lt;:patt&lt; ~{$p1$ $opt:op2$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaLab loc p1 (Ploc.VaVal op2)</span></li>
<li><span class="blue">&lt;:patt&lt; ~{$p1$ $_opt:op2$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaLab loc p1 op2</span></li>
</ul>
</li>
<li>lazy<ul>
<li><span class="blue">&lt;:patt&lt; lazy $p$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaLaz loc p</span></li>
</ul>
</li>
<li>lowercase identifier<ul>
<li><span class="blue">&lt;:patt&lt; $lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaLid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; $_lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaLid loc s</span></li>
</ul>
</li>
<li>new type<ul>
<li><span class="blue">&lt;:patt&lt; (type $lid:s$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaNty loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; (type $_lid:s$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaNty loc s</span></li>
</ul>
</li>
<li>option label<ul>
<li><span class="blue">&lt;:patt&lt; ?{$p$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaOlb loc p (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:patt&lt; ?{$p$ = $e$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaOlb loc p (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:patt&lt; ?{$p$ $opt:oe$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaOlb loc p (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:patt&lt; ?{$p$ $_opt:oe$} &gt;&gt;</span></li>
<li><span class="red">MLast.PaOlb loc p oe</span></li>
</ul>
</li>
<li>or<ul>
<li><span class="blue">&lt;:patt&lt; $p1$ | $p2$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaOrp loc p1 p2</span></li>
</ul>
</li>
<li>record<ul>
<li><span class="blue">&lt;:patt&lt; { $list:lpp$ } &gt;&gt;</span></li>
<li><span class="red">MLast.PaRec loc (Ploc.VaVal lpp)</span></li>
<li><span class="blue">&lt;:patt&lt; { $_list:lpp$ } &gt;&gt;</span></li>
<li><span class="red">MLast.PaRec loc lpp</span></li>
</ul>
</li>
<li>range<ul>
<li><span class="blue">&lt;:patt&lt; $p1$ .. $p2$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaRng loc p1 p2</span></li>
</ul>
</li>
<li>string<ul>
<li><span class="blue">&lt;:patt&lt; $str:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaStr loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; $_str:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaStr loc s</span></li>
</ul>
</li>
<li>t-uple<ul>
<li><span class="blue">&lt;:patt&lt; ($list:lp$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaTup loc (Ploc.VaVal lp)</span></li>
<li><span class="blue">&lt;:patt&lt; ($_list:lp$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaTup loc lp</span></li>
</ul>
</li>
<li>type constraint<ul>
<li><span class="blue">&lt;:patt&lt; ($p$ : $t$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaTyc loc p t</span></li>
</ul>
</li>
<li>type pattern<ul>
<li><span class="blue">&lt;:patt&lt; # $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaTyp loc (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:patt&lt; # $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaTyp loc ls</span></li>
</ul>
</li>
<li>uppercase identifier<ul>
<li><span class="blue">&lt;:patt&lt; $uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaUid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; $_uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaUid loc s</span></li>
</ul>
</li>
<li>module unpacking<ul>
<li><span class="blue">&lt;:patt&lt; (module $uid:s$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaUnp loc (Ploc.VaVal s) None</span></li>
<li><span class="blue">&lt;:patt&lt; (module $uid:s$ : $mt$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaUnp loc (Ploc.VaVal s) (Some mt)</span></li>
<li><span class="blue">&lt;:patt&lt; (module $_uid:s$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaUnp loc s None</span></li>
<li><span class="blue">&lt;:patt&lt; (module $_uid:s$ : $mt$) &gt;&gt;</span></li>
<li><span class="red">MLast.PaUnp loc s (Some mt)</span></li>
</ul>
</li>
<li>variant<ul>
<li><span class="blue">&lt;:patt&lt; ` $s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaVrn loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:patt&lt; ` $_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PaVrn loc s</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#patt_2”&gt;(2)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.PaXtr loc s op</span></li>
</ul>
</li>
</ul>
<p>1. Node used to specify an antiquotation area, like for the equivalent
node in expressions. See above.</p>
<p>2. Extra node internally used by the quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to
build antiquotations of patterns.</p>
</div>
<div class="section" id="id10">
<h4>ctyp<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Type expressions of the language.</p>
<ul class="simple">
<li>access<ul>
<li><span class="blue">&lt;:ctyp&lt; $t1$ . $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyAcc loc t1 t2</span></li>
</ul>
</li>
<li>alias<ul>
<li><span class="blue">&lt;:ctyp&lt; $t1$ as $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyAli loc t1 t2</span></li>
</ul>
</li>
<li>wildcard<ul>
<li><span class="blue">&lt;:ctyp&lt; _ &gt;&gt;</span></li>
<li><span class="red">MLast.TyAny loc</span></li>
</ul>
</li>
<li>application<ul>
<li><span class="blue">&lt;:ctyp&lt; $t1$ $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyApp loc t1 t2</span></li>
</ul>
</li>
<li>arrow<ul>
<li><span class="blue">&lt;:ctyp&lt; $t1$ -&gt; $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyArr loc t1 t2</span></li>
</ul>
</li>
<li>class<ul>
<li><span class="blue">&lt;:ctyp&lt; # $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyCls loc (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:ctyp&lt; # $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyCls loc ls</span></li>
</ul>
</li>
<li>label<ul>
<li><span class="blue">&lt;:ctyp&lt; ~$s$: $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyLab loc (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:ctyp&lt; ~$_:s$: $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyLab loc s t</span></li>
</ul>
</li>
<li>lowercase identifier<ul>
<li><span class="blue">&lt;:ctyp&lt; $lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyLid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:ctyp&lt; $_lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyLid loc s</span></li>
</ul>
</li>
<li>manifest<ul>
<li><span class="blue">&lt;:ctyp&lt; $t1$ == private $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyMan loc t1 (Ploc.VaVal True) t2</span></li>
<li><span class="blue">&lt;:ctyp&lt; $t1$ == $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyMan loc t1 (Ploc.VaVal False) t2</span></li>
<li><span class="blue">&lt;:ctyp&lt; $t1$ == $priv:b$ $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyMan loc t1 (Ploc.VaVal b) t2</span></li>
<li><span class="blue">&lt;:ctyp&lt; $t1$ == $_priv:b$ $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyMan loc t1 b t2</span></li>
</ul>
</li>
<li>object<ul>
<li><span class="blue">&lt;:ctyp&lt; &lt; $list:lst$ .. &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc (Ploc.VaVal lst) (Ploc.VaVal True)</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $list:lst$ &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc (Ploc.VaVal lst) (Ploc.VaVal False)</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $list:lst$ $flag:b$ &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc (Ploc.VaVal lst) (Ploc.VaVal b)</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $list:lst$ $_flag:b$ &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc (Ploc.VaVal lst) b</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $_list:lst$ .. &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc lst (Ploc.VaVal True)</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $_list:lst$ &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc lst (Ploc.VaVal False)</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $_list:lst$ $flag:b$ &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc lst (Ploc.VaVal b)</span></li>
<li><span class="blue">&lt;:ctyp&lt; &lt; $_list:lst$ $_flag:b$ &gt; &gt;&gt;</span></li>
<li><span class="red">MLast.TyObj loc lst b</span></li>
</ul>
</li>
<li>option label<ul>
<li><span class="blue">&lt;:ctyp&lt; ?$s$: $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyOlb loc (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:ctyp&lt; ?$_:s$: $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyOlb loc s t</span></li>
</ul>
</li>
<li>package<ul>
<li><span class="blue">&lt;:ctyp&lt; (module $mt$) &gt;&gt;</span></li>
<li><span class="red">MLast.TyPck loc mt</span></li>
</ul>
</li>
<li>polymorph<ul>
<li><span class="blue">&lt;:ctyp&lt; ! $list:ls$ . $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyPol loc (Ploc.VaVal ls) t</span></li>
<li><span class="blue">&lt;:ctyp&lt; ! $_list:ls$ . $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyPol loc ls t</span></li>
</ul>
</li>
<li>variable<ul>
<li><span class="blue">&lt;:ctyp&lt; ‘$s$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyQuo loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:ctyp&lt; ‘$_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyQuo loc s</span></li>
</ul>
</li>
<li>record<ul>
<li><span class="blue">&lt;:ctyp&lt; { $list:llsbt$ } &gt;&gt;</span></li>
<li><span class="red">MLast.TyRec loc (Ploc.VaVal llsbt)</span></li>
<li><span class="blue">&lt;:ctyp&lt; { $_list:llsbt$ } &gt;&gt;</span></li>
<li><span class="red">MLast.TyRec loc llsbt</span></li>
</ul>
</li>
<li>sum<ul>
<li><span class="blue">&lt;:ctyp&lt; [ $list:llslt$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TySum loc (Ploc.VaVal llslt)</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ $_list:llslt$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TySum loc llslt</span></li>
</ul>
</li>
<li>t-uple<ul>
<li><span class="blue">&lt;:ctyp&lt; ( $list:lt$ ) &gt;&gt;</span></li>
<li><span class="red">MLast.TyTup loc (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:ctyp&lt; ( $_list:lt$ ) &gt;&gt;</span></li>
<li><span class="red">MLast.TyTup loc lt</span></li>
</ul>
</li>
<li>uppercase identifier<ul>
<li><span class="blue">&lt;:ctyp&lt; $uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyUid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:ctyp&lt; $_uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.TyUid loc s</span></li>
</ul>
</li>
<li>variant<ul>
<li><span class="blue">&lt;:ctyp&lt; [ = $list:lpv$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc (Ploc.VaVal lpv) None</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &gt; $list:lpv$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc (Ploc.VaVal lpv) (Some None)</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &lt; $list:lpv$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc (Ploc.VaVal lpv) (Some (Some (Ploc.VaVal [])))</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &lt; $list:lpv$ &gt; $list:ls$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc (Ploc.VaVal lpv) (Some (Some (Ploc.VaVal ls)))</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &lt; $list:lpv$ &gt; $_list:ls$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc (Ploc.VaVal lpv) (Some (Some ls))</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ = $_list:lpv$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc lpv None</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &gt; $_list:lpv$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc lpv (Some None)</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &lt; $_list:lpv$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc lpv (Some (Some (Ploc.VaVal [])))</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &lt; $_list:lpv$ &gt; $list:ls$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc lpv (Some (Some (Ploc.VaVal ls)))</span></li>
<li><span class="blue">&lt;:ctyp&lt; [ &lt; $_list:lpv$ &gt; $_list:ls$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.TyVrn loc lpv (Some (Some ls))</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#ctyp_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.TyXtr loc s ot</span></li>
</ul>
</li>
</ul>
<p>1. Extra node internally used by the quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to
build antiquotations of types.</p>
</div>
<div class="section" id="id11">
<h4>modules…<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id12">
<h5>str_item<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h5>
<p>Structure items, i.e. phrases in a “.ml” file or “struct”
elements.</p>
<ul class="simple">
<li>class declaration<ul>
<li><span class="blue">&lt;:str_item&lt; class $list:lcice$ &gt;&gt;</span></li>
<li><span class="red">MLast.StCls loc (Ploc.VaVal lcice)</span></li>
<li><span class="blue">&lt;:str_item&lt; class $_list:lcice$ &gt;&gt;</span></li>
<li><span class="red">MLast.StCls loc lcice</span></li>
</ul>
</li>
<li>class type declaration<ul>
<li><span class="blue">&lt;:str_item&lt; class type $list:lcict$ &gt;&gt;</span></li>
<li><span class="red">MLast.StClt loc (Ploc.VaVal lcict)</span></li>
<li><span class="blue">&lt;:str_item&lt; class type $_list:lcict$ &gt;&gt;</span></li>
<li><span class="red">MLast.StClt loc lcict</span></li>
</ul>
</li>
<li>declare<ul>
<li><span class="blue">&lt;:str_item&lt; declare $list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.StDcl loc (Ploc.VaVal lsi)</span></li>
<li><span class="blue">&lt;:str_item&lt; declare $_list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.StDcl loc lsi</span></li>
</ul>
</li>
<li>directive<ul>
<li><span class="blue">&lt;:str_item&lt; # $lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc (Ploc.VaVal s) (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:str_item&lt; # $lid:s$ $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc (Ploc.VaVal s) (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:str_item&lt; # $lid:s$ $opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc (Ploc.VaVal s) (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:str_item&lt; # $lid:s$ $_opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc (Ploc.VaVal s) oe</span></li>
<li><span class="blue">&lt;:str_item&lt; # $_lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc s (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:str_item&lt; # $_lid:s$ $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc s (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:str_item&lt; # $_lid:s$ $opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc s (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:str_item&lt; # $_lid:s$ $_opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StDir loc s oe</span></li>
</ul>
</li>
<li>exception<ul>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) (Ploc.VaVal []) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ of $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) (Ploc.VaVal lt) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) (Ploc.VaVal []) (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ of $list:lt$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) (Ploc.VaVal lt) (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) (Ploc.VaVal []) ls</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ of $list:lt$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) (Ploc.VaVal lt) ls</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ of $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) lt (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ of $_list:lt$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) lt (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $uid:s$ of $_list:lt$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc (Ploc.VaVal s) lt ls</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s (Ploc.VaVal []) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ of $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s (Ploc.VaVal lt) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s (Ploc.VaVal []) (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ of $list:lt$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s (Ploc.VaVal lt) (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s (Ploc.VaVal []) ls</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ of $list:lt$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s (Ploc.VaVal lt) ls</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ of $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s lt (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ of $_list:lt$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s lt (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; exception $_uid:s$ of $_list:lt$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExc loc s lt ls</span></li>
</ul>
</li>
<li>expression<ul>
<li><span class="blue">&lt;:str_item&lt; $exp:e$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExp loc e</span></li>
</ul>
</li>
<li>external<ul>
<li><span class="blue">&lt;:str_item&lt; external $s$ : $t$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExt loc (Ploc.VaVal s) t (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; external $s$ : $t$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExt loc (Ploc.VaVal s) t ls</span></li>
<li><span class="blue">&lt;:str_item&lt; external $_:s$ : $t$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExt loc s t (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; external $_:s$ : $t$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StExt loc s t ls</span></li>
</ul>
</li>
<li>include<ul>
<li><span class="blue">&lt;:str_item&lt; include $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.StInc loc me</span></li>
</ul>
</li>
<li>module rec<ul>
<li><span class="blue">&lt;:str_item&lt; module rec $list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc (Ploc.VaVal True) (Ploc.VaVal lsme)</span></li>
<li><span class="blue">&lt;:str_item&lt; module rec $_list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc (Ploc.VaVal True) lsme</span></li>
</ul>
</li>
<li>module non rec<ul>
<li><span class="blue">&lt;:str_item&lt; module $list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc (Ploc.VaVal False) (Ploc.VaVal lsme)</span></li>
<li><span class="blue">&lt;:str_item&lt; module $_list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc (Ploc.VaVal False) lsme</span></li>
</ul>
</li>
<li>module<ul>
<li><span class="blue">&lt;:str_item&lt; module $flag:b$ $list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc (Ploc.VaVal b) (Ploc.VaVal lsme)</span></li>
<li><span class="blue">&lt;:str_item&lt; module $flag:b$ $_list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc (Ploc.VaVal b) lsme</span></li>
<li><span class="blue">&lt;:str_item&lt; module $_flag:b$ $list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc b (Ploc.VaVal lsme)</span></li>
<li><span class="blue">&lt;:str_item&lt; module $_flag:b$ $_list:lsme$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMod loc b lsme</span></li>
</ul>
</li>
<li>module type<ul>
<li><span class="blue">&lt;:str_item&lt; module type $s$ = $mt$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMty loc (Ploc.VaVal s) mt</span></li>
<li><span class="blue">&lt;:str_item&lt; module type $_:s$ = $mt$ &gt;&gt;</span></li>
<li><span class="red">MLast.StMty loc s mt</span></li>
</ul>
</li>
<li>open<ul>
<li><span class="blue">&lt;:str_item&lt; open $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StOpn loc (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:str_item&lt; open $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.StOpn loc ls</span></li>
</ul>
</li>
<li>type declaration<ul>
<li><span class="blue">&lt;:str_item&lt; type $list:ltd$ &gt;&gt;</span></li>
<li><span class="red">MLast.StTyp loc (Ploc.VaVal ltd)</span></li>
<li><span class="blue">&lt;:str_item&lt; type $_list:ltd$ &gt;&gt;</span></li>
<li><span class="red">MLast.StTyp loc ltd</span></li>
</ul>
</li>
<li>… internal use … &lt;a href=”#t_str_item_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">&lt;:str_item&lt; # $str:s$ $list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.StUse loc (Ploc.VaVal s) (Ploc.VaVal lsil)</span></li>
<li><span class="blue">&lt;:str_item&lt; # $str:s$ $_list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.StUse loc (Ploc.VaVal s) lsil</span></li>
<li><span class="blue">&lt;:str_item&lt; # $_str:s$ $list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.StUse loc s (Ploc.VaVal lsil)</span></li>
<li><span class="blue">&lt;:str_item&lt; # $_str:s$ $_list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.StUse loc s lsil</span></li>
</ul>
</li>
<li>value rec<ul>
<li><span class="blue">&lt;:str_item&lt; value rec $list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc (Ploc.VaVal True) (Ploc.VaVal lpe)</span></li>
<li><span class="blue">&lt;:str_item&lt; value rec $_list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc (Ploc.VaVal True) lpe</span></li>
</ul>
</li>
<li>value non rec<ul>
<li><span class="blue">&lt;:str_item&lt; value $list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc (Ploc.VaVal False) (Ploc.VaVal lpe)</span></li>
<li><span class="blue">&lt;:str_item&lt; value $_list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc (Ploc.VaVal False) lpe</span></li>
</ul>
</li>
<li>value<ul>
<li><span class="blue">&lt;:str_item&lt; value $flag:b$ $list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc (Ploc.VaVal b) (Ploc.VaVal lpe)</span></li>
<li><span class="blue">&lt;:str_item&lt; value $flag:b$ $_list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc (Ploc.VaVal b) lpe</span></li>
<li><span class="blue">&lt;:str_item&lt; value $_flag:b$ $list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc b (Ploc.VaVal lpe)</span></li>
<li><span class="blue">&lt;:str_item&lt; value $_flag:b$ $_list:lpe$ &gt;&gt;</span></li>
<li><span class="red">MLast.StVal loc b lpe</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#str_item_2”&gt;(2)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.StXtr loc s ot</span></li>
</ul>
</li>
</ul>
<p>1. Node internally used to specify a different file name applying to
the whole subtree. This is generated by the directive “use” and
used when converting to the OCaml syntax tree which needs the file
name in its location type.</p>
<p>2. Extra node internally used by the quotation kit
<code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to build antiquotations of structure
items.</p>
</div>
<div class="section" id="id13">
<h5>sig_item<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h5>
<p>Signature items, i.e. phrases in a “.mli” file or elements
inside “sig … end”.</p>
<ul class="simple">
<li>class<ul>
<li><span class="blue">&lt;:sig_item&lt; class $list:lcict$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgCls loc (Ploc.VaVal lcict)</span></li>
<li><span class="blue">&lt;:sig_item&lt; class $_list:lcict$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgCls loc lcict</span></li>
</ul>
</li>
<li>class type<ul>
<li><span class="blue">&lt;:sig_item&lt; class type $list:lcict$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgClt loc (Ploc.VaVal lcict)</span></li>
<li><span class="blue">&lt;:sig_item&lt; class type $_list:lcict$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgClt loc lcict</span></li>
</ul>
</li>
<li>declare<ul>
<li><span class="blue">&lt;:sig_item&lt; declare $list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.SgDcl loc (Ploc.VaVal lsi)</span></li>
<li><span class="blue">&lt;:sig_item&lt; declare $_list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.SgDcl loc lsi</span></li>
</ul>
</li>
<li>directive<ul>
<li><span class="blue">&lt;:sig_item&lt; # $lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc (Ploc.VaVal s) (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $lid:s$ $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc (Ploc.VaVal s) (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $lid:s$ $opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc (Ploc.VaVal s) (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $lid:s$ $_opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc (Ploc.VaVal s) oe</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $_lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc s (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $_lid:s$ $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc s (Ploc.VaVal (Some e))</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $_lid:s$ $opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc s (Ploc.VaVal oe)</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $_lid:s$ $_opt:oe$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgDir loc s oe</span></li>
</ul>
</li>
<li>exception<ul>
<li><span class="blue">&lt;:sig_item&lt; exception $s$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExc loc (Ploc.VaVal s) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:sig_item&lt; exception $s$ of $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExc loc (Ploc.VaVal s) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:sig_item&lt; exception $s$ of $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExc loc (Ploc.VaVal s) lt</span></li>
<li><span class="blue">&lt;:sig_item&lt; exception $_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExc loc s (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:sig_item&lt; exception $_:s$ of $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExc loc s (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:sig_item&lt; exception $_:s$ of $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExc loc s lt</span></li>
</ul>
</li>
<li>external<ul>
<li><span class="blue">&lt;:sig_item&lt; external $s$ : $t$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExt loc (Ploc.VaVal s) t (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:sig_item&lt; external $s$ : $t$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExt loc (Ploc.VaVal s) t ls</span></li>
<li><span class="blue">&lt;:sig_item&lt; external $_:s$ : $t$ = $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExt loc s t (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:sig_item&lt; external $_:s$ : $t$ = $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgExt loc s t ls</span></li>
</ul>
</li>
<li>include<ul>
<li><span class="blue">&lt;:sig_item&lt; include $mt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgInc loc mt</span></li>
</ul>
</li>
<li>module rec<ul>
<li><span class="blue">&lt;:sig_item&lt; module rec $list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc (Ploc.VaVal True) (Ploc.VaVal lsmt)</span></li>
<li><span class="blue">&lt;:sig_item&lt; module rec $_list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc (Ploc.VaVal True) lsmt</span></li>
</ul>
</li>
<li>module non rec<ul>
<li><span class="blue">&lt;:sig_item&lt; module $list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc (Ploc.VaVal False) (Ploc.VaVal lsmt)</span></li>
<li><span class="blue">&lt;:sig_item&lt; module $_list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc (Ploc.VaVal False) lsmt</span></li>
</ul>
</li>
<li>module<ul>
<li><span class="blue">&lt;:sig_item&lt; module $flag:b$ $list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc (Ploc.VaVal b) (Ploc.VaVal lsmt)</span></li>
<li><span class="blue">&lt;:sig_item&lt; module $flag:b$ $_list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc (Ploc.VaVal b) lsmt</span></li>
<li><span class="blue">&lt;:sig_item&lt; module $_flag:b$ $list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc b (Ploc.VaVal lsmt)</span></li>
<li><span class="blue">&lt;:sig_item&lt; module $_flag:b$ $_list:lsmt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMod loc b lsmt</span></li>
</ul>
</li>
<li>module type<ul>
<li><span class="blue">&lt;:sig_item&lt; module type $s$ = $mt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMty loc (Ploc.VaVal s) mt</span></li>
<li><span class="blue">&lt;:sig_item&lt; module type $_:s$ = $mt$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgMty loc s mt</span></li>
</ul>
</li>
<li>open<ul>
<li><span class="blue">&lt;:sig_item&lt; open $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgOpn loc (Ploc.VaVal ls)</span></li>
<li><span class="blue">&lt;:sig_item&lt; open $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgOpn loc ls</span></li>
</ul>
</li>
<li>type declaration<ul>
<li><span class="blue">&lt;:sig_item&lt; type $list:ltd$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgTyp loc (Ploc.VaVal ltd)</span></li>
<li><span class="blue">&lt;:sig_item&lt; type $_list:ltd$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgTyp loc ltd</span></li>
</ul>
</li>
<li>… internal use … &lt;a href=”#t_sig_item_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">&lt;:sig_item&lt; # $str:s$ $list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgUse loc (Ploc.VaVal s) (Ploc.VaVal lsil)</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $str:s$ $_list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgUse loc (Ploc.VaVal s) lsil</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $_str:s$ $list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgUse loc s (Ploc.VaVal lsil)</span></li>
<li><span class="blue">&lt;:sig_item&lt; # $_str:s$ $_list:lsil$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgUse loc s lsil</span></li>
</ul>
</li>
<li>value<ul>
<li><span class="blue">&lt;:sig_item&lt; value $s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgVal loc (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:sig_item&lt; value $_:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.SgVal loc s t</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#sig_item_2”&gt;(2)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.SgXtr loc s ot</span></li>
</ul>
</li>
</ul>
<ol class="arabic simple">
<li>Same remark as for <code class="docutils literal"><span class="pre">str_item</span></code> above.</li>
</ol>
<p>2. Extra node internally used by the quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to
build antiquotations of signature items.</p>
</div>
<div class="section" id="id14">
<h5>module_expr<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>access<ul>
<li><span class="blue">&lt;:module_expr&lt; $me1$ . $me2$ &gt;&gt;</span></li>
<li><span class="red">MLast.MeAcc loc me1 me2</span></li>
</ul>
</li>
<li>application<ul>
<li><span class="blue">&lt;:module_expr&lt; $me1$ $me2$ &gt;&gt;</span></li>
<li><span class="red">MLast.MeApp loc me1 me2</span></li>
</ul>
</li>
<li>functor<ul>
<li><span class="blue">&lt;:module_expr&lt; functor ($s$ : $mt$) -&gt; $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.MeFun loc (Ploc.VaVal s) mt me</span></li>
<li><span class="blue">&lt;:module_expr&lt; functor ($_:s$ : $mt$) -&gt; $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.MeFun loc s mt me</span></li>
</ul>
</li>
<li>struct<ul>
<li><span class="blue">&lt;:module_expr&lt; struct $list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.MeStr loc (Ploc.VaVal lsi)</span></li>
<li><span class="blue">&lt;:module_expr&lt; struct $_list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.MeStr loc lsi</span></li>
</ul>
</li>
<li>module type constraint<ul>
<li><span class="blue">&lt;:module_expr&lt; ($me$ : $mt$) &gt;&gt;</span></li>
<li><span class="red">MLast.MeTyc loc me mt</span></li>
</ul>
</li>
<li>uppercase identifier<ul>
<li><span class="blue">&lt;:module_expr&lt; $uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MeUid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:module_expr&lt; $_uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MeUid loc s</span></li>
</ul>
</li>
<li>module unpacking<ul>
<li><span class="blue">&lt;:module_expr&lt; (value $e$) &gt;&gt;</span></li>
<li><span class="red">MLast.MeUnp loc e None</span></li>
<li><span class="blue">&lt;:module_expr&lt; (value $e$ : $mt$) &gt;&gt;</span></li>
<li><span class="red">MLast.MeUnp loc e (Some mt)</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#module_expr_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.MeXtr loc s ot</span></li>
</ul>
</li>
</ul>
<p>1. Extra node internally used by the quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to
build antiquotations of module expressions.</p>
</div>
<div class="section" id="id15">
<h5>module_type<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>access<ul>
<li><span class="blue">&lt;:module_type&lt; $mt1$ . $mt2$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtAcc loc mt1 mt2</span></li>
</ul>
</li>
<li>application<ul>
<li><span class="blue">&lt;:module_type&lt; $mt1$ $mt2$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtApp loc mt1 mt2</span></li>
</ul>
</li>
<li>functor<ul>
<li><span class="blue">&lt;:module_type&lt; functor ($s$ : $mt1$) -&gt; $mt2$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtFun loc (Ploc.VaVal s) mt1 mt2</span></li>
<li><span class="blue">&lt;:module_type&lt; functor ($_:s$ : $mt1$) -&gt; $mt2$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtFun loc s mt1 mt2</span></li>
</ul>
</li>
<li>lowercase identifier<ul>
<li><span class="blue">&lt;:module_type&lt; $lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtLid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:module_type&lt; $_lid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtLid loc s</span></li>
</ul>
</li>
<li>abstract<ul>
<li><span class="blue">&lt;:module_type&lt; ‘ $s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtQuo loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:module_type&lt; ‘ $_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtQuo loc s</span></li>
</ul>
</li>
<li>signature<ul>
<li><span class="blue">&lt;:module_type&lt; sig $list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.MtSig loc (Ploc.VaVal lsi)</span></li>
<li><span class="blue">&lt;:module_type&lt; sig $_list:lsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.MtSig loc lsi</span></li>
</ul>
</li>
<li>of module expression<ul>
<li><span class="blue">&lt;:module_type&lt; module type of $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtTyo loc me</span></li>
</ul>
</li>
<li>uppercase identifier<ul>
<li><span class="blue">&lt;:module_type&lt; $uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtUid loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:module_type&lt; $_uid:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtUid loc s</span></li>
</ul>
</li>
<li>with construction<ul>
<li><span class="blue">&lt;:module_type&lt; $mt$ with $list:lwc$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtWit loc mt (Ploc.VaVal lwc)</span></li>
<li><span class="blue">&lt;:module_type&lt; $mt$ with $_list:lwc$ &gt;&gt;</span></li>
<li><span class="red">MLast.MtWit loc mt lwc</span></li>
</ul>
</li>
<li>extra node &lt;a href=”#module_type_1”&gt;(1)&lt;/a&gt;<ul>
<li><span class="blue">… no representation …</span></li>
<li><span class="red">MLast.MtXtr loc s ot</span></li>
</ul>
</li>
</ul>
<p>1. Extra node internally used by the quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> to
build antiquotations of module types.</p>
</div>
</div>
<div class="section" id="id16">
<h4>classes…<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id17">
<h5>class_expr<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>application<ul>
<li><span class="blue">&lt;:class_expr&lt; $ce$ $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeApp loc ce e</span></li>
</ul>
</li>
<li>constructor<ul>
<li><span class="blue">&lt;:class_expr&lt; [ $list:lt$ ] $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeCon loc (Ploc.VaVal ls) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:class_expr&lt; [ $_list:lt$ ] $list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeCon loc (Ploc.VaVal ls) lt</span></li>
<li><span class="blue">&lt;:class_expr&lt; [ $list:lt$ ] $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeCon loc ls (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:class_expr&lt; [ $_list:lt$ ] $_list:ls$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeCon loc ls lt</span></li>
</ul>
</li>
<li>function<ul>
<li><span class="blue">&lt;:class_expr&lt; fun $p$ -&gt; $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeFun loc p ce</span></li>
</ul>
</li>
<li>let rec<ul>
<li><span class="blue">&lt;:class_expr&lt; let rec $list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc (Ploc.VaVal True) (Ploc.VaVal lpe) ce</span></li>
<li><span class="blue">&lt;:class_expr&lt; let rec $_list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc (Ploc.VaVal True) lpe ce</span></li>
</ul>
</li>
<li>let non rec<ul>
<li><span class="blue">&lt;:class_expr&lt; let $list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc (Ploc.VaVal False) (Ploc.VaVal lpe) ce</span></li>
<li><span class="blue">&lt;:class_expr&lt; let $_list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc (Ploc.VaVal False) lpe ce</span></li>
</ul>
</li>
<li>let<ul>
<li><span class="blue">&lt;:class_expr&lt; let $flag:b$ $list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc (Ploc.VaVal b) (Ploc.VaVal lpe) ce</span></li>
<li><span class="blue">&lt;:class_expr&lt; let $flag:b$ $_list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc (Ploc.VaVal b) lpe ce</span></li>
<li><span class="blue">&lt;:class_expr&lt; let $_flag:b$ $list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc b (Ploc.VaVal lpe) ce</span></li>
<li><span class="blue">&lt;:class_expr&lt; let $_flag:b$ $_list:lpe$ in $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CeLet loc b lpe ce</span></li>
</ul>
</li>
<li>object<ul>
<li><span class="blue">&lt;:class_expr&lt; object $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc (Ploc.VaVal None) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_expr&lt; object $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc (Ploc.VaVal None) lcsi</span></li>
<li><span class="blue">&lt;:class_expr&lt; object ($p$) $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc (Ploc.VaVal (Some p)) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_expr&lt; object ($p$) $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc (Ploc.VaVal (Some p)) lcsi</span></li>
<li><span class="blue">&lt;:class_expr&lt; object $opt:op$ $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc (Ploc.VaVal op) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_expr&lt; object $opt:op$ $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc (Ploc.VaVal op) lcsi</span></li>
<li><span class="blue">&lt;:class_expr&lt; object $_opt:op$ $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc op (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_expr&lt; object $_opt:op$ $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CeStr loc op lcsi</span></li>
</ul>
</li>
<li>class type constraint<ul>
<li><span class="blue">&lt;:class_expr&lt; ($ce$ : $ct$) &gt;&gt;</span></li>
<li><span class="red">MLast.CeTyc loc ce ct</span></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id18">
<h5>class_type<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>access<ul>
<li><span class="blue">&lt;:class_type&lt; $ct1$ . $ct2$ &gt;&gt;</span></li>
<li><span class="red">MLast.CtAcc loc ct1 ct2</span></li>
</ul>
</li>
<li>application<ul>
<li><span class="blue">&lt;:class_type&lt; $ct1$ $ct2$ &gt;&gt;</span></li>
<li><span class="red">MLast.CtApp loc ct1 ct2</span></li>
</ul>
</li>
<li>constructor<ul>
<li><span class="blue">&lt;:class_type&lt; $ct$ [ $list:lt$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.CtCon loc ct (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:class_type&lt; $ct$ [ $_list:lt$ ] &gt;&gt;</span></li>
<li><span class="red">MLast.CtCon loc ct lt</span></li>
</ul>
</li>
<li>arrow<ul>
<li><span class="blue">&lt;:class_type&lt; [ $t$ ] -&gt; $ct$ &gt;&gt;</span></li>
<li><span class="red">MLast.CtFun loc t ct</span></li>
</ul>
</li>
<li>identifier<ul>
<li><span class="blue">&lt;:class_type&lt; $id:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.CtIde loc (Ploc.VaVal s)</span></li>
<li><span class="blue">&lt;:class_type&lt; $_id:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.CtIde loc s</span></li>
</ul>
</li>
<li>object<ul>
<li><span class="blue">&lt;:class_type&lt; object $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc (Ploc.VaVal None) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_type&lt; object $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc (Ploc.VaVal None) lcsi</span></li>
<li><span class="blue">&lt;:class_type&lt; object ($t$) $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc (Ploc.VaVal (Some t)) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_type&lt; object ($t$) $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc (Ploc.VaVal (Some t)) lcsi</span></li>
<li><span class="blue">&lt;:class_type&lt; object $opt:ot$ $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc (Ploc.VaVal ot) (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_type&lt; object $opt:ot$ $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc (Ploc.VaVal ot) lcsi</span></li>
<li><span class="blue">&lt;:class_type&lt; object $_opt:ot$ $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc ot (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_type&lt; object $_opt:ot$ $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CtSig loc ot lcsi</span></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id19">
<h5>class_str_item<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>type constraint<ul>
<li><span class="blue">&lt;:class_str_item&lt; type $t1$ = $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrCtr loc t1 t2</span></li>
</ul>
</li>
<li>declaration list<ul>
<li><span class="blue">&lt;:class_str_item&lt; declare $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CrDcl loc (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_str_item&lt; declare $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CrDcl loc lcsi</span></li>
</ul>
</li>
<li>inheritance<ul>
<li><span class="blue">&lt;:class_str_item&lt; inherit $ce$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrInh loc ce (Ploc.VaVal None)</span></li>
<li><span class="blue">&lt;:class_str_item&lt; inherit $ce$ $opt:Some s$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrInh loc ce (Ploc.VaVal (Some s))</span></li>
<li><span class="blue">&lt;:class_str_item&lt; inherit $ce$ $opt:os$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrInh loc ce (Ploc.VaVal os)</span></li>
<li><span class="blue">&lt;:class_str_item&lt; inherit $ce$ $_opt:os$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrInh loc ce os</span></li>
</ul>
</li>
<li>initialization<ul>
<li><span class="blue">&lt;:class_str_item&lt; initializer $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrIni loc e</span></li>
</ul>
</li>
<li>method<ul>
<li><span class="blue">&lt;:class_str_item&lt; method! private $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! private $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal True) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal False) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) (Ploc.VaVal b2) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method! $_priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal True) b2 s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method private $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal True) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal False) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) (Ploc.VaVal b2) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal False) b2 s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ private $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal True) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal False) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) (Ploc.VaVal b2) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $!:b1$ $_priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc (Ploc.VaVal b1) b2 s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ private $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal True) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal False) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 (Ploc.VaVal b2) s ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 (Ploc.VaVal s) (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 (Ploc.VaVal s) (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 (Ploc.VaVal s) (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 (Ploc.VaVal s) ot e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 s (Ploc.VaVal None) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $_lid:s$ : $t$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 s (Ploc.VaVal (Some t)) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $_lid:s$ $opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 s (Ploc.VaVal ot) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method $_!:b1$ $_priv:b2$ $_lid:s$ $_opt:ot$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrMth loc b1 b2 s ot e</span></li>
</ul>
</li>
<li>value<ul>
<li><span class="blue">&lt;:class_str_item&lt; value! mutable $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) (Ploc.VaVal True) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! mutable $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) (Ploc.VaVal True) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) (Ploc.VaVal False) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) (Ploc.VaVal False) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! $flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) (Ploc.VaVal b2) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! $flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) (Ploc.VaVal b2) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! $_flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) b2 (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value! $_flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal True) b2 s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value mutable $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) (Ploc.VaVal True) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value mutable $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) (Ploc.VaVal True) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) (Ploc.VaVal False) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) (Ploc.VaVal False) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) (Ploc.VaVal b2) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) (Ploc.VaVal b2) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) b2 (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal False) b2 s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ mutable $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) (Ploc.VaVal True) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ mutable $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) (Ploc.VaVal True) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) (Ploc.VaVal False) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) (Ploc.VaVal False) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ $flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) (Ploc.VaVal b2) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ $flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) (Ploc.VaVal b2) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ $_flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) b2 (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $!:b1$ $_flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc (Ploc.VaVal b1) b2 s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ mutable $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 (Ploc.VaVal True) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ mutable $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 (Ploc.VaVal True) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 (Ploc.VaVal False) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 (Ploc.VaVal False) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ $flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 (Ploc.VaVal b2) (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ $flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 (Ploc.VaVal b2) s e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ $_flag:b2$ $lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 b2 (Ploc.VaVal s) e</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value $_!:b1$ $_flag:b2$ $_lid:s$ = $e$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVal loc b1 b2 s e</span></li>
</ul>
</li>
<li>virtual value<ul>
<li><span class="blue">&lt;:class_str_item&lt; value virtual mutable $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc (Ploc.VaVal True) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual mutable $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc (Ploc.VaVal True) s t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc (Ploc.VaVal False) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc (Ploc.VaVal False) s t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual $flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc (Ploc.VaVal b) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual $flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc (Ploc.VaVal b) s t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual $_flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc b (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; value virtual $_flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVav loc b s t</span></li>
</ul>
</li>
<li>virtual method<ul>
<li><span class="blue">&lt;:class_str_item&lt; method virtual private $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc (Ploc.VaVal True) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual private $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc (Ploc.VaVal True) s t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc (Ploc.VaVal False) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc (Ploc.VaVal False) s t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual $flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc (Ploc.VaVal b) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual $flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc (Ploc.VaVal b) s t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual $_flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc b (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_str_item&lt; method virtual $_flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CrVir loc b s t</span></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id20">
<h5>class_sig_item<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>type constraint<ul>
<li><span class="blue">&lt;:class_sig_item&lt; type $t1$ = $t2$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgCtr loc t1 t2</span></li>
</ul>
</li>
<li>declare<ul>
<li><span class="blue">&lt;:class_sig_item&lt; declare $list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CgDcl loc (Ploc.VaVal lcsi)</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; declare $_list:lcsi$ end &gt;&gt;</span></li>
<li><span class="red">MLast.CgDcl loc lcsi</span></li>
</ul>
</li>
<li>inheritance<ul>
<li><span class="blue">&lt;:class_sig_item&lt; inherit $ct$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgInh loc ct</span></li>
</ul>
</li>
<li>method<ul>
<li><span class="blue">&lt;:class_sig_item&lt; method private $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc (Ploc.VaVal True) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method private $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc (Ploc.VaVal True) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc (Ploc.VaVal False) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc (Ploc.VaVal False) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method $flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc (Ploc.VaVal b) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method $flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc (Ploc.VaVal b) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method $_flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc b (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method $_flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgMth loc b s t</span></li>
</ul>
</li>
<li>value<ul>
<li><span class="blue">&lt;:class_sig_item&lt; value mutable $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc (Ploc.VaVal True) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value mutable $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc (Ploc.VaVal True) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc (Ploc.VaVal False) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc (Ploc.VaVal False) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value $flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc (Ploc.VaVal b) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value $flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc (Ploc.VaVal b) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value $_flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc b (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; value $_flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVal loc b s t</span></li>
</ul>
</li>
<li>virtual method<ul>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual private $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc (Ploc.VaVal True) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual private $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc (Ploc.VaVal True) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc (Ploc.VaVal False) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc (Ploc.VaVal False) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual $flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc (Ploc.VaVal b) (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual $flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc (Ploc.VaVal b) s t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual $_flag:b$ $lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc b (Ploc.VaVal s) t</span></li>
<li><span class="blue">&lt;:class_sig_item&lt; method virtual $_flag:b$ $_lid:s$ : $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.CgVir loc b s t</span></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="id21">
<h4>other<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id22">
<h5>type_decl<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h5>
<p>What is after ‘type’ or ‘and’ in a type declaration.</p>
<p>The type <code class="docutils literal"><span class="pre">type_decl</span></code> is a record type corresponding to
a type declaration. Its definition is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">type_decl</span> <span class="o">=</span>
  <span class="p">{</span> <span class="n">tdNam</span> <span class="p">:</span> <span class="p">(</span><span class="n">loc</span> <span class="o">*</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vaval</span> <span class="n">string</span><span class="p">);</span>
    <span class="n">tdPrm</span> <span class="p">:</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="p">(</span><span class="nb">list</span> <span class="n">type_var</span><span class="p">);</span>
    <span class="n">tdPrv</span> <span class="p">:</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="nb">bool</span><span class="p">;</span>
    <span class="n">tdDef</span> <span class="p">:</span> <span class="n">ctyp</span><span class="p">;</span>
    <span class="n">tdCon</span> <span class="p">:</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">ctyp</span> <span class="o">*</span> <span class="n">ctyp</span><span class="p">))</span> <span class="p">}</span>
<span class="p">;</span>
</pre></div>
</div>
<p>The field <code class="docutils literal"><span class="pre">tdNam</span></code> is the type identifier (together with its
location in the source).</p>
<p>The field <code class="docutils literal"><span class="pre">tdPrm</span></code> is the list of its possible parameters.</p>
<p>The field <code class="docutils literal"><span class="pre">tdPrv</span></code> tells if the type is private or not.</p>
<p>The field <code class="docutils literal"><span class="pre">tdDef</span></code> is the definition of the type.</p>
<p>The field <code class="docutils literal"><span class="pre">tdCon</span></code> is the possible list of type constraints.</p>
<ul class="simple">
<li><ul class="first">
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = private $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = private $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = $priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = $priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = $_priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $list:ltv$ = $_priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = private $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = private $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = $priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = $priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = $_priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $tp:ls$ $_list:ltv$ = $_priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = Ploc.VaVal ls; MLast.tdPrm = ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = private $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = private $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = $priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = $priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = $_priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $list:ltv$ = $_priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = Ploc.VaVal ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = private $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = private $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal True; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal False; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = $priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = $priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = Ploc.VaVal b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = $_priv:b$ $t$ $list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = Ploc.VaVal ltt}</span></li>
<li><span class="blue">&lt;:type_decl&lt; $_tp:ls$ $_list:ltv$ = $_priv:b$ $t$ $_list:ltt$ &gt;&gt;</span></li>
<li><span class="red">{MLast.tdNam = ls; MLast.tdPrm = ltv; MLast.tdPrv = b; MLast.tdDef = t; MLast.tdCon = ltt}</span></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id23">
<h5>with_constr<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h5>
<p>“With” possibly following a module type.</p>
<ul class="simple">
<li>with module<ul>
<li><span class="blue">&lt;:with_constr&lt; module $list:ls$ = $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcMod loc (Ploc.VaVal ls) me</span></li>
<li><span class="blue">&lt;:with_constr&lt; module $_list:ls$ = $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcMod loc ls me</span></li>
</ul>
</li>
<li>with module substitution<ul>
<li><span class="blue">&lt;:with_constr&lt; module $list:ls$ := $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcMos loc (Ploc.VaVal ls) me</span></li>
<li><span class="blue">&lt;:with_constr&lt; module $_list:ls$ := $me$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcMos loc ls me</span></li>
</ul>
</li>
<li>with type<ul>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $list:ltv$ = private $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) (Ploc.VaVal ltv) (Ploc.VaVal True) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $list:ltv$ = $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) (Ploc.VaVal ltv) (Ploc.VaVal False) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $list:ltv$ = $flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) (Ploc.VaVal ltv) (Ploc.VaVal b) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $list:ltv$ = $_flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) (Ploc.VaVal ltv) b t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $_list:ltv$ = private $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) ltv (Ploc.VaVal True) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $_list:ltv$ = $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) ltv (Ploc.VaVal False) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $_list:ltv$ = $flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) ltv (Ploc.VaVal b) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $_list:ltv$ = $_flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc (Ploc.VaVal ls) ltv b t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $list:ltv$ = private $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls (Ploc.VaVal ltv) (Ploc.VaVal True) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $list:ltv$ = $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls (Ploc.VaVal ltv) (Ploc.VaVal False) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $list:ltv$ = $flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls (Ploc.VaVal ltv) (Ploc.VaVal b) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $list:ltv$ = $_flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls (Ploc.VaVal ltv) b t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $_list:ltv$ = private $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls ltv (Ploc.VaVal True) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $_list:ltv$ = $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls ltv (Ploc.VaVal False) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $_list:ltv$ = $flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls ltv (Ploc.VaVal b) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $_list:ltv$ = $_flag:b$ $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTyp loc ls ltv b t</span></li>
</ul>
</li>
<li>with type substitution<ul>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $list:ltv$ := $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTys loc (Ploc.VaVal ls) (Ploc.VaVal ltv) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $list:ls$ $_list:ltv$ := $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTys loc (Ploc.VaVal ls) ltv t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $list:ltv$ := $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTys loc ls (Ploc.VaVal ltv) t</span></li>
<li><span class="blue">&lt;:with_constr&lt; type $_list:ls$ $_list:ltv$ := $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.WcTys loc ls ltv t</span></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id24">
<h5>poly_variant<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h5>
<p>Polymorphic variants.</p>
<ul class="simple">
<li>constructor<ul>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal True) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of &amp;amp; $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal True) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of &amp;amp; $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal True) lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal False) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal False) lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of $flag:b$ $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal b) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of $flag:b$ $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) (Ploc.VaVal b) lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of $_flag:b$ $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) b (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$s$ of $_flag:b$ $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc (Ploc.VaVal s) b lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal True) (Ploc.VaVal [])</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of &amp;amp; $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal True) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of &amp;amp; $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal True) lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal False) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal False) lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of $flag:b$ $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal b) (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of $flag:b$ $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s (Ploc.VaVal b) lt</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of $_flag:b$ $list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s b (Ploc.VaVal lt)</span></li>
<li><span class="blue">&lt;:poly_variant&lt; `$_:s$ of $_flag:b$ $_list:lt$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvTag loc s b lt</span></li>
</ul>
</li>
<li>type<ul>
<li><span class="blue">&lt;:poly_variant&lt; $t$ &gt;&gt;</span></li>
<li><span class="red">MLast.PvInh loc t</span></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="nodes-without-quotations">
<h3>Nodes without quotations<a class="headerlink" href="#nodes-without-quotations" title="Permalink to this headline">¶</a></h3>
<p>Some types defined in the AST tree module <code class="docutils literal"><span class="pre">MLast</span></code> don’t
have an associated quotation. They are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">type_var</span></code></li>
<li><code class="docutils literal"><span class="pre">class_infos</span></code></li>
</ul>
<div class="section" id="type-var">
<h4>type_var<a class="headerlink" href="#type-var" title="Permalink to this headline">¶</a></h4>
<p>The type <code class="docutils literal"><span class="pre">type_var</span></code> is defined as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">type_var</span> <span class="o">=</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="n">string</span> <span class="o">*</span> <span class="p">(</span><span class="nb">bool</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">));</span>
</pre></div>
</div>
<p>The first boolean is <code class="docutils literal"><span class="pre">True</span></code> if the type variable is
prefixed by <code class="docutils literal"><span class="pre">+</span></code> (“plus” sign). The second boolean is
<code class="docutils literal"><span class="pre">True</span></code> if the type variable is prefixed by <code class="docutils literal"><span class="pre">-</span></code>
(“minus” sign).</p>
</div>
<div class="section" id="class-infos">
<h4>class_infos<a class="headerlink" href="#class-infos" title="Permalink to this headline">¶</a></h4>
<p>The type <code class="docutils literal"><span class="pre">class_infos</span></code> is a record type parametrized with
a type variable. It is common to:</p>
<ul class="simple">
<li>the “class declaration” (<code class="docutils literal"><span class="pre">class</span> <span class="pre">...</span></code> as structure item), the type
variable being <code class="docutils literal"><span class="pre">class_expr</span></code>,</li>
<li>the “class description” (<code class="docutils literal"><span class="pre">class</span> <span class="pre">...</span></code> as signature item), the type
variable being <code class="docutils literal"><span class="pre">class_type</span></code>,</li>
<li>the “class type declaration” (<code class="docutils literal"><span class="pre">class</span> <span class="pre">type</span> <span class="pre">...</span></code>), the type variable
being <code class="docutils literal"><span class="pre">class_type</span></code>.</li>
</ul>
<p>It is defined as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">class_infos</span> <span class="s1">&#39;a =</span>
  <span class="p">{</span> <span class="n">ciLoc</span> <span class="p">:</span> <span class="n">loc</span><span class="p">;</span>
    <span class="n">ciVir</span> <span class="p">:</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="nb">bool</span><span class="p">;</span>
    <span class="n">ciPrm</span> <span class="p">:</span> <span class="p">(</span><span class="n">loc</span> <span class="o">*</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="p">(</span><span class="nb">list</span> <span class="n">type_var</span><span class="p">));</span>
    <span class="n">ciNam</span> <span class="p">:</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">vala</span> <span class="n">string</span><span class="p">;</span>
    <span class="n">ciExp</span> <span class="p">:</span> <span class="s1">&#39;a }</span>
<span class="p">;</span>
</pre></div>
</div>
<p>The field <code class="docutils literal"><span class="pre">ciLoc</span></code> is the location of the whole definition.</p>
<p>The field <code class="docutils literal"><span class="pre">ciVir</span></code> tells whether the type is virtual or not.</p>
<p>The field <code class="docutils literal"><span class="pre">ciPrm</span></code> is the list of its possible parameters.</p>
<p>The field <code class="docutils literal"><span class="pre">ciNam</span></code> is the class identifier.</p>
<p>The field <code class="docutils literal"><span class="pre">ciExp</span></code> is the class definition, depending of its
kind.</p>
</div>
</div>
</div>
<div class="section" id="syntax-tree-quotations-in-user-syntax">
<span id="q-ast"></span><h2>Syntax tree quotations in user syntax<a class="headerlink" href="#syntax-tree-quotations-in-user-syntax" title="Permalink to this headline">¶</a></h2>
<p>The quotation kit <code class="docutils literal"><span class="pre">q_ast.cmo</span></code> allows to use syntax tree
quotations in user syntax. It fully works only in “strict” mode. In
“transitional” mode, there is no way to use antiquotations, which
restricts its utility.</p>
<p>If this kit is loaded, when a quotation of syntax tree is found,
the current OCaml language parser is called. Then, the resulting
tree is reified (except the antiquotations) to represent <em>the
syntax tree of the syntax tree</em>.</p>
<div class="section" id="id25">
<h3>Antiquotations<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>The OCaml langage parser used, and its possible extensions, must
have been built to allow the places of the antiquotations. The
symbols enclosed by the meta-symbol <code class="docutils literal"><span class="pre">V</span></code> (see the chapter
about &lt;a href=”grammars.html”&gt;extensible grammars&lt;/a&gt;, section
“symbols”), define where antiquotations can take place.</p>
<p>There is no need to specify antiquotations for the main types
defined in the AST tree module (<code class="docutils literal"><span class="pre">MLast</span></code>): <code class="docutils literal"><span class="pre">expr</span></code>,
<code class="docutils literal"><span class="pre">patt</span></code>, <code class="docutils literal"><span class="pre">expr</span></code>, <code class="docutils literal"><span class="pre">str_item</span></code>,
<code class="docutils literal"><span class="pre">sig_item</span></code>, and so on. All syntax parts of these types are
automatically antiquotable.</p>
<p>For example, in Camlp5 sources, the grammar rule defining the
“let..in” statement is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="s2">&quot;let&quot;</span><span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">V</span> <span class="p">(</span><span class="n">FLAG</span> <span class="s2">&quot;rec&quot;</span><span class="p">)</span> <span class="s2">&quot;flag&quot;</span> <span class="s2">&quot;opt&quot;</span><span class="p">;</span>
 <span class="n">l</span> <span class="o">=</span> <span class="n">V</span> <span class="p">(</span><span class="n">LIST1</span> <span class="n">let_binding</span> <span class="n">SEP</span> <span class="s2">&quot;and&quot;</span><span class="p">);</span> <span class="s2">&quot;in&quot;</span><span class="p">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">expr</span>
</pre></div>
</div>
<p>All symbols of these rules, except the keywords, are antiquotable:</p>
<ul class="simple">
<li>The “rec” flag, because enclosed by the “V” meta symbol. The two
strings which follow it gives the possible antiquotation kinds:
“flag” (the normal antiquotation kind) and “opt” (kept by backward
compatibility, but not recommended). It is therefore possible to
antiquote it as: <code class="docutils literal"><span class="pre">$flag:...$</span></code> or <code class="docutils literal"><span class="pre">$opt:...$</span></code> where the <code class="docutils literal"><span class="pre">...</span></code>
is an expression or a pattern depending on the position of the
enclosing quotation.</li>
<li>The binding list is also antiquotable, since it is also enclosed by
the “V” meta symbol. Its antiquotation kind is “list” (the default
when the meta symbol parameter is a list). It is therefore possible
to write <code class="docutils literal"><span class="pre">$list:...$</span></code> at the place of the binding list.</li>
<li>The expression after the “in” is also antiquotable, because it
belongs to the main types defined in the module <code class="docutils literal"><span class="pre">MLast</span></code>.</li>
</ul>
<p>In that example, the variable <code class="docutils literal"><span class="pre">r</span></code> is of type <code class="docutils literal"><span class="pre">Ploc.vala</span>
<span class="pre">bool</span></code>, the variable <code class="docutils literal"><span class="pre">r</span></code> of type <code class="docutils literal"><span class="pre">Ploc.vala</span> <span class="pre">(list</span>
<span class="pre">(patt</span> <span class="pre">*</span> <span class="pre">expr))</span></code> and the variable <code class="docutils literal"><span class="pre">x</span></code> of type
<code class="docutils literal"><span class="pre">MLast.expr</span></code>.</p>
<p>… to be completed …</p>
</div>
</div>
<div class="section" id="the-pcaml-module">
<span id="pcaml"></span><h2>The Pcaml module<a class="headerlink" href="#the-pcaml-module" title="Permalink to this headline">¶</a></h2>
<p>All about language parsing entries, language printing functions,
quotation management at parsing time, extensible directives, extensible
options, and generalities about Camlp5.</p>
<div class="section" id="language-parsing">
<h3>Language parsing<a class="headerlink" href="#language-parsing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="main-parsing-functions">
<h4>Main parsing functions<a class="headerlink" href="#main-parsing-functions" title="Permalink to this headline">¶</a></h4>
<p>The two functions below are called when parsing an interface (<code class="docutils literal"><span class="pre">.mli</span></code>
file) or an implementation (<code class="docutils literal"><span class="pre">.ml</span></code> file) to build the syntax tree; the
returned list contains the phrases (signature items or structure
items) and their locations; the boolean tells whether the parser has
encountered a directive; in this case, since the directive may
change the syntax, the parsing stops, the directive is evaluated,
and this function is called again.</p>
<p>These functions are
references, because they can be changed to use another technology
than the Camlp5 extended grammars. By default, they use the grammars
entries [implem] and [interf] defined below.</p>
<ul class="simple">
<li>Function called when parsing an interface (“.mli”) file:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">parse_interf</span> <span class="p">:</span> <span class="n">ref</span> <span class="p">(</span><span class="n">Stream</span><span class="o">.</span><span class="n">t</span> <span class="n">char</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">));</span>
</pre></div>
</div>
<ul class="simple">
<li>Function called when parsing an implementation (“.ml”) file:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">parse_implem</span> <span class="p">:</span>
  <span class="n">ref</span> <span class="p">(</span><span class="n">Stream</span><span class="o">.</span><span class="n">t</span> <span class="n">char</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="grammar">
<h4>Grammar<a class="headerlink" href="#grammar" title="Permalink to this headline">¶</a></h4>
<p>Grammar variable of the language:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">gram</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">g</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="entries">
<h4>Entries<a class="headerlink" href="#entries" title="Permalink to this headline">¶</a></h4>
<p>Grammar entries which return <a class="reference internal" href="#ml-ast"><span class="std std-ref">ML Syntax tree</span></a>. These are set by the parsing kit of the current syntax,
through the statement <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">EXTEND</span></a>. They
are usable by other possible user syntax extensions.</p>
<ul class="simple">
<li>Expressions:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Patterns:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">patt</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">patt</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Types:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">ctyp</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ctyp</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Signature items, i.e. items between <code class="docutils literal"><span class="pre">sig</span></code> and <code class="docutils literal"><span class="pre">end</span></code>, or inside
an interface (“.mli”) file.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">sig_item</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Structure items, i.e. items between <code class="docutils literal"><span class="pre">struct</span></code> and <code class="docutils literal"><span class="pre">end</span></code>, or
inside an implementation (“.ml”) file.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">str_item</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Module types, e.g. signatures, functors, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">module_type</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_type</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Module expressions, e.g. structures, functors, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">module_expr</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_expr</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Specific entry for the “let binding”, i.e. the association “let pattern = expression”.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">let_binding</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">patt</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>Specific entry for the “type declaration”, i.e. the association “type name = type-expression”</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">type_declaration</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">type_decl</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class signature items, i.e. items of class objects types.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">class_sig_item</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_sig_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class structure items, i.e. items of class objects.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">class_str_item</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_str_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class types, e.g. object types, class types functions, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">class_type</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_type</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class expressions, e.g. objects, class functions, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">class_expr</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_expr</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Interface, i.e. files with extension “.mli”. The location is the top
of the tree. The boolean says whether the parsing stopped because of
the presence of a directive (which potentially could change the
syntax).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">interf</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>Implementation, i.e. files with extension “.ml”. Same remark about
the location and the boolean.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">implem</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>Phrases of the OCaml interactive toplevel. Return “None” in case of
end of file.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">top_phrase</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="p">(</span><span class="n">option</span> <span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>Phrases in files included by the directive <code class="docutils literal"><span class="pre">#use</span></code>. The boolean
indicates whether the parsing stopped because of a directive (as for
<code class="docutils literal"><span class="pre">interf</span></code> above).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">use_file</span> <span class="p">:</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">e</span> <span class="p">(</span><span class="nb">list</span> <span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="language-printing">
<h3>Language printing<a class="headerlink" href="#language-printing" title="Permalink to this headline">¶</a></h3>
<div class="section" id="main-printing-functions">
<h4>Main printing functions<a class="headerlink" href="#main-printing-functions" title="Permalink to this headline">¶</a></h4>
<p>The two function below are called when printing an interface (.mli
file) of an implementation (.ml file) from the syntax tree; the list
is the result of the corresponding parsing function.&lt;br/&gt;These
functions are references, to allow using other technologies than the
Camlp5 extended printers.</p>
<ul class="simple">
<li>Function called when printing an interface (“.mli”) file</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">print_interf</span> <span class="p">:</span>
  <span class="n">ref</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>Function called when printing an implementation (“.ml”) file</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">print_implem</span> <span class="p">:</span>
  <span class="n">ref</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span> <span class="o">*</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">);</span>
</pre></div>
</div>
<p>By default, these functions fail. The printer kit
<code class="docutils literal"><span class="pre">pr_dump.cmo</span></code> (loaded by most Camlp5 commands) sets them to
functions dumping the syntax tree in binary (for the OCaml
compiler). The pretty printer kits, such as <code class="docutils literal"><span class="pre">pr_r.cmo</span></code> and
<code class="docutils literal"><span class="pre">pr_o.cmo</span></code> set them to functions calling the predefined
printers (see next section).</p>
</div>
<div class="section" id="printers">
<h4>Printers<a class="headerlink" href="#printers" title="Permalink to this headline">¶</a></h4>
<p>Printers taking <a class="reference internal" href="#ml-ast"><span class="std std-ref">ML Syntax tree</span></a> as
parameters and returning pretty printed strings. These are set by
the printing kits, through the
statement <a class="reference internal" href="prtools.html#printers"><span class="std std-ref">EXTEND_PRINTER</span></a>. They are
usable by other possible user printing extensions.</p>
<ul class="simple">
<li>Expressions:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_expr</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Patterns:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_patt</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">patt</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Types:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_ctyp</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ctyp</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Signature items, i.e. items between <code class="docutils literal"><span class="pre">sig</span></code> and <code class="docutils literal"><span class="pre">end</span></code>, or inside an interface (“.mli”) file.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_sig_item</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Structure items, i.e. items between <code class="docutils literal"><span class="pre">struct</span></code> and <code class="docutils literal"><span class="pre">end</span></code>, or
inside an implementation (“.ml”) file.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_str_item</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Module types, e.g. signatures, functors, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_module_type</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_type</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Module expressions, e.g. structures, functors, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_module_expr</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_expr</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class signature items, i.e. items of class objects types.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_class_sig_item</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_sig_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class structure items, i.e. items of class objects.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_class_str_item</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_str_item</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class types, e.g. object types, class types functions, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_class_type</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_type</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Class expressions, e.g. objects, class functions, identifiers.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">pr_class_expr</span> <span class="p">:</span> <span class="n">Eprinter</span><span class="o">.</span><span class="n">t</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_expr</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="quotation-management">
<h3>Quotation management<a class="headerlink" href="#quotation-management" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Called in the semantic actions of the rules parsing a quotation in
position of expression.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">handle_expr_quotation</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">string</span> <span class="o">*</span> <span class="n">string</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Called in the semantic actions of the rules parsing a quotation in position of pattern.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">handle_patt_quotation</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">string</span> <span class="o">*</span> <span class="n">string</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">patt</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Pcaml.quotation_dump_file</span></code> optionally tells the compiler to dump
the result of an expander (of kind “generating a string”) if this
result is syntactically incorrect. If <code class="docutils literal"><span class="pre">None</span></code> (default), this
result is not dumped. If <code class="docutils literal"><span class="pre">Some</span> <span class="pre">fname</span></code>, the result is dumped in the
file <code class="docutils literal"><span class="pre">fname</span></code>.  The same effect can be done with the option <code class="docutils literal"><span class="pre">-QD</span></code>
of Camlp5 commands.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">quotation_dump_file</span> <span class="p">:</span> <span class="n">ref</span> <span class="p">(</span><span class="n">option</span> <span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>While expanding a quotation, returns the location of the quotation
text (between the quotation quotes) in the source; raises
<code class="docutils literal"><span class="pre">Failure</span></code> if not in the context of a quotation expander.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">quotation_location</span> <span class="p">:</span> <span class="n">unit</span> <span class="o">-&gt;</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">t</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="extensible-directives-and-options">
<h3>Extensible directives and options<a class="headerlink" href="#extensible-directives-and-options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The type of functions called to treat a directive with its syntactic
parameter. Directives act by side effect.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">directive_fun</span> <span class="o">=</span> <span class="n">option</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Add a new directive.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">add_directive</span> <span class="p">:</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">directive_fun</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Find the function associated with a directive. Raises <code class="docutils literal"><span class="pre">Not_found</span></code>
if the directive does not exists.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">find_directive</span> <span class="p">:</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">directive_fun</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Add an option to the command line of the Camlp5 command.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">add_option</span> <span class="p">:</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">Arg</span><span class="o">.</span><span class="n">spec</span> <span class="o">-&gt;</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="equalities-over-syntax-trees">
<h3>Equalities over syntax trees<a class="headerlink" href="#equalities-over-syntax-trees" title="Permalink to this headline">¶</a></h3>
<p>These equalities skip the locations.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">eq_expr</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_patt</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">patt</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">patt</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_ctyp</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ctyp</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ctyp</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_str_item</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">str_item</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_sig_item</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">sig_item</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_module_expr</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_expr</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_expr</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_module_type</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_type</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">module_type</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_class_sig_item</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_sig_item</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_sig_item</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_class_str_item</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_str_item</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_str_item</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_class_type</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_type</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_type</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
<span class="n">value</span> <span class="n">eq_class_expr</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_expr</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">class_expr</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="generalities">
<h3>Generalities<a class="headerlink" href="#generalities" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The current version of Camlp5.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">version</span> <span class="p">:</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>The name of the current syntax. Set by the loaded syntax kit.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">syntax_name</span> <span class="p">:</span> <span class="n">ref</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>The file currently being parsed.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">input_file</span> <span class="p">:</span> <span class="n">ref</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>The output file, stdout if None (default).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">output_file</span> <span class="p">:</span> <span class="n">ref</span> <span class="p">(</span><span class="n">option</span> <span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>True if the current syntax does not generate constructor arity,
which is the case of the normal syntax, and not of the revised
one. This has an impact when converting Camlp5 syntax tree into
OCaml compiler syntax tree.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">no_constructors_arity</span> <span class="p">:</span> <span class="n">ref</span> <span class="nb">bool</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="directives">
<span id="id26"></span><h2>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h2>
<p>Directives in normal or revised syntax are statements at top level,
or, more generally, as signature items or structure items, which
stops the preprocessor for evaluate things - which can change the
behaviour of the preprocessor, for example to add syntax, load
syntax extensions and so on. After the directive is evaluated,
the parsing resumes.</p>
<p>Directives begin with ‘#’, followed by an identifier, and,
optionnally by an expression. They are usable in source files the
and generally in the ocaml toplevel too.</p>
<p>Four predefined directives exist: <code class="docutils literal"><span class="pre">#load</span></code>, <code class="docutils literal"><span class="pre">#directory</span></code>, <code class="docutils literal"><span class="pre">#option</span></code> and
<code class="docutils literal"><span class="pre">#use</span></code>. It is also possible to add other directives. An example of
that is the parsing kit <a class="reference internal" href="#pragma"><span class="std std-ref">pa_pragma.cmo</span></a>
which adds a new directive <code class="docutils literal"><span class="pre">#pragma</span></code>.</p>
<div class="section" id="predefined-directives">
<h3>Predefined directives<a class="headerlink" href="#predefined-directives" title="Permalink to this headline">¶</a></h3>
<p>The predefined directives are:</p>
<div class="section" id="load-name">
<h4><code class="docutils literal"><span class="pre">#load</span> <span class="pre">&quot;name&quot;</span></code><a class="headerlink" href="#load-name" title="Permalink to this headline">¶</a></h4>
<p>Loads an object file (ocaml cmo or cma file) in the core,
evaluating it.  This is typically to be used in the ocaml toplevel
to add an syntax extension kit.</p>
<p>For example, in the toplevel, loading
the <a class="reference internal" href="#quot"><span class="std std-ref">Quotations</span></a> expander
of <a class="reference internal" href="#ast-strict"><span class="std std-ref">ML Syntax tree - strict mode</span></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># #load &quot;q_MLast.cmo&quot;;</span>

<span class="c1"># value loc = Ploc.dummy;</span>
<span class="n">value</span> <span class="n">loc</span> <span class="p">:</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>

<span class="c1"># &lt;:expr&lt; fun x -&gt; x &gt;&gt;;</span>
<span class="o">-</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span>
<span class="n">MLast</span><span class="o">.</span><span class="n">ExFun</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span>
  <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span>
     <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaLid</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="kc">None</span><span class="p">,</span>
       <span class="n">MLast</span><span class="o">.</span><span class="n">ExLid</span> <span class="o">&lt;</span><span class="n">abstr</span><span class="o">&gt;</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">VaVal</span> <span class="s2">&quot;x&quot;</span><span class="p">))])</span>
</pre></div>
</div>
<p>In a source file, the <code class="docutils literal"><span class="pre">#load</span></code> directive is equivalent to put the
object file as camlp5 parameter among the ‘load options’:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat myfile.ml

#load &quot;pa_extend.cmo&quot;;
value g = Grammar.gcreate (Plexer.gmake ());
value e = Grammar.Entry.create g &quot;e&quot;;

EXTEND e: [[ i = INT -&gt; i ]]; END;

$ ocamlc -pp camlp5r -I +camlp5 -c myfile.ml
</pre></div>
</div>
<p>which is equivalent to, without using <code class="docutils literal"><span class="pre">#load</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat myfile2.ml

value g = Grammar.gcreate (Plexer.gmake ());
value e = Grammar.Entry.create g &quot;e&quot;;

EXTEND e: [[ i = INT -&gt; i ]]; END;
</pre></div>
</div>
<p>and compiling it like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ocamlc -pp &#39;camlp5r pa_extend.cmo&#39; -I +camlp5 -c myfile2.ml
</pre></div>
</div>
</div>
<div class="section" id="directory-name">
<h4><code class="docutils literal"><span class="pre">#directory</span> <span class="pre">&quot;name&quot;</span></code><a class="headerlink" href="#directory-name" title="Permalink to this headline">¶</a></h4>
<p>Adds a new directory in the camlp5 path searching for loaded files
(using the directive #load above). This is equivalent to the option
<code class="docutils literal"><span class="pre">-I</span></code> of the <code class="docutils literal"><span class="pre">camlp5</span></code> command. See the <code class="docutils literal"><span class="pre">camlp5</span></code> man page.</p>
</div>
<div class="section" id="use-name">
<h4><code class="docutils literal"><span class="pre">#use</span> <span class="pre">&quot;name&quot;</span></code><a class="headerlink" href="#use-name" title="Permalink to this headline">¶</a></h4>
<p>Loads a source file name. Useful in the ocaml toplevel to test a
source file.</p>
</div>
<div class="section" id="option-option">
<h4><code class="docutils literal"><span class="pre">#option</span> <span class="pre">&quot;option&quot;</span></code><a class="headerlink" href="#option-option" title="Permalink to this headline">¶</a></h4>
<p>Adds an option as if it were added in <code class="docutils literal"><span class="pre">camlp5</span></code> command line (to be
used in a source file, not in the ocaml toplevel). Implemented
only on options without an extra parameter.</p>
<p>For example, the syntax kit <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">pa_extend.cmo</span></a> adds an option named
<code class="docutils literal"><span class="pre">-split_ext</span></code>. This can be viewed through the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">camlp5r</span> <span class="n">pa_extend</span><span class="o">.</span><span class="n">cmo</span> <span class="o">-</span><span class="n">help</span>
</pre></div>
</div>
<p>Thanks to the directive <code class="docutils literal"><span class="pre">#option</span></code>, the following command in the
shell:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ camlp5r pa_extend.cmo -split_ext file.ml
</pre></div>
</div>
<p>can be used only as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ camlp5r file.ml
</pre></div>
</div>
<p>providing the file starts with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#load &quot;pa_extend.cmo&quot;;</span>
<span class="c1">#option &quot;-split_ext&quot;;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="user-directives">
<h3>User directives<a class="headerlink" href="#user-directives" title="Permalink to this headline">¶</a></h3>
<p>It is possible to add any extra directive. The syntax
kit <a class="reference internal" href="#pragma"><span class="std std-ref">pragma.cmo</span></a>, for example, adds a
directive named <code class="docutils literal"><span class="pre">#pragma</span></code>.</p>
<p>A user syntax kit can add its directives using the function
<code class="docutils literal"><span class="pre">add_directive</span></code> of the module <a class="reference internal" href="#pcaml"><span class="std std-ref">Pcaml</span></a>.</p>
</div>
</div>
<div class="section" id="extensions-of-syntax">
<span id="syntext"></span><h2>Extensions of syntax<a class="headerlink" href="#extensions-of-syntax" title="Permalink to this headline">¶</a></h2>
<p>Camlp5 allows one to extend the syntax of the OCaml language, and
even change the entire syntax.</p>
<p>It uses for that one of its parsing tools:
the <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">extensible grammars</span></a>.</p>
<p>To understand the whole syntax in the examples given in this
chapter, it is good to understand this parsing tool (the extensible
grammars), but we shall try to give some minimal explanations to
allow the reader to follow them.</p>
<p>A syntax extension is an OCaml object file (ending with “.cmo” or
“.cma”) which is loaded inside Camlp5. The source of this file uses
calls to the specific statement EXTEND applied to entries defined in
the Camlp5 module <code class="docutils literal"><span class="pre">Pcaml</span></code>.</p>
<div class="section" id="id27">
<h3>Entries<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>The grammar of OCaml contains several entries, corresponding to the
major notions of the language, which are modifiable this way, and
even erasable. They are defined in this module <code class="docutils literal"><span class="pre">Pcaml</span></code>.</p>
<p>Most important entries:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">expr</span></code>: the expressions.</li>
<li><code class="docutils literal"><span class="pre">patt</span></code>: the patterns.</li>
<li><code class="docutils literal"><span class="pre">ctyp</span></code>: the types.</li>
<li><code class="docutils literal"><span class="pre">str_item</span></code>: the structure items, i.e. the items between “struct”
and “end”, and the toplevel phrases in a “.ml” file.</li>
<li><code class="docutils literal"><span class="pre">sig_item</span></code>: the signature items, i.e. the items between “sig” and
“end”, and the toplevel phrases in a “.mli” file.</li>
<li><code class="docutils literal"><span class="pre">module_expr</span></code>: the module expressions.</li>
<li><code class="docutils literal"><span class="pre">module_type</span></code>: the module types.</li>
</ul>
<p>Entries of object programming:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">class_expr</span></code>: the class expressions.</li>
<li><code class="docutils literal"><span class="pre">class_type</span></code>: the class types.</li>
<li><code class="docutils literal"><span class="pre">class_str_item</span></code>: the objects items.</li>
<li><code class="docutils literal"><span class="pre">class_sig_item</span></code>: the objects types items.</li>
</ul>
<p>Main entries of files and interactive toplevel parsing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">implem</span></code>: the phrases that can be found in a “.ml” file.</li>
<li><code class="docutils literal"><span class="pre">interf</span></code>: the phrases that can be found in a “.mli” file.</li>
<li><code class="docutils literal"><span class="pre">top_phrase</span></code>: the phrases of the interactive toplevel.</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">use_file</span></code>: the phrases that can be found in a file included by</dt>
<dd>the directive “use”.</dd>
</dl>
</li>
</ul>
<p>Extra useful entries also accessible:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">let_binding</span></code>: the bindings “expression = pattern” found in the
“let” statement.</li>
<li><code class="docutils literal"><span class="pre">type_declaration</span></code>: the bindings “name = type” found in the “type”
statement.</li>
</ul>
</div>
<div class="section" id="syntax-tree-quotations">
<h3>Syntax tree quotations<a class="headerlink" href="#syntax-tree-quotations" title="Permalink to this headline">¶</a></h3>
<p>A grammar rule is a list of rule symbols followed by the semantic
action, i.e. the result of the rule. This result is a syntax tree,
whose type is the type of the extended entry. The description of the
types of the syntax tree are in the Camlp5 module
<code class="docutils literal"><span class="pre">MLast</span></code>.</p>
<p>There is however a simpler way to make values of these syntax tree
types: the system quotations (see chapters
about <a class="reference internal" href="#quot"><span class="std std-ref">quotations</span></a>
and <a class="reference internal" href="#ml-ast"><span class="std std-ref">syntax tree</span></a>). With this system, it is
possible to represent syntax tree in concrete syntax, between
specific parentheses, namely <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> and
<code class="docutils literal"><span class="pre">&gt;&gt;</span></code>, or between <code class="docutils literal"><span class="pre">&lt;:name&lt;</span></code> and
<code class="docutils literal"><span class="pre">&gt;&gt;</span></code>.</p>
<p>For example, the syntax node of the “if” statement is, normally:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExIfe</span> <span class="n">loc</span> <span class="n">e1</span> <span class="n">e2</span> <span class="n">e3</span>
</pre></div>
</div>
<p>where loc is the source location, and e1, e2, e3 are the
expressions constituting the if statement. With quotations, it is
possible to write it like this (which is stricly equivalent because
this is evaluated at parse time, not execution time):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; if $e1$ then $e2$ else $e3$ &gt;&gt;
</pre></div>
</div>
<p>With quotations, it is possible to build pieces of program as
complex as desired. See the chapter
about <a class="reference internal" href="#ml-ast"><span class="std std-ref">syntax trees</span></a>.</p>
</div>
<div class="section" id="an-example-repeat-until">
<span id="syntext-repeat-until"></span><h3>An example : repeat..until<a class="headerlink" href="#an-example-repeat-until" title="Permalink to this headline">¶</a></h3>
<p>A classical extension is the creation of the “repeat” statement.
The “repeat” statement is like a “while” except that the loop is
executed at least one time and that the test is at the end of the
loop and is inverted. The equivalent of:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">repeat</span> <span class="n">x</span><span class="p">;</span> <span class="n">y</span><span class="p">;</span> <span class="n">z</span> <span class="n">until</span> <span class="n">c</span>
</pre></div>
</div>
<p>is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">do</span> <span class="p">{</span>
  <span class="n">x</span><span class="p">;</span> <span class="n">y</span><span class="p">;</span> <span class="n">z</span><span class="p">;</span>
  <span class="k">while</span> <span class="ow">not</span> <span class="n">c</span> <span class="n">do</span> <span class="p">{</span> <span class="n">x</span><span class="p">;</span> <span class="n">y</span><span class="p">;</span> <span class="n">z</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>or, with a loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">loop</span> <span class="p">()</span> <span class="n">where</span> <span class="n">rec</span> <span class="n">loop</span> <span class="p">()</span> <span class="o">=</span> <span class="n">do</span> <span class="p">{</span>
  <span class="n">x</span><span class="p">;</span> <span class="n">y</span><span class="p">;</span> <span class="n">z</span><span class="p">;</span>
  <span class="k">if</span> <span class="n">c</span> <span class="n">then</span> <span class="p">()</span> <span class="k">else</span> <span class="n">loop</span> <span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="the-code">
<h4>The code<a class="headerlink" href="#the-code" title="Permalink to this headline">¶</a></h4>
<p>This syntax extension could be written like this (see the detail of
syntax in the chapter about <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">extensible grammars</span></a> and
the syntax tree quotations in the chapter about <a class="reference internal" href="#ml-ast"><span class="std std-ref">them</span></a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#load &quot;pa_extend.cmo&quot;;
#load &quot;q_MLast.cmo&quot;;
open Pcaml;
EXTEND
  expr:
    [ [ &quot;repeat&quot;; el = LIST1 expr SEP &quot;;&quot;; &quot;until&quot;; c = expr -&gt;
          let el = el @ [&lt;:expr&lt; while not $c$ do { $list:el$ } &gt;&gt;] in
          &lt;:expr&lt; do { $list:el$ } &gt;&gt; ] ]
  ;
END;
</pre></div>
</div>
<p>Alternatively, with the loop version:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#load &quot;pa_extend.cmo&quot;;
#load &quot;q_MLast.cmo&quot;;
open Pcaml;
EXTEND
  expr:
    [ [ &quot;repeat&quot;; el = LIST1 expr SEP &quot;;&quot;; &quot;until&quot;; c = expr -&gt;
          let el = el @ [&lt;:expr&lt; if $c$ then () else loop () &gt;&gt;] in
          &lt;:expr&lt; loop () where rec loop () = do { $list:el$ } &gt;&gt; ] ]
  ;
END;
</pre></div>
</div>
<p>The first <code class="docutils literal"><span class="pre">#load</span></code> in the code (in both files) means that a
syntax extension has been used in the file, namely the “EXTEND”
statement. The second <code class="docutils literal"><span class="pre">#load</span></code> means that abstract
tree <a class="reference internal" href="#quot"><span class="std std-ref">quotations</span></a> has been used, namely the
<code class="docutils literal"><span class="pre">&lt;:expr&lt;</span> <span class="pre">...</span> <span class="pre">&gt;&gt;</span></code>.</p>
<p>The quotation, found in the second version:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; loop () where rec loop () = do { $list:el$ } &gt;&gt;
</pre></div>
</div>
<p>is especially interesting. Written with abstract syntax tree, it would
be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLet</span> <span class="n">loc</span> <span class="kc">True</span>
  <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaLid</span> <span class="n">loc</span> <span class="s2">&quot;loop&quot;</span><span class="p">,</span>
    <span class="n">MLast</span><span class="o">.</span><span class="n">ExFun</span> <span class="n">loc</span> <span class="p">[(</span><span class="n">MLast</span><span class="o">.</span><span class="n">PaUid</span> <span class="n">loc</span> <span class="s2">&quot;()&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">MLast</span><span class="o">.</span><span class="n">ExSeq</span> <span class="n">loc</span> <span class="n">el</span><span class="p">)])]</span>
  <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExApp</span> <span class="n">loc</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExLid</span> <span class="n">loc</span> <span class="s2">&quot;loop&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">MLast</span><span class="o">.</span><span class="n">ExUid</span> <span class="n">loc</span> <span class="s2">&quot;()&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>This shows the interest of writing abstract syntax tree with quotations:
it is easier to program and to understand.</p>
</div>
<div class="section" id="compilation">
<h4>Compilation<a class="headerlink" href="#compilation" title="Permalink to this headline">¶</a></h4>
<p>If the file “foo.ml” contains one of these versions, it is possible to
compile it like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="o">-</span><span class="n">c</span> <span class="n">foo</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>Notice that the ocamlc option “-c” means that we are interested
only in generating the object file “foo.cmo”, not achieving the
compilation by creating an executable. Anyway the link would not
work because of usage of modules specific to Camlp5.</p>
</div>
<div class="section" id="testing">
<h4>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h4>
<div class="section" id="in-the-ocaml-toplevel">
<h5>In the OCaml toplevel<a class="headerlink" href="#in-the-ocaml-toplevel" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocaml</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="n">camlp5r</span><span class="o">.</span><span class="n">cma</span>
        <span class="n">Objective</span> <span class="n">Caml</span> <span class="n">version</span> <span class="o">...</span>

        <span class="n">Camlp5</span> <span class="n">Parsing</span> <span class="n">version</span> <span class="o">...</span>

<span class="c1"># #load &quot;foo.cmo&quot;;</span>
<span class="c1"># value x = ref 42;</span>
<span class="n">value</span> <span class="n">x</span> <span class="p">:</span> <span class="n">ref</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="o">=</span><span class="mi">42</span><span class="p">}</span>
<span class="c1"># repeat</span>
    <span class="n">print_int</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span><span class="p">;</span> <span class="n">print_endline</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">3</span>
  <span class="n">until</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">;</span>
<span class="mi">42</span>
<span class="mi">45</span>
<span class="mi">48</span>
<span class="mi">51</span>
<span class="mi">54</span>
<span class="mi">57</span>
<span class="mi">60</span>
<span class="mi">63</span>
<span class="mi">66</span>
<span class="mi">69</span>
<span class="o">-</span> <span class="p">:</span> <span class="n">unit</span> <span class="o">=</span> <span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="in-a-file">
<h5>In a file<a class="headerlink" href="#in-a-file" title="Permalink to this headline">¶</a></h5>
<p>The code, above, used in the toplevel, can be written in a file,
say “bar.ml”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#load &quot;./foo.cmo&quot;;</span>
<span class="n">value</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">42</span><span class="p">;</span>
<span class="n">repeat</span>
  <span class="n">print_int</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span><span class="p">;</span>
  <span class="n">print_endline</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">3</span>
<span class="n">until</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">;</span>
</pre></div>
</div>
<p>with a subtile difference: the loaded file must be <code class="docutils literal"><span class="pre">./foo.cmo</span></code>
and not just <code class="docutils literal"><span class="pre">foo.cmo</span></code> because Camlp5 does not have, by default,
the current directory in its path.</p>
<p>The file can be compiled like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="n">bar</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>or in native code:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlopt</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="n">bar</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>And it is possible to check the resulting program by typing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">camlp5r</span> <span class="n">pr_r</span><span class="o">.</span><span class="n">cmo</span> <span class="n">bar</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>whose displayed result is:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#load &quot;./foo.cmo&quot;;</span>
<span class="n">value</span> <span class="n">x</span> <span class="o">=</span> <span class="n">ref</span> <span class="mi">42</span><span class="p">;</span>
<span class="n">do</span> <span class="p">{</span>
  <span class="n">print_int</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span><span class="p">;</span>
  <span class="n">print_endline</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
  <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">while</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">)</span> <span class="n">do</span> <span class="p">{</span>
    <span class="n">print_int</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span><span class="p">;</span>
    <span class="n">print_endline</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span> <span class="mi">3</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>See also the <a class="reference internal" href="#opretty-example-repeat-until"><span class="std std-ref">same example</span></a> pretty
printed in its original syntax, using the extendable <a class="reference internal" href="#opretty"><span class="std std-ref">programs
printing</span></a>.</p>
</div>
</div>
</div>
</div>
<div class="section" id="extensions-of-printing">
<span id="opretty"></span><h2>Extensions of printing<a class="headerlink" href="#extensions-of-printing" title="Permalink to this headline">¶</a></h2>
<p>Camlp5 provides extensions kits to pretty print programs in revised
syntax and normal syntax. Some other extensions kits also allow to
rebuild the parsers, or the EXTEND statements in their initial
syntax. The pretty print system is itself extensible, by adding new
rules. We present here how it works in the Camlp5 sources.</p>
<p>The pretty print system of Camlp5 uses the library modules
<a class="reference internal" href="prtools.html#pretty"><span class="std std-ref">Pretty</span></a>, an original system to format
output) and <a class="reference internal" href="#extfun"><span class="std std-ref">Extfun</span></a>, another original
system of extensible functions.</p>
<p>This chapter is designed for programmers that want to understand
how the pretty printing of OCaml programs work in Camlp5, want to
adapt, modify or debug it, or want to add their own pretty printing
extensions.</p>
<div class="section" id="id28">
<h3>Introduction<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h3>
<p>The files doing the pretty printings are located in Camlp5 sources
in the directory “etc”. Peruse them if you are interested in creating
new ones. The main ones are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">etc/pr_r.ml</span></code>: pretty print in revised syntax.</li>
<li><code class="docutils literal"><span class="pre">etc/pr_o.ml</span></code>: pretty print in normal syntax.</li>
<li><code class="docutils literal"><span class="pre">etc/pr_rp.ml</span></code>: rebuilding parsers in their original revised
syntax.</li>
<li><code class="docutils literal"><span class="pre">etc/pr_op.ml</span></code>: rebuilding parsers in their original normal
syntax.</li>
<li><code class="docutils literal"><span class="pre">etc/pr_extend.ml</span></code>: rebuilding EXTEND in its original syntax.</li>
</ul>
<p>We present here how this system works inside these files. First,
the general principles. Second, more details of the
implementation.</p>
</div>
<div class="section" id="principles">
<h3>Principles<a class="headerlink" href="#principles" title="Permalink to this headline">¶</a></h3>
<div class="section" id="using-module-pretty">
<h4>Using module Pretty<a class="headerlink" href="#using-module-pretty" title="Permalink to this headline">¶</a></h4>
<p>All functions in OCaml pretty printing take a parameter named “the
printing context” (variable <code class="docutils literal"><span class="pre">pc</span></code>). It is a record holding :</p>
<ul class="simple">
<li>The current indendation : <code class="docutils literal"><span class="pre">pc.ind</span></code></li>
<li>What should be printed before, in the same line : <code class="docutils literal"><span class="pre">pc.bef</span></code></li>
<li>What should be printed after, in the same line : <code class="docutils literal"><span class="pre">pc.aft</span></code></li>
<li>The dangling token, useful in normal syntax to know whether
parentheses are necessary : <code class="docutils literal"><span class="pre">pc.dang</span></code></li>
</ul>
<p>A typical pretty printing function calls the
function <code class="docutils literal"><span class="pre">horiz_vertic</span></code> of the library
module <a class="reference internal" href="prtools.html#pretty"><span class="std std-ref">Pretty</span></a>. This function takes two
functions as parameter:</p>
<ul class="simple">
<li>The way to print the data in one only line (<em>horizontal</em> printing)</li>
<li>The way to print the data in two or more lines (<em>vertical</em> printing)</li>
</ul>
<p>Both functions catenate the strings by using the
function <code class="docutils literal"><span class="pre">sprintf</span></code> of the library
module <code class="docutils literal"><span class="pre">Pretty</span></code> which controls whether the printed data
holds in the line or not. They generally call, recursively, other
pretty printing functions with the same behaviour.</p>
<p>Let us see an example (fictitious) of printing an OCaml
application. Let us suppose we have an application expression
<code class="docutils literal"><span class="pre">e1</span> <span class="pre">e2</span></code> to pretty print where <code class="docutils literal"><span class="pre">e1</span></code>
and <code class="docutils literal"><span class="pre">e2</span></code> are sub-expressions. If both expressions and
their application holds on one only line, we want to see:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e1</span> <span class="n">e2</span>
</pre></div>
</div>
<p>On the other hand, if they do not hold on one only line, we want to
see <code class="docutils literal"><span class="pre">e2</span></code> in another line with, say, an indendation of 2
spaces:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e1</span>
  <span class="n">e2</span>
</pre></div>
</div>
<p>Here is a possible implementation. The function has been
named <code class="docutils literal"><span class="pre">expr_app</span></code> and can call the function <code class="docutils literal"><span class="pre">expr</span></code> to
print the sub-expressions <code class="docutils literal"><span class="pre">e1</span></code> and <code class="docutils literal"><span class="pre">e2</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">expr_app</span> <span class="n">pc</span> <span class="n">e1</span> <span class="n">e2</span> <span class="o">=</span>
  <span class="n">horiz_vertic</span>
    <span class="p">(</span><span class="n">fun</span> <span class="p">()</span> <span class="o">-&gt;</span>
       <span class="n">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">expr</span> <span class="p">{(</span><span class="n">pc</span><span class="p">)</span> <span class="k">with</span> <span class="n">aft</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">}</span> <span class="n">e1</span> <span class="ow">in</span>
       <span class="n">let</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">expr</span> <span class="p">{(</span><span class="n">pc</span><span class="p">)</span> <span class="k">with</span> <span class="n">bef</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">}</span> <span class="n">e2</span> <span class="ow">in</span>
       <span class="n">sprintf</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="n">s1</span> <span class="n">s2</span><span class="p">)</span>
    <span class="p">(</span><span class="n">fun</span> <span class="p">()</span> <span class="o">-&gt;</span>
       <span class="n">let</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">expr</span> <span class="p">{(</span><span class="n">pc</span><span class="p">)</span> <span class="k">with</span> <span class="n">aft</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">}</span> <span class="n">e1</span> <span class="ow">in</span>
       <span class="n">let</span> <span class="n">s2</span> <span class="o">=</span>
         <span class="n">expr</span>
           <span class="p">{(</span><span class="n">pc</span><span class="p">)</span> <span class="k">with</span>
              <span class="n">ind</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
              <span class="n">bef</span> <span class="o">=</span> <span class="n">tab</span> <span class="p">(</span><span class="n">pc</span><span class="o">.</span><span class="n">ind</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)}</span>
           <span class="n">e2</span>
       <span class="ow">in</span>
       <span class="n">sprintf</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="n">s1</span> <span class="n">s2</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
<p>The first function is the <em>horizontal</em> printing. It ends with a
<code class="docutils literal"><span class="pre">sprintf</span></code> separating the printing of <code class="docutils literal"><span class="pre">e1</span></code>
and <code class="docutils literal"><span class="pre">e2</span></code> by a space. The possible “before part”
(<code class="docutils literal"><span class="pre">pc.bef</span></code>) and “after part” (<code class="docutils literal"><span class="pre">pc.aft</span></code>) are
transmitted in the calls of the sub-functions.</p>
<p>The second function is the <em>vertical</em> printing. It ends with a
<code class="docutils literal"><span class="pre">sprintf</span></code> separating the printing of <code class="docutils literal"><span class="pre">e1</span></code>
and <code class="docutils literal"><span class="pre">e2</span></code> by a newline. The second line starts with an
indendation, using the “before part” (<code class="docutils literal"><span class="pre">pc.bef</span></code>) of the
second call to <code class="docutils literal"><span class="pre">expr</span></code>.</p>
<p>The pretty printing library
function <code class="docutils literal"><span class="pre">Pretty.horiz_vertic</span></code> calls the first
(<em>horizontal</em>) function, and if it fails (either
because <code class="docutils literal"><span class="pre">s1</span></code> or <code class="docutils literal"><span class="pre">s2</span></code> are too long or hold
newlines, or because the final string produced
by <code class="docutils literal"><span class="pre">sprintf</span></code> is too long), calls the second
(<em>vertical</em>) function.</p>
<p>Notice that the parameter <code class="docutils literal"><span class="pre">pc</span></code> contains a
field <code class="docutils literal"><span class="pre">pc.bef</span></code> (what should be printed before in the same
line), which in both cases is transmitted to the printing
of <code class="docutils literal"><span class="pre">e1</span></code> (since the syntax <code class="docutils literal"><span class="pre">{(pc)</span> <span class="pre">with</span> <span class="pre">aft</span> <span class="pre">=</span>
<span class="pre">&quot;&quot;}</span></code> is a record with <code class="docutils literal"><span class="pre">pc.bef</span></code> kept). Same for the
field <code class="docutils literal"><span class="pre">pc.aft</span></code> transmitted to the printing
of <code class="docutils literal"><span class="pre">e2</span></code>.</p>
</div>
<div class="section" id="using-extend-printer-statement">
<h4>Using EXTEND_PRINTER statement<a class="headerlink" href="#using-extend-printer-statement" title="Permalink to this headline">¶</a></h4>
<p>This system is combined to the <a class="reference internal" href="prtools.html#printers"><span class="std std-ref">extensible printers</span></a> to
allow the extensibility of the pretty printing.</p>
<p>The code above actually looks like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>EXTEND_PRINTER
  pr_expr:
    [ [ &lt;:expr&lt; $e1$ $e2$ &gt;&gt; -&gt;
          horiz_vertic
            (fun () -&gt;
               let s1 = curr {(pc) with aft = &quot;&quot;} e1 in
               let s2 = next {(pc) with bef = &quot;&quot;} e2 in
               sprintf &quot;%s %s&quot; s1 s2)
            (fun () -&gt;
               let s1 = curr {(pc) with aft = &quot;&quot;} e1 in
               let s2 =
                 next
                   {(pc) with
                      ind = pc.ind + 2;
                      bef = tab (pc.ind + 2)}
                   e2
               in
               sprintf &quot;%s\n%s&quot; s1 s2) ] ]
  ;
END;
</pre></div>
</div>
<p>The variable <code class="docutils literal"><span class="pre">pc</span></code> is implicit in the semantic actions of
the syntax <code class="docutils literal"><span class="pre">EXTEND_PRINTER</span></code>, as well as two other
variables: <code class="docutils literal"><span class="pre">curr</span></code> and <code class="docutils literal"><span class="pre">next</span></code>.</p>
<p>These parameters, <code class="docutils literal"><span class="pre">curr</span></code> and <code class="docutils literal"><span class="pre">next</span></code>, correspond
to the pretty printing of, respectively, the current level and the
next level. Since the application in OCaml is left associative, the
first sub-expression is printed at the same (current) level and the
second one is printed at the next level. We also see a call
to <code class="docutils literal"><span class="pre">next</span></code> in the last (2nd) case of the function to treat
the other cases in the next level.</p>
</div>
<div class="section" id="dangling-else-bar-semicolon">
<h4>Dangling else, bar, semicolon<a class="headerlink" href="#dangling-else-bar-semicolon" title="Permalink to this headline">¶</a></h4>
<p>In normal syntax, there are cases where it is necessary to enclose
expressions between parentheses (or
between <code class="docutils literal"><span class="pre">begin</span></code> and <code class="docutils literal"><span class="pre">end</span></code>, which is equivalent in
that syntax). Three tokens may cause problems: the
“<code class="docutils literal"><span class="pre">else</span></code>”, the vertical bar “<code class="docutils literal"><span class="pre">|</span></code>” and the
semicolon “<code class="docutils literal"><span class="pre">;</span></code>”. Here are examples where the presence of
these tokens constrains the previous expression to be
parenthesized. In these three examples, removing
the <code class="docutils literal"><span class="pre">begin..end</span></code>
enclosers would change the meaning of the expression because the
dangling token would be included in that expression:</p>
<p>Dangling else:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">a</span> <span class="n">then</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;parenthesis&quot;</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="k">if</span> <span class="n">b</span> <span class="n">then</span> <span class="n">c</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;parenthesis&quot;</span><span class="o">&gt;</span><span class="n">end</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;dangling&quot;</span><span class="o">&gt;</span><span class="k">else</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">d</span>
</pre></div>
</div>
<p>Dangling bar:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">function</span>
  <span class="n">A</span> <span class="o">-&gt;</span>
    <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;parenthesis&quot;</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">match</span> <span class="n">a</span> <span class="k">with</span>
      <span class="n">B</span> <span class="o">-&gt;</span> <span class="n">c</span>
    <span class="o">|</span> <span class="n">D</span> <span class="o">-&gt;</span> <span class="n">e</span>
    <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;parenthesis&quot;</span><span class="o">&gt;</span><span class="n">end</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;dangling&quot;</span><span class="o">&gt;|&lt;/</span><span class="n">span</span><span class="o">&gt;</span> <span class="n">F</span> <span class="o">-&gt;</span> <span class="n">g</span>
</pre></div>
</div>
<p>Dangling semicolon:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">a</span> <span class="n">then</span> <span class="n">b</span>
<span class="k">else</span> <span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;parenthesis&quot;</span><span class="o">&gt;</span><span class="n">begin</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
  <span class="n">let</span> <span class="n">c</span> <span class="o">=</span> <span class="n">d</span> <span class="ow">in</span>
  <span class="n">e</span>
<span class="o">&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;parenthesis&quot;</span><span class="o">&gt;</span><span class="n">end</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">span</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;dangling&quot;</span><span class="o">&gt;</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">span</span><span class="o">&gt;</span>
<span class="n">f</span>
</pre></div>
</div>
<p>The information is transmitted by the
value <code class="docutils literal"><span class="pre">pc.dang</span></code>. In the first example above, while
displaying the “<code class="docutils literal"><span class="pre">then</span></code>” part of the outer
“<code class="docutils literal"><span class="pre">if</span></code>”, the sub-expression is called with the
value <code class="docutils literal"><span class="pre">pc.dang</span></code> set to
<code class="docutils literal"><span class="pre">&quot;else&quot;</span></code> to inform the last sub-sub-expression that it is
going to be followed by that token. When a “<code class="docutils literal"><span class="pre">if</span></code>”
expression should be displayed without “<code class="docutils literal"><span class="pre">else</span></code>” part, and
that its “<code class="docutils literal"><span class="pre">pc.dang</span></code>” is “else”, it should be enclosed
with spaces.</p>
<p>This problem does not exist in revised syntax. While pretty
printing in revised syntax, the parameter <code class="docutils literal"><span class="pre">pc.dang</span></code> is
not necessary and remains the empty string.</p>
</div>
<div class="section" id="by-level">
<h4>By level<a class="headerlink" href="#by-level" title="Permalink to this headline">¶</a></h4>
<p>As explained in the chapter about
the <a class="reference internal" href="prtools.html#printers"><span class="std std-ref">extensible printers</span></a> (with the
EXTEND_PRINTER statement), printers contain levels. The global
printer variable of expressions is named <code class="docutils literal"><span class="pre">pr_expr</span></code> and
contain all definitions for pretty printing expressions, organized
by levels, just like the parsing of expressions. The definition of
<code class="docutils literal"><span class="pre">pr_expr</span></code> actually looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">EXTEND_PRINTER</span>
  <span class="n">pr_expr</span><span class="p">:</span>
    <span class="p">[</span> <span class="s2">&quot;top&quot;</span>
      <span class="p">[</span> <span class="p">(</span><span class="o">*</span> <span class="n">code</span> <span class="k">for</span> <span class="n">level</span> <span class="s2">&quot;top&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="p">]</span>
    <span class="o">|</span> <span class="s2">&quot;add&quot;</span>
      <span class="p">[</span> <span class="p">(</span><span class="o">*</span> <span class="n">code</span> <span class="k">for</span> <span class="n">level</span> <span class="s2">&quot;add&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="p">]</span>
    <span class="o">|</span> <span class="s2">&quot;mul&quot;</span>
      <span class="p">[</span> <span class="p">(</span><span class="o">*</span> <span class="n">code</span> <span class="k">for</span> <span class="n">level</span> <span class="s2">&quot;mul&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="p">]</span>
    <span class="o">|</span> <span class="s2">&quot;apply&quot;</span>
      <span class="p">[</span> <span class="p">(</span><span class="o">*</span> <span class="n">code</span> <span class="k">for</span> <span class="n">level</span> <span class="s2">&quot;apply&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="p">]</span>
    <span class="o">|</span> <span class="s2">&quot;simple&quot;</span>
      <span class="p">[</span> <span class="p">(</span><span class="o">*</span> <span class="n">code</span> <span class="k">for</span> <span class="n">level</span> <span class="s2">&quot;add&quot;</span> <span class="o">*</span><span class="p">)</span> <span class="p">]</span> <span class="p">]</span>
  <span class="p">;</span>
<span class="n">END</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-prtools-module">
<h3>The Prtools module<a class="headerlink" href="#the-prtools-module" title="Permalink to this headline">¶</a></h3>
<p>The Prtools module is defined inside Camlp5 for pretty printing
kits. It provides variables and functions to process comments, and
meta-functions to process lists (horizontally, vertically,
paragraphly).</p>
<div class="section" id="comments">
<h4>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">comm_bef</span> <span class="pre">ind</span> <span class="pre">loc</span></code> get the comment from the source just before the
given location <code class="docutils literal"><span class="pre">loc</span></code>. This comment may be reindented using
<code class="docutils literal"><span class="pre">ind</span></code>. Returns the empty string if no comment found.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">comm_bef</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">loc</span> <span class="o">-&gt;</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>The initial source string, which must be set by the pretty printing
kit. Used by [comm_bef] above.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">source</span> <span class="p">:</span> <span class="n">ref</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Set the minimum position of the source where comments can be found,
(to prevent possible duplication of comments).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">set_comm_min_pos</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="meta-functions-for-lists">
<h4>Meta functions for lists<a class="headerlink" href="#meta-functions-for-lists" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Type of printer functions.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">pr_fun</span> <span class="s1">&#39;a = pr_context -&gt; &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">[hlist</span> <span class="pre">elem</span> <span class="pre">pc</span> <span class="pre">el]</span></code> returns the horizontally pretty printed
string of a list of elements; elements are separated with
spaces.&lt;br/&gt;The list is displayed in one only line. If this function
is called in the context of the [horiz] function of the function
<code class="docutils literal"><span class="pre">[horiz_vertic]</span></code> of the module Printing, and if the line overflows
or contains newlines, the function internally fails (the exception
is catched by [horiz_vertic] for a vertical pretty print).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">hlist</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun (list &#39;</span><span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>horizontal list with a different function from 2nd element on.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">hlist2</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a);</span>
</pre></div>
</div>
<ul class="simple">
<li>horizontal list with a different function for the last element.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">hlistl</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a);</span>
</pre></div>
</div>
<ul class="simple">
<li>[vlist elem pc el] returns the vertically pretty printed string of a
list of elements; elements are separated with newlines and
indentations.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">vlist</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun (list &#39;</span><span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
<ul class="simple">
<li>vertical list with different function from 2nd element on.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">vlist2</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a);</span>
</pre></div>
</div>
<ul class="simple">
<li>vertical list with different function from 2nd element on, the
boolean value being True for the last element of the list.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">vlist3</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="s1">&#39;a * bool) -&gt; pr_fun (&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a);</span>
</pre></div>
</div>
<ul class="simple">
<li>vertical list with different function for the last element.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">vlistl</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a);</span>
</pre></div>
</div>
<ul class="simple">
<li>[plist elem sh pc el] returns the pretty printed string of a list of
elements with separators. The elements are printed horizontally as
far as possible. When an element does not fit on the line, a newline
is added and the element is displayed in the next line with an
indentation of [sh]. [elem] is the function to print elements, [el]
a list of pairs (element * separator) (the last separator being
ignored).</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">plist</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; int -&gt; pr_fun (list (&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="n">string</span><span class="p">));</span>
</pre></div>
</div>
<ul class="simple">
<li>[plist elem sh pc el] returns the pretty printed string of the list
of elements, like with [plist] but the value of [pc.bef] corresponds
to an element already printed, as it were on the list. Therefore, if
the first element of [el] does not fit in the line, a newline and a
tabulation is added after [pc.bef].</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">plistb</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; int -&gt; pr_fun (list (&#39;</span><span class="n">a</span> <span class="o">*</span> <span class="n">string</span><span class="p">));</span>
</pre></div>
</div>
<ul class="simple">
<li>paragraph list with a different function for the last element.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">plistl</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="p">(</span><span class="s1">&#39;a * string));</span>
</pre></div>
</div>
<ul class="simple">
<li>applies <code class="docutils literal"><span class="pre">hlistl</span></code> if the context is horizontal; else applies
<code class="docutils literal"><span class="pre">vlistl</span></code>.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">hvlistl</span> <span class="p">:</span> <span class="n">pr_fun</span> <span class="s1">&#39;a -&gt; pr_fun &#39;</span><span class="n">a</span> <span class="o">-&gt;</span> <span class="n">pr_fun</span> <span class="p">(</span><span class="nb">list</span> <span class="s1">&#39;a);</span>
</pre></div>
</div>
</div>
<div class="section" id="miscellaneous">
<h4>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>[tab ind] is equivalent to [String.make ind ‘ ‘]</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">tab</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>[flatten_sequence e]. If [e] is an expression representing a
sequence, return the list of expressions of the sequence. If some of
these expressions are already sequences, they are flattened in the
list. If that list contains expressions of the form let..in
sequence, this sub-sequence is also flattened with the let..in
applying only to the first expression of the sequence. If [e] is a
let..in sequence, it works the same way. If [e] is not a sequence
nor a let..in sequence, return None.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">flatten_sequence</span> <span class="p">:</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span> <span class="o">-&gt;</span> <span class="n">option</span> <span class="p">(</span><span class="nb">list</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="example-repeat-until">
<span id="opretty-example-repeat-until"></span><h3>Example : repeat..until<a class="headerlink" href="#example-repeat-until" title="Permalink to this headline">¶</a></h3>
<p>This pretty prints the example
<a class="reference internal" href="#syntext-repeat-until"><span class="std std-ref">repeat..until</span></a> statement programmed in the
chapter <a class="reference internal" href="#syntext"><span class="std std-ref">Syntax extensions</span></a> (first version generating a
<code class="docutils literal"><span class="pre">while</span></code> statement).</p>
<div class="section" id="id29">
<h4>The code<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>The pattern generated by the “repeat” statement is recognized
(sequence ending with a <code class="docutils literal"><span class="pre">while</span></code> whose contents is the same
than the beginning of the sequence) by the function “is_repeat” and
the repeat statement is pretty printed in its initial form using the
function “horiz_vertic” of the Pretty module. File
<code class="docutils literal"><span class="pre">pr_repeat.ml</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#load &quot;pa_extprint.cmo&quot;;
#load &quot;q_MLast.cmo&quot;;

open Pcaml;
open Pretty;
open Prtools;

value eq_expr_list el1 el2 =
  if List.length el1 &lt;&gt; List.length el2 then False
  else List.for_all2 eq_expr el1 el2
;

value is_repeat el =
  match List.rev el with
  [ [&lt;:expr&lt; while not $e$ do { $list:el2$ } &gt;&gt; :: rel1] -&gt;
      eq_expr_list (List.rev rel1) el2
  | _ -&gt; False ]
;

value semi_after pr pc = pr {(pc) with aft = sprintf &quot;%s;&quot; pc.aft};

EXTEND_PRINTER
  pr_expr:
    [ [ &lt;:expr&lt; do { $list:el$ } &gt;&gt; when is_repeat el -&gt;
          match List.rev el with
          [ [&lt;:expr&lt; while not $e$ do { $list:el$ } &gt;&gt; :: _] -&gt;
              horiz_vertic
                (fun () -&gt;
                   sprintf &quot;%srepeat %s until %s%s&quot; pc.bef
                     (hlistl (semi_after curr) curr
                        {(pc) with bef = &quot;&quot;; aft = &quot;&quot;} el)
                     (curr {(pc) with bef = &quot;&quot;; aft = &quot;&quot;} e)
                     pc.aft)
                (fun () -&gt;
                   let s1 = sprintf &quot;%srepeat&quot; (tab pc.ind) in
                   let s2 =
                     vlistl (semi_after curr) curr
                       {(pc) with
                        ind = pc.ind + 2;
                        bef = tab (pc.ind + 2);
                        aft = &quot;&quot;}
                       el
                   in
                   let s3 =
                     sprintf &quot;%suntil %s&quot; (tab pc.ind)
                       (curr {(pc) with bef = &quot;&quot;} e)
                   in
                   sprintf &quot;%s\n%s\n%s&quot; s1 s2 s3)
          | _ -&gt; assert False ] ] ]
  ;
END;
</pre></div>
</div>
</div>
<div class="section" id="id30">
<h4>Compilation<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="o">-</span><span class="n">c</span> <span class="n">pr_repeat</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
</div>
<div class="section" id="id31">
<h4>Testing<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<p>Getting the same files “foo.ml” and “bar.ml” of the repeat syntax
example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat bar.ml
#load &quot;./foo.cmo&quot;;
value x = ref 42;
repeat
  print_int x.val;
  print_endline &quot;&quot;;
  x.val := x.val + 3
until x.val &gt; 70;

$ camlp
</pre></div>
</div>
<p>Without the pretty printing kit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ camlp5r pr_r.cmo bar.ml
#load &quot;./foo.cmo&quot;;
value x = ref 42;
do {
  print_int x.val;
  print_endline &quot;&quot;;
  x.val := x.val + 3;
  while not (x.val &gt; 70) do {
    print_int x.val;
    print_endline &quot;&quot;;
    x.val := x.val + 3
  }
};
</pre></div>
</div>
<p>With the pretty printing kit:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ camlp5r pr_r.cmo ./pr_repeat.cmo bar.ml -l 75
#load &quot;./foo.cmo&quot;;
value x = ref 42;
repeat
  print_int x.val;
  print_endline &quot;&quot;;
  x.val := x.val + 3
until x.val &gt; 70;
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="redefining-ocaml-syntax">
<span id="redef"></span><h2>Redefining OCaml syntax<a class="headerlink" href="#redefining-ocaml-syntax" title="Permalink to this headline">¶</a></h2>
<p>Better than just &lt;a href=”syntext.html”&gt;syntax extensions&lt;/a&gt;, it is
possible to redefine the whole syntax of the language. For example,
to:</p>
<ul class="simple">
<li>define your own syntax, like the <a class="reference internal" href="#revsynt"><span class="std std-ref">revised syntax</span></a>
does,</li>
<li>have a version whose keywords are translated in your native
language,</li>
<li>restrict the OCaml language,</li>
<li>interpret XML (or other languages) as OCaml source,</li>
<li>and so on…</li>
</ul>
<div class="section" id="starting-with-an-example">
<h3>Starting with an example<a class="headerlink" href="#starting-with-an-example" title="Permalink to this headline">¶</a></h3>
<p>A way to start doing this is to take, in Camlp5 sources, one of the
files “etc/pa_o.ml” or file “meta/pa_r.ml”. The first one defines
the OCaml standard syntax and the second one the revised syntax.</p>
<p>Let’s say you want to take the normal syntax and make some
readjustments. You first make a copy of “etc/pa_o.ml” naming it,
e.g., “mysyntax.ml” (the example below works similarly if you
take “meta/pa_r.ml” instead):</p>
<p>To test, you can compile it with the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>ocamlc -pp camlp5r -I $(camlp5 -where) -c mysyntax.ml
</pre></div>
</div>
<p>This produces the file “mysyntax.cmo”. Now you can compile one of
your files, e.g. “foo.ml”, if written in this syntax, i.e. the
normal OCaml syntax if you made no changes in “mysyntax.ml”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="s1">&#39;camlp5 ./mysyntax.cmo pr_dump.cmo&#39;</span> <span class="o">-</span><span class="n">c</span> <span class="n">foo</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>If there is no changes in “mysyntax.ml” from “pa_o.ml”, this is
just a compilation with the normal OCaml syntax. To make changes,
you can edit the file “mysyntax.ml” and recompile it. As an
exercice, try to translate some keywords in your native language
(or another language if it is not English).</p>
<p>Reading the way Camlp5 <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">Extensible grammars</span></a> and <a class="reference internal" href="#ast-strict"><span class="std std-ref">syntax tree</span></a> work
(both used in “pa_o.ml” and “pa_r.ml”), you can make more
complicated changes or change everything, if you want.</p>
</div>
<div class="section" id="a-file-for-an-ocaml-syntax">
<h3>A file for an OCaml syntax<a class="headerlink" href="#a-file-for-an-ocaml-syntax" title="Permalink to this headline">¶</a></h3>
<p>This is what you can find in the files “pa_o.ml” and “pa_r.ml”.</p>
<p>An OCaml syntax files uses the Camlp5 library
module <a class="reference internal" href="#pcaml"><span class="std std-ref">Pcaml</span></a>. All grammar entries are
defined there. The first thing is the reinitialization of the
grammar (which clear all tokens and define a lexer) and all grammar
entries, to be sure that no possible previous loaded grammars
remain.</p>
<p>If using the same lexer (provided in Camlp5 library
module <a class="reference internal" href="appendix.html#library-plexer-module"><span class="std std-ref">Plexer</span></a>), it is
done by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Grammar</span><span class="o">.</span><span class="n">Unsafe</span><span class="o">.</span><span class="n">gram_reinit</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">gram</span> <span class="p">(</span><span class="n">Plexer</span><span class="o">.</span><span class="n">gmake</span> <span class="p">())</span>
</pre></div>
</div>
<p>The cleanup of all grammar entries are done by calls to the function
“Grammar.Unsafe.clear_entry”. The main entries are Pcaml.interf, for
compiling an interface (a “.mli” file) and Pcaml.implem, for compiling
an implementation (a “.ml” file). And all other grammars entries you
want to use must be cleared:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Grammar</span><span class="o">.</span><span class="n">Unsafe</span><span class="o">.</span><span class="n">clear_entry</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">interf</span><span class="p">;</span>
<span class="n">Grammar</span><span class="o">.</span><span class="n">Unsafe</span><span class="o">.</span><span class="n">clear_entry</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">implem</span><span class="p">;</span>
<span class="n">Grammar</span><span class="o">.</span><span class="n">Unsafe</span><span class="o">.</span><span class="n">clear_entry</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">expr</span><span class="p">;</span>
<span class="n">Grammar</span><span class="o">.</span><span class="n">Unsafe</span><span class="o">.</span><span class="n">clear_entry</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">patt</span><span class="p">;</span>
<span class="o">...</span>
</pre></div>
</div>
<p>Actually, the camlp5 command can compile the input file with other
ways than using the Camlp5 grammars. The variables “Pcaml.parse_interf”
and “Pcaml.parse_implem” are references to the functions called by
camlp5. By default, it is the Camlp5 grammar syntax, but to be sure
it goes on using it (if a previous load changed that), the following
statement are added:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Pcaml</span><span class="o">.</span><span class="n">parse_interf</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">parse</span> <span class="n">interf</span><span class="p">;</span>
<span class="n">Pcaml</span><span class="o">.</span><span class="n">parse_implem</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">parse</span> <span class="n">implem</span><span class="p">;</span>
</pre></div>
</div>
<p>In the files “pa_o.ml” and “pa_r.ml”, some local functions follow,
which are themselves followed by a call to the big statement
“EXTEND”, the main statement of the Camlp5 extensible grammars
system.</p>
</div>
</div>
<div class="section" id="quotations">
<span id="quot"></span><h2>Quotations<a class="headerlink" href="#quotations" title="Permalink to this headline">¶</a></h2>
<p>Quotations are a syntax extension in Camlp5 to build
expressions and patterns in any syntax independant from the one of
OCaml. Quotations are <em>expanded</em>, i.e. transformed, at parse
time to produce normal syntax trees, like the rest of the program.
Quotations <em>expanders</em> are normal OCaml functions writable by
any programmer.</p>
<p>The aim of quotations is to use concrete syntax for manipulating
abstract values.  That makes programs easier to write, read, modify,
and understand. The drawback is that quotations are linguistically isolated from the
rest of the program, in opposition to <a class="reference internal" href="#syntext"><span class="std std-ref">syntax extensions</span></a>, which are included in the language.</p>
<div class="section" id="id32">
<h3>Introduction<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>A quotation is syntactically enclosed by specific quotes formed by
less (<code class="docutils literal"><span class="pre">&lt;</span></code>) and greater (<code class="docutils literal"><span class="pre">&gt;</span></code>) signs. Namely:</p>
<ul class="simple">
<li>starting with either <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> or <code class="docutils literal"><span class="pre">&lt;:ident&lt;</span></code> where <code class="docutils literal"><span class="pre">ident</span></code> is the
quotation name,</li>
<li>ending with <code class="docutils literal"><span class="pre">&gt;&gt;</span></code></li>
</ul>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span> \<span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="n">x</span> <span class="o">&gt;&gt;</span>
<span class="o">&lt;</span><span class="p">:</span><span class="n">foo</span><span class="o">&lt;</span> <span class="n">hello</span><span class="p">,</span> <span class="n">world</span> <span class="o">&gt;&gt;</span>
<span class="o">&lt;</span><span class="p">:</span><span class="n">bar</span><span class="o">&lt;</span> <span class="o">@</span><span class="c1">#$%;* &gt;&gt;</span>
</pre></div>
</div>
<p>The text between these particular parentheses can be any text. It
may contain enclosing quotations and the characters <code class="docutils literal"><span class="pre">&lt;</span></code>,
<code class="docutils literal"><span class="pre">&gt;</span></code> and <code class="docutils literal"><span class="pre">\</span></code> can be escaped by
<code class="docutils literal"><span class="pre">\</span></code>. Notice that possible double-quote, parentheses, OCaml
comments do not necessarily have to balanced inside them.</p>
<p>As far as the lexer is concerned, a quotation is just a kind of
string.</p>
</div>
<div class="section" id="quotation-expander">
<h3>Quotation expander<a class="headerlink" href="#quotation-expander" title="Permalink to this headline">¶</a></h3>
<p>Quotations are treated at parse time. Each quotation name is
associated with a <em>quotation expander</em>, a function
transforming the content of the quotation into a syntax tree. There
are actually two expanding functions, depending on whether the
quotation is in the context of an expression or if it is in the
context of a pattern.</p>
<p>If a quotation has no associated quotation expander, a parsing
error is displayed and the compilation fails.</p>
<p>The quotation expander, or, rather, expanders, are functions taking
the quotation string as parameter and returning a syntax tree. There
is no constraint about which parsing technology is used. It can be
<a class="reference internal" href="patools.html#parsers"><span class="std std-ref">stream parsers</span></a>, <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">extensible grammars</span></a>, string
scanning, ocamllex and yacc, any.</p>
<p>To build syntax trees, Camlp5 provides a way to easily build them
see the <a class="reference internal" href="#ml-ast"><span class="std std-ref">chapter</span></a> about them: it is possible
to build abstract syntax through concrete syntax using,
precisely… quotations.</p>
</div>
<div class="section" id="defining-a-quotation">
<h3>Defining a quotation<a class="headerlink" href="#defining-a-quotation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="by-syntax-tree">
<h4>By syntax tree<a class="headerlink" href="#by-syntax-tree" title="Permalink to this headline">¶</a></h4>
<p>To define a quotation, it is necessary to program the quotation
expanders and to, finally, end the source code with a call to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Quotation</span><span class="o">.</span><span class="n">add</span> <span class="n">name</span> <span class="p">(</span><span class="n">Quotation</span><span class="o">.</span><span class="n">ExAst</span> <span class="p">(</span><span class="n">f_expr</span><span class="p">,</span> <span class="n">f_patt</span><span class="p">));</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">name</span></code> is the name of the quotation, and
<code class="docutils literal"><span class="pre">f_expr</span></code> and <code class="docutils literal"><span class="pre">f_patt</span></code> the respective quotations
expanders for expressions and patterns.</p>
<p>After compilation of the source file (without linking, i.e.
using option “-c” of the OCaml compiler), an object file is created
(ending with “.cmo”), which can be used as syntax
extension <em>kit</em> of Camlp5.</p>
</div>
<div class="section" id="by-string">
<h4>By string<a class="headerlink" href="#by-string" title="Permalink to this headline">¶</a></h4>
<p>There is another way to program the expander: a single
function which returns, not a syntax tree, but a string which is
parsed, afterwards, by the system. This function takes a boolean as
first parameter telling whether the quotation is in position of
expression (True) or in position of a pattern (False).</p>
<p>Used that way, the source file must end with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Quotation</span><span class="o">.</span><span class="n">add</span> <span class="n">name</span> <span class="p">(</span><span class="n">Quotation</span><span class="o">.</span><span class="n">ExStr</span> <span class="n">f</span><span class="p">);</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">f</span></code> is that quotation expander. The advantage of
this second approach is that it is simple to understand and use.
The drawback is that there is no way to specify different source
locations for different parts of the quotation (what may be
important in semantic error messages).</p>
</div>
<div class="section" id="default-quotation">
<h4>Default quotation<a class="headerlink" href="#default-quotation" title="Permalink to this headline">¶</a></h4>
<p>It is possible to use some quotation without its name. Use for that
the variable <code class="docutils literal"><span class="pre">Quotation.default_quotation</span></code>. For example,
ending a file by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Quotation</span><span class="o">.</span><span class="n">add</span> <span class="s2">&quot;foo&quot;</span> <span class="p">(</span><span class="n">Quotation</span><span class="o">.</span><span class="n">ExAst</span> <span class="p">(</span><span class="n">f_expr</span><span class="p">,</span> <span class="n">f_patt</span><span class="p">));</span>
<span class="n">Quotation</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">val</span> <span class="p">:</span><span class="o">=</span> <span class="s2">&quot;foo&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>allows to use the quotation “foo” without its name, i.e.:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span> <span class="o">...</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>instead of:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">foo</span><span class="o">&lt;</span> <span class="o">...</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>If several files set the variable <code class="docutils literal"><span class="pre">Quotation.default</span></code>, the
default quotation applies to the last loaded one.</p>
</div>
</div>
<div class="section" id="id33">
<h3>Antiquotations<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>A quotation obeys its own rules of lexing and parsing. Its result is
a syntax tree, of type <code class="docutils literal"><span class="pre">Pcaml.expr</span></code> if the quotation is in the
context of an expression, or <code class="docutils literal"><span class="pre">Pcaml.patt</span></code> if the quotation is
in the context of a pattern.</p>
<p>It can be interesting to insert portions of expressions or
patterns of the enclosing context in its own quotations. For that,
the syntax of the quotation must define a syntax
for <em>antiquotations areas</em>. It can be, for example:</p>
<ul class="simple">
<li>A character introducing a variable: in this case the antiquotation
can just be a variable.</li>
<li>A couple of characters enclosing the antiquotations. For example, in
the predefined &lt;a href=”ml_ast.html”&gt;syntax tree quotations&lt;/a&gt;, the
antiquotations are enclosed with dollar (<code class="docutils literal"><span class="pre">$</span></code>) signs.</li>
</ul>
<p>In quotations, the locations in the resulting syntax tree are all
set to the location of the quotation itself (if this resulting tree
contains locations, they are overwritten with this
location). Consequently, if there are semantic (typing) errors, the
OCaml compiler will underline the entire quotation.</p>
<p>But in antiquotations, since they can be inserted in the resulting
syntax tree, it is interesting to keep their initial quotations. For
that, the nodes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;:expr&lt; $anti:...$ &gt;&gt;
&lt;:patt&lt; $anti:...$ &gt;&gt;
</pre></div>
</div>
<p>equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">MLast</span><span class="o">.</span><span class="n">ExAnt</span> <span class="n">loc</span> <span class="o">...</span>
<span class="n">MLast</span><span class="o">.</span><span class="n">PaAnt</span> <span class="n">loc</span> <span class="o">...</span>
</pre></div>
</div>
<p>are provided (see <a class="reference internal" href="#ml-ast"><span class="std std-ref">syntax tree extensions</span></a>).</p>
<p>Let us take an example, without this node, and with this specific
node.</p>
<p>Let us consider an elementary quotation system whose contents is just
an antiquotation. This is just a school example, since the quotations
brackets are not necessary, in this case. But we are going to see how
the source code is underlined in errors messages.</p>
<div class="section" id="example-without-antiquotation-node">
<h4>Example without antiquotation node<a class="headerlink" href="#example-without-antiquotation-node" title="Permalink to this headline">¶</a></h4>
<p>The code for this quotation is (file “qa.ml”):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#load &quot;q_MLast.cmo&quot;;</span>
<span class="n">let</span> <span class="n">expr</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Grammar</span><span class="o">.</span><span class="n">Entry</span><span class="o">.</span><span class="n">parse</span> <span class="n">Pcaml</span><span class="o">.</span><span class="n">expr</span> <span class="p">(</span><span class="n">Stream</span><span class="o">.</span><span class="n">of_string</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span>
<span class="n">Quotation</span><span class="o">.</span><span class="n">add</span> <span class="s2">&quot;a&quot;</span> <span class="p">(</span><span class="n">Quotation</span><span class="o">.</span><span class="n">ExAst</span> <span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">fun</span> <span class="p">[]));</span>
</pre></div>
</div>
<p>The quotation expander <code class="docutils literal"><span class="pre">expr</span></code> just takes the string
parameter (the contents of the quotation), and returns the result
of the expression   parser of the OCaml language.</p>
<p>Compilation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="o">-</span><span class="n">c</span> <span class="n">qa</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>Let us test it in the toplevel with a voluntary typing error:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ocaml -I +camlp5 camlp5r.cma
        Objective Caml version ...

        Camlp5 Parsing version ...

# #load &quot;qa.cmo&quot;;
# let x = &quot;abc&quot; and y = 25 in &lt;:a&lt; x ^ y &gt;&gt;;
Characters 28-41:
  let x = &quot;abc&quot; and y = 25 in &lt;:a&lt; x ^ y &gt;&gt;;
                              ^^^^^^^^^^^^^
This expression has type int but is here used with type string
</pre></div>
</div>
<p>We observe that the full quotation is underlined, although it concerns
only the variable <code class="docutils literal"><span class="pre">y</span></code>.</p>
</div>
<div class="section" id="example-with-antiquotation-node">
<h4>Example with antiquotation node<a class="headerlink" href="#example-with-antiquotation-node" title="Permalink to this headline">¶</a></h4>
<p>Let us consider this second version (file “qb.ml”):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#load &quot;q_MLast.cmo&quot;;
let expr s =
  let ast = Grammar.Entry.parse Pcaml.expr (Stream.of_string s) in
  let loc = Ploc.make 1 0 (0, String.length s) in
  &lt;:expr&lt; $anti:ast$ &gt;&gt;
in
Quotation.add &quot;b&quot; (Quotation.ExAst (expr, fun []));
</pre></div>
</div>
<p>As above, the quotation expander <code class="docutils literal"><span class="pre">expr</span></code> takes the string
parameter (the contents of the quotation) and applies the expression
parser of the OCaml language. Its result, instead of being
returned as it is, is enclosed with the antiquotation node. (The
location built is the location of the whole string.)</p>
<p>Compilation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="o">-</span><span class="n">c</span> <span class="n">qb</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>Now the same test gives:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ocaml -I +camlp5 camlp5r.cma
        Objective Caml version ...

        Camlp5 Parsing version ...

# #load &quot;qb.cmo&quot;;
# let x = &quot;abc&quot; and y = 25 in &lt;:b&lt; x ^ y &gt;&gt;;
Characters 37-38:
  let x = &quot;abc&quot; and y = 25 in &lt;:b&lt; x ^ y &gt;&gt;;
                                       ^
This expression has type int but is here used with type string
</pre></div>
</div>
<p>Notice that, now, only the variable <code class="docutils literal"><span class="pre">y</span></code> is underlined.</p>
</div>
<div class="section" id="in-conclusion">
<h4>In conclusion<a class="headerlink" href="#in-conclusion" title="Permalink to this headline">¶</a></h4>
<p>In the resulting tree of the quotation expander:</p>
<ul class="simple">
<li>only portions of this tree, which are sons of the expr and patt
antiquotation nodes, have the right location they have in the
quotation (provided the quotation expander gives it the right
location of the antiquation in the quotation),</li>
<li>the other nodes inherit, as location, the location of the full
quotation.</li>
</ul>
</div>
</div>
<div class="section" id="locations-in-quotations-and-antiquotations">
<h3>Locations in quotations and antiquotations<a class="headerlink" href="#locations-in-quotations-and-antiquotations" title="Permalink to this headline">¶</a></h3>
<p>This section explains in details the problem of locations in
quotations and antiquotations. It is designed for programmers of
quotation expanders.</p>
<p>Locations are the difficult point in quotations and antiquotations.
If they are not set correctly, error messages may highlight wrong parts
of the source.</p>
<p>The locations are controlled:</p>
<ul class="simple">
<li>for syntax errors: by the exception <code class="docutils literal"><span class="pre">Ploc.Exc</span></code>, raised by the
function <code class="docutils literal"><span class="pre">Ploc.raise</span></code>,</li>
<li>for typing errors, by the syntax tree nodes
<code class="docutils literal"><span class="pre">&lt;:expr&lt;|nbsp|$anti:...$|nbsp|&gt;&gt;</span></code> and
<code class="docutils literal"><span class="pre">&lt;:meta&lt;|nbsp|$anti:...$|nbsp|&gt;&gt;</span></code>.</li>
</ul>
<p>If the quotation expander never uses them, all syntax and typing errors
highlight the whole quotation.</p>
<p>Remark that in <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">extensible grammars</span></a>,
syntax errors are automatically enclosed by the exception
<code class="docutils literal"><span class="pre">Ploc.Exc</span></code>. Therefore, if the quotation is parsed by an
extensible grammar entry, this exception can be raised.</p>
<p>In the syntax tree nodes
<code class="docutils literal"><span class="pre">&lt;:expr&lt;|nbsp|$anti:...$|nbsp|&gt;&gt;</span></code> and
<code class="docutils literal"><span class="pre">&lt;:meta&lt;|nbsp|$anti:...$|nbsp|&gt;&gt;</span></code>, the location is
indicated by the implicit variable named <code class="docutils literal"><span class="pre">loc</span></code>. Their usage
is therefore something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>let loc = ...computation of the location... in
&lt;:expr&lt; $anti:...$ &gt;&gt;
</pre></div>
</div>
<div class="section" id="in-the-quotation">
<h4>In the quotation<a class="headerlink" href="#in-the-quotation" title="Permalink to this headline">¶</a></h4>
<p>All locations must be computed <em>relatively to the quotation
string</em>. The quotation string is the string between
<code class="docutils literal"><span class="pre">&lt;&lt;</span></code> or <code class="docutils literal"><span class="pre">&lt;:name&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;&gt;</span></code>
(excluded), the first character of this string being at location
zero.</p>
<p>The quotation system automatically shifts all locations with the
location of the quotation: the programmer of the quotation expander
does not therefore need to care about where the quotation appears
in the source.</p>
</div>
<div class="section" id="in-antiquotations">
<h4>In antiquotations<a class="headerlink" href="#in-antiquotations" title="Permalink to this headline">¶</a></h4>
<p>In antiquotations, it is important to control how the antiquotation
string is parsed. For example, if the function parsing the antiquotation
string raises <code class="docutils literal"><span class="pre">Ploc.Exc</span></code>, the location of this exception must
be shifted with the location of the antiquotation in the quotation.</p>
<p>For example, let us suppose that the source contains:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span> <span class="n">abc</span><span class="o">^</span><span class="n">ijk</span><span class="o">^</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>where the antiquotation is specified between the caret (<code class="docutils literal"><span class="pre">^</span></code>)
characters. The antiquotation string is <code class="docutils literal"><span class="pre">ijk</span></code>. It can be built
in the quotation expander by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="p">:</span><span class="n">expr</span><span class="o">&lt;</span> <span class="n">ijk</span> <span class="o">&gt;&gt;</span>
</pre></div>
</div>
<p>If used just like this, without the <code class="docutils literal"><span class="pre">&lt;:expr&lt;</span> <span class="pre">$anti:x$</span> <span class="pre">&gt;&gt;</span></code>,
in case of typing error (for example if the variable <code class="docutils literal"><span class="pre">ijk</span></code> is
unbound), the OCaml error message will be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span> <span class="n">abc</span><span class="o">^</span><span class="n">ijk</span><span class="o">^</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
<span class="o">^^^^^^^^^^^^^^^^^^^</span>
<span class="n">Unbound</span> <span class="n">value</span> <span class="n">ijk</span>
</pre></div>
</div>
<p>To put a location to <code class="docutils literal"><span class="pre">ijk</span></code>, since its location in the quotation
is <code class="docutils literal"><span class="pre">(5,</span> <span class="pre">8)</span></code> (the <code class="docutils literal"><span class="pre">i</span></code> being the 5th characater of the
quotation string, starting at zero), the quotation expander can build
it like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>let e = &lt;:expr&lt; ijk &gt;&gt; in
let loc = Ploc.make_unlined (5, 8) in
&lt;:expr&lt; $anti:e$ &gt;&gt;
</pre></div>
</div>
<p>In this case, the possible typing error message will be:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;&lt;</span> <span class="n">abc</span><span class="o">^</span><span class="n">ijk</span><span class="o">^</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
       <span class="o">^^^</span>
<span class="n">Unbound</span> <span class="n">value</span> <span class="n">ijk</span>
</pre></div>
</div>
<p>This case is simple, since the antiquotation is just an identifier,
and there is no parser computing it.</p>
<p>If the antiquotation has to be parsed, for example if it is a
complicated expression, there are two points to care about:</p>
<p>First, the syntax error messages. If the parser of the
antiquotation raises <code class="docutils literal"><span class="pre">Ploc.Exc</span></code>, its location is relative
to the antiquotation.  It must therefore be shifted to correspond to
a location in the quotation.  If <code class="docutils literal"><span class="pre">f</span></code> is the parsing
function and <code class="docutils literal"><span class="pre">sh</span></code> the shift of the <em>antiquotation</em>
in the <em>quotation</em> (whose value is <code class="docutils literal"><span class="pre">5</span></code> in the
example), the code must be something like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">try</span> <span class="n">f</span> <span class="p">()</span> <span class="k">with</span>
<span class="p">[</span> <span class="n">Ploc</span><span class="o">.</span><span class="n">Exc</span> <span class="n">loc</span> <span class="n">exc</span> <span class="o">-&gt;</span> <span class="n">Ploc</span><span class="o">.</span><span class="k">raise</span> <span class="p">(</span><span class="n">Ploc</span><span class="o">.</span><span class="n">shift</span> <span class="n">sh</span> <span class="n">loc</span><span class="p">)</span> <span class="n">exc</span> <span class="p">]</span>
</pre></div>
</div>
<p>Second, the typing error messages. Here, the above code with
<code class="docutils literal"><span class="pre">&lt;:expr&lt;|nbsp|$anti:e$|nbsp|&gt;&gt;</span></code> can apply to the
resulting tree.</p>
<p>The complete code, taking the possible syntax error messages and
the possible typing error messages into account, can be (where
<code class="docutils literal"><span class="pre">len</span></code> is the antiquotation length):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>let e =
  try f () with
  [ Ploc.Exc loc exc -&gt; Ploc.raise (Ploc.shift sh loc) exc ]
in
let loc = Ploc.make_unlined (sh, sh + len) in
&lt;:expr&lt; $anti:e$ &gt;&gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="located-errors">
<h3>Located errors<a class="headerlink" href="#located-errors" title="Permalink to this headline">¶</a></h3>
<p>If the quotation expander raises an exception, by default, the
whole quotation is underlined:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat foo.ml
#load &quot;q_MLast.cmo&quot;;
let expr s = raise (Failure &quot;hello&quot;) in
Quotation.add &quot;a&quot; (Quotation.ExAst (expr, fun []));

$ ocaml -I +camlp5 camlp5r.cma
        Objective Caml version ...

        Camlp5 Parsing version ...

# #use &quot;foo.ml&quot;;
- : unit = ()
# &lt;:a&lt; good morning &gt;&gt;;
Toplevel input:
# &lt;:a&lt; good morning &gt;&gt;;
  ^^^^^^^^^^^^^^^^^^^^
While expanding quotation &quot;a&quot;:
Failure: hello
</pre></div>
</div>
<p>To specify a location of the exception, use the function
<code class="docutils literal"><span class="pre">Ploc.raise</span></code> instead of <code class="docutils literal"><span class="pre">raise</span></code>. In this
example, let us suppose that we want only the characters
5 to 7 are underlined. This can be done like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ cat foo.ml
#load &quot;q_MLast.cmo&quot;;
let expr s = Ploc.raise (Ploc.make 1 0 (5, 7)) (Failure &quot;hello&quot;) in
Quotation.add &quot;a&quot; (Quotation.ExAst (expr, fun []));

$ ledit ocaml -I +camlp5 camlp5r.cma
        Objective Caml version ...

        Camlp5 Parsing version ...

# #use &quot;foo.ml&quot;;
- : unit = ()
# &lt;:a&lt; good morning &gt;&gt;;
Toplevel input:
# &lt;:a&lt; good morning &gt;&gt;;
           ^^
While expanding quotation &quot;a&quot;:
Failure: hello
</pre></div>
</div>
</div>
<div class="section" id="the-quotation-module">
<h3>The Quotation module<a class="headerlink" href="#the-quotation-module" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">expander</span> <span class="o">=</span>
  <span class="p">[</span> <span class="n">ExStr</span> <span class="n">of</span> <span class="nb">bool</span> <span class="o">-&gt;</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">string</span>
  <span class="o">|</span> <span class="n">ExAst</span> <span class="n">of</span> <span class="p">(</span><span class="n">string</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">expr</span> <span class="o">*</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">MLast</span><span class="o">.</span><span class="n">patt</span><span class="p">)</span> <span class="p">]</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Is the type for quotation expander kinds:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Quotation.ExStr</span> <span class="pre">exp</span></code> corresponds to an expander <code class="docutils literal"><span class="pre">exp</span></code> returning
a string which is parsed by the system to create a syntax tree. Its
boolean parameter tells whether the quotation is in position of an
expression (True) or in position of a pattern (False). Quotations
expanders created this way may work for some particular OCaml
syntax, and not for another one (e.g. may work when used with
revised syntax and not when used with normal syntax, and
conversely).</li>
<li><code class="docutils literal"><span class="pre">Quotation.ExAst</span> <span class="pre">(expr_exp,</span> <span class="pre">patt_exp)</span></code> corresponds to expanders
returning syntax trees, therefore not necessitating to be parsed
afterwards.  The function <code class="docutils literal"><span class="pre">expr_exp</span></code> is called when the quotation
is in position of an expression, and <code class="docutils literal"><span class="pre">patt_exp</span></code> when the quotation
is in position of a pattern. Quotation expanders created this way
are independent from the enclosing syntax.</li>
<li><code class="docutils literal"><span class="pre">Quotation.add</span> <span class="pre">name</span> <span class="pre">exp</span></code> adds the quotation <code class="docutils literal"><span class="pre">name</span></code> associated
with the expander <code class="docutils literal"><span class="pre">exp</span></code>.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">add</span> <span class="p">:</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">expander</span> <span class="o">-&gt;</span> <span class="n">unit</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">Quotation.find</span> <span class="pre">name</span></code> returns the quotation expander of the given
name.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">find</span> <span class="p">:</span> <span class="n">string</span> <span class="o">-&gt;</span> <span class="n">expander</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>The name of the default quotation : it is possible to use this
quotation between <code class="docutils literal"><span class="pre">&lt;&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;&gt;</span></code> without having to specify its
name.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">default</span> <span class="p">:</span> <span class="n">ref</span> <span class="n">string</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li>Function translating quotation names; default = identity. Used in
the predefined quotation <code class="docutils literal"><span class="pre">q_phony.cmo</span></code>. See below.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">translate</span> <span class="p">:</span> <span class="n">ref</span> <span class="p">(</span><span class="n">string</span> <span class="o">-&gt;</span> <span class="n">string</span><span class="p">);</span>
</pre></div>
</div>
<p>Some other useful functions for quotations are defined in the
module <code class="docutils literal"><span class="pre">Pcaml</span></code>. See the chapter “<a class="reference internal" href="#pcaml"><span class="std std-ref">The Pcaml module</span></a>”, section “Quotation management”.</p>
</div>
<div class="section" id="predefined-quotations">
<h3>Predefined quotations<a class="headerlink" href="#predefined-quotations" title="Permalink to this headline">¶</a></h3>
<div class="section" id="q-mlast-cmo">
<h4>q_MLast.cmo<a class="headerlink" href="#q-mlast-cmo" title="Permalink to this headline">¶</a></h4>
<p>This extension kit add quotations of OCaml syntax tree, allowing to
use concrete syntax to represent abstract syntax. See the chapter
<a class="reference internal" href="#ml-ast"><span class="std std-ref">Syntax tree</span></a>.</p>
</div>
<div class="section" id="q-ast-cmo">
<h4>q_ast.cmo<a class="headerlink" href="#q-ast-cmo" title="Permalink to this headline">¶</a></h4>
<p>As with the previous quotation, this extension kit add quotations of
OCaml syntax tree, but in the current user syntax with all
extensions, the previous one being restricted to revised syntax
without extension. See the chapters <a class="reference internal" href="#ml-ast"><span class="std std-ref">Syntax tree</span></a>
and <a class="reference internal" href="#q-ast"><span class="std std-ref">Syntax tree quotations in user syntax</span></a>.</p>
</div>
<div class="section" id="q-phony-cmo">
<h4>q_phony.cmo<a class="headerlink" href="#q-phony-cmo" title="Permalink to this headline">¶</a></h4>
<p>This extension kit is designed for pretty printing and must be loaded
after a language pretty printing kit (in normal or in revised syntax).
It prevents the expansions of quotations, transforming them
into variables. The pretty printing then keeps the initial (source) form.</p>
<p>The <a class="reference internal" href="#macros"><span class="std std-ref">macros</span></a> (extension
<code class="docutils literal"><span class="pre">pa_macro.cmo</span></code>) are also displayed in their initial form,
instead of expanded.</p>
</div>
</div>
<div class="section" id="a-full-example-lambda-terms">
<h3>A full example: lambda terms<a class="headerlink" href="#a-full-example-lambda-terms" title="Permalink to this headline">¶</a></h3>
<p>This example allows to represent lambda terms by a concrete syntax
and to be able to combine them using antiquotations.</p>
<p>A lambda term is defined like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">term</span> <span class="o">=</span>
  <span class="p">[</span> <span class="n">Lam</span> <span class="n">of</span> <span class="n">string</span> <span class="ow">and</span> <span class="n">term</span>
  <span class="o">|</span> <span class="n">App</span> <span class="n">of</span> <span class="n">term</span> <span class="ow">and</span> <span class="n">term</span>
  <span class="o">|</span> <span class="n">Var</span> <span class="n">of</span> <span class="n">string</span> <span class="p">]</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">fst</span> <span class="o">=</span> <span class="n">Lam</span> <span class="s2">&quot;x&quot;</span> <span class="p">(</span><span class="n">Lam</span> <span class="s2">&quot;y&quot;</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;x&quot;</span><span class="p">));</span>
<span class="n">value</span> <span class="n">snd</span> <span class="o">=</span> <span class="n">Lam</span> <span class="s2">&quot;x&quot;</span> <span class="p">(</span><span class="n">Lam</span> <span class="s2">&quot;y&quot;</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;y&quot;</span><span class="p">));</span>
<span class="n">value</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">Lam</span> <span class="s2">&quot;x&quot;</span> <span class="p">(</span><span class="n">App</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;x&quot;</span><span class="p">));</span>
<span class="n">value</span> <span class="n">omega</span> <span class="o">=</span> <span class="n">App</span> <span class="n">delta</span> <span class="n">delta</span><span class="p">;</span>
<span class="n">value</span> <span class="n">comb_s</span> <span class="o">=</span>
  <span class="n">Lam</span> <span class="s2">&quot;x&quot;</span>
    <span class="p">(</span><span class="n">Lamb</span> <span class="s2">&quot;y&quot;</span>
       <span class="p">(</span><span class="n">Lamb</span> <span class="s2">&quot;z&quot;</span>
          <span class="p">(</span><span class="n">App</span> <span class="p">(</span><span class="n">App</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;y&quot;</span><span class="p">))</span> <span class="p">(</span><span class="n">App</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;x&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">Var</span> <span class="s2">&quot;z&quot;</span><span class="p">)))));</span>
</pre></div>
</div>
<p>Since combinations of lambda term may be complicated, The idea is to
represent them by quotations in concrete syntax. We want to be able to
write the examples above like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">value</span> <span class="n">fst</span> <span class="o">=</span> <span class="o">&lt;&lt;</span> \<span class="n">x</span><span class="o">.</span>\<span class="n">y</span><span class="o">.</span><span class="n">x</span> <span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="n">value</span> <span class="n">snd</span> <span class="o">=</span> <span class="o">&lt;&lt;</span> \<span class="n">x</span><span class="o">.</span>\<span class="n">y</span><span class="o">.</span><span class="n">y</span> <span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="n">value</span> <span class="n">delta</span> <span class="o">=</span> <span class="o">&lt;&lt;</span> \<span class="n">x</span><span class="o">.</span><span class="n">x</span> <span class="n">x</span> <span class="o">&gt;&gt;</span>
<span class="n">value</span> <span class="n">omega</span> <span class="o">=</span> <span class="o">&lt;&lt;</span> <span class="o">^</span><span class="n">delta</span> <span class="o">^</span><span class="n">delta</span> <span class="o">&gt;&gt;</span><span class="p">;</span>
<span class="n">value</span> <span class="n">comb_s</span> <span class="o">=</span> <span class="o">&lt;&lt;</span> \<span class="n">x</span><span class="o">.</span>\<span class="n">y</span><span class="o">.</span>\<span class="n">z</span><span class="o">.</span><span class="p">(</span><span class="n">x</span> <span class="n">y</span><span class="p">)(</span><span class="n">x</span> <span class="n">z</span><span class="p">)</span> <span class="o">&gt;&gt;</span><span class="p">;</span>
</pre></div>
</div>
<p>which is a classic representation of lambda terms.</p>
<p>Notice, in the definition of <code class="docutils literal"><span class="pre">omega</span></code>, the use of the
caret (<code class="docutils literal"><span class="pre">^</span></code>) sign to specify antiquotations. Notice also the
simplicity of the representation of the expression defining
<code class="docutils literal"><span class="pre">comb_s</span></code>.</p>
<p>Here is the code of the quotation expander, term.ml. The expander
uses the <a class="reference internal" href="patools.html#grammars"><span class="std std-ref">extensible grammars</span></a>. It has its
own lexer (using the <a class="reference internal" href="patools.html#lexers"><span class="std std-ref">stream lexers</span></a>)
because the lexer of OCaml programs (<code class="docutils literal"><span class="pre">Plexer.gmake</span> <span class="pre">()</span></code>),
cannot recognize the backslashes alone.</p>
<div class="section" id="lexer">
<h4>Lexer<a class="headerlink" href="#lexer" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>(* lexer *)

#load &quot;pa_lexer.cmo&quot;;

value rec ident =
  lexer
  [ [ &#39;a&#39;-&#39;z&#39; | &#39;A&#39;-&#39;Z&#39; | &#39;0&#39;-&#39;9&#39; | &#39;-&#39; | &#39;_&#39; | &#39;\128&#39;-&#39;\255&#39; ]
    ident!
  | ]
;

value empty _ = parser [: _ = Stream.empty :] -&gt; [];

value rec next_tok =
  lexer
  [ &quot;\\&quot; -&gt; (&quot;BSLASH&quot;, &quot;&quot;)
  | &quot;^&quot; -&gt; (&quot;CARET&quot;, &quot;&quot;)
  | &#39;a&#39;-&#39;z&#39; ident! -&gt; (&quot;IDENT&quot;, $buf)
  | &quot;(&quot; -&gt; (&quot;&quot;, &quot;(&quot;)
  | &quot;)&quot; -&gt; (&quot;&quot;, &quot;)&quot;)
  | &quot;.&quot; -&gt; (&quot;&quot;, &quot;.&quot;)
  | empty -&gt; (&quot;EOS&quot;, &quot;&quot;)
  | -&gt; raise (Stream.Error &quot;lexing error: bad character&quot;) ]
;

value rec skip_spaces =
  lexer
  [ &quot; &quot;/ skip_spaces!
  | &quot;\n&quot;/ skip_spaces!
  | &quot;\r&quot;/ skip_spaces! | ]
;

value record_loc loct i (bp, ep) = do {
  if i &gt;= Array.length loct.val then do {
    let newt =
      Array.init (2 * Array.length loct.val + 1)
        (fun i -&gt;
           if i &lt; Array.length loct.val then loct.val.(i)
           else Ploc.dummy)
    in
    loct.val := newt;
  }
  else ();
  loct.val.(i) := Ploc.make_unlined (bp, ep)
};

value lex_func cs =
  let loct = ref [| |] in
  let ts =
    Stream.from
      (fun i -&gt; do {
         ignore (skip_spaces $empty cs : Plexing.Lexbuf.t);
         let bp = Stream.count cs in
         let r = next_tok $empty cs in
         let ep = Stream.count cs in
         record_loc loct i (bp, ep);
         Some r
       })
  in
  let locf i =
    if i &lt; Array.length loct.val then loct.val.(i) else Ploc.dummy
  in
  (ts, locf)
;

value lam_lex =
  {Plexing.tok_func = lex_func;
   Plexing.tok_using _ = (); Plexing.tok_removing _ = ();
   Plexing.tok_match = Plexing.default_match;
   Plexing.tok_text = Plexing.lexer_text;
   Plexing.tok_comm = None}
;
</pre></div>
</div>
</div>
<div class="section" id="parser">
<h4>Parser<a class="headerlink" href="#parser" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default"><div class="highlight"><pre><span></span>(* parser *)

#load &quot;pa_extend.cmo&quot;;
#load &quot;q_MLast.cmo&quot;;

value g = Grammar.gcreate lam_lex;
value expr_term_eos = Grammar.Entry.create g &quot;term&quot;;
value patt_term_eos = Grammar.Entry.create g &quot;term&quot;;

EXTEND
  GLOBAL: expr_term_eos patt_term_eos;
  expr_term_eos:
    [ [ x = expr_term; EOS -&gt; x ] ]
  ;
  expr_term:
    [ [ BSLASH; i = IDENT; &quot;.&quot;; t = SELF -&gt; &lt;:expr&lt; Lam $str:i$ $t$ &gt;&gt; ]
    | [ x = SELF; y = SELF -&gt; &lt;:expr&lt; App $x$ $y$ &gt;&gt; ]
    | [ i = IDENT -&gt; &lt;:expr&lt; Var $str:i$ &gt;&gt;
      | CARET; r = expr_antiquot -&gt; r
      | &quot;(&quot;; t = SELF; &quot;)&quot; -&gt; t ] ]
  ;
  expr_antiquot:
    [ [ i = IDENT -&gt;
         let r =
           let loc = Ploc.make_unlined (0, String.length i) in
           &lt;:expr&lt; $lid:i$ &gt;&gt;
         in
         &lt;:expr&lt; $anti:r$ &gt;&gt; ] ]
  ;
  patt_term_eos:
    [ [ x = patt_term; EOS -&gt; x ] ]
  ;
  patt_term:
    [ [ BSLASH; i = IDENT; &quot;.&quot;; t = SELF -&gt; &lt;:patt&lt; Lam $str:i$ $t$ &gt;&gt; ]
    | [ x = SELF; y = SELF -&gt; &lt;:patt&lt; App $x$ $y$ &gt;&gt; ]
    | [ i = IDENT -&gt; &lt;:patt&lt; Var $str:i$ &gt;&gt;
      | CARET; r = patt_antiquot -&gt; r
      | &quot;(&quot;; t = SELF; &quot;)&quot; -&gt; t ] ]
  ;
  patt_antiquot:
    [ [ i = IDENT -&gt;
         let r =
           let loc = Ploc.make_unlined (0, String.length i) in
           &lt;:patt&lt; $lid:i$ &gt;&gt;
         in
         &lt;:patt&lt; $anti:r$ &gt;&gt; ] ]
  ;
END;

value expand_expr s =
  Grammar.Entry.parse expr_term_eos (Stream.of_string s)
;
value expand_patt s =
  Grammar.Entry.parse patt_term_eos (Stream.of_string s)
;

Quotation.add &quot;term&quot; (Quotation.ExAst (expand_expr, expand_patt));
Quotation.default.val := &quot;term&quot;;
</pre></div>
</div>
</div>
<div class="section" id="compilation-and-test">
<h4>Compilation and test<a class="headerlink" href="#compilation-and-test" title="Permalink to this headline">¶</a></h4>
<p>Compilation:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="n">camlp5r</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="o">-</span><span class="n">c</span> <span class="n">term</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>Example, in the toplevel, including a semantic error, correctly
underlined, thanks to the antiquotation nodes:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ocaml -I +camlp5 camlp5r.cma
        Objective Caml version ...

        Camlp5 Parsing version ...

# #load &quot;term.cmo&quot;;
# type term =
   [ Lam of string and term
   | App of term and term
   |   Var of string ]
  ;
type term =
  [ Lam of string and term | App of term and term | Var of string ]
# value comb_s = &lt;&lt; \x.\y.\z.(x y)(x z) &gt;&gt;;
value comb_s : term =
  Lam &quot;x&quot;
   (Lam &quot;y&quot;
     (Lam &quot;z&quot; (App (App (Var &quot;x&quot;) (Var &quot;y&quot;)) (App (Var &quot;x&quot;) (Var &quot;z&quot;)))))
# value omega = &lt;&lt; ^delta ^delta &gt;&gt;;
Characters 18-23:
  value omega = &lt;&lt; ^delta ^delta &gt;&gt;;
                    ^^^^^
Unbound value delta
# value delta = &lt;&lt; \x.x x &gt;&gt;;
value delta : term = Lam &quot;x&quot; (App (Var &quot;x&quot;) (Var &quot;x&quot;))
# value omega = &lt;&lt; ^delta ^delta &gt;&gt;;
value omega : term =
  App (Lam &quot;x&quot; (App (Var &quot;x&quot;) (Var &quot;x&quot;)))
    (Lam &quot;x&quot; (App (Var &quot;x&quot;) (Var &quot;x&quot;)))
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="the-revised-syntax">
<span id="revsynt"></span><h2>The revised syntax<a class="headerlink" href="#the-revised-syntax" title="Permalink to this headline">¶</a></h2>
<p>The revised syntax is an alternative syntax of OCaml. It is close
to the normal syntax. We present here only the differences between
the two syntaxes.</p>
<p>Notice that there is a simple way to know how the normal syntax is
written in revised syntax: write the code in a file “foo.ml” in
normal syntax and type, in a shell:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">camlp5o</span> <span class="n">pr_r</span><span class="o">.</span><span class="n">cmo</span> <span class="n">pr_rp</span><span class="o">.</span><span class="n">cmo</span> <span class="n">foo</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>And, conversely, how a file “bar.ml” written in revised syntax is
displayed in normal syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">camlp5r</span> <span class="n">pr_o</span><span class="o">.</span><span class="n">cmo</span> <span class="n">pr_op</span><span class="o">.</span><span class="n">cmo</span> <span class="n">bar</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>Even simpler, without creating a file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">camlp5o</span> <span class="n">pr_r</span><span class="o">.</span><span class="n">cmo</span> <span class="n">pr_op</span><span class="o">.</span><span class="n">cmo</span> <span class="o">-</span><span class="n">impl</span> <span class="o">-</span>
<span class="o">...</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">normal</span> <span class="n">syntax</span> <span class="o">...</span>
<span class="o">...</span> <span class="nb">type</span> <span class="n">control</span><span class="o">-</span><span class="n">D</span> <span class="o">...</span>
<span class="n">camlp5r</span> <span class="n">pr_o</span><span class="o">.</span><span class="n">cmo</span> <span class="n">pr_rp</span><span class="o">.</span><span class="n">cmo</span> <span class="o">-</span><span class="n">impl</span> <span class="o">-</span>
<span class="o">...</span> <span class="nb">type</span> <span class="ow">in</span> <span class="n">revised</span> <span class="n">syntax</span> <span class="o">...</span>
<span class="o">...</span> <span class="nb">type</span> <span class="n">control</span><span class="o">-</span><span class="n">D</span> <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="lexing">
<h3>Lexing<a class="headerlink" href="#lexing" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The character quote (<code class="docutils literal"><span class="pre">'</span></code>) can be written without backslash:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">'\''</span></code></td>
<td><code class="docutils literal"><span class="pre">'''</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="modules-structure-and-signature-items">
<h3>Modules, Structure and Signature items<a class="headerlink" href="#modules-structure-and-signature-items" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Structure and signature items always end with a single semicolon
which is required.</li>
<li>In structures, the declaration of a value is introduced by the
keyword “value”, instead of “let”:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42;;</span></code>
<code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42</span> <span class="pre">in</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">7;;</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42;</span></code>
<code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42</span> <span class="pre">in</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">7;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>In signatures, the declaration of a value is also introduced by the
keyword “value”, instead of “val”:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">val</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">int;;</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">int;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>In signatures, abstract module types are represented by a quote and
an (any) identifier:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">module</span> <span class="pre">type</span> <span class="pre">MT;;</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">type</span> <span class="pre">MT</span> <span class="pre">=</span> <span class="pre">'a;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Functor application uses currying. Parentheses are not required for
the parameters:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">Set.Make(M).t;;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">(Set.Make</span> <span class="pre">M).t;</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">module</span> <span class="pre">M</span> <span class="pre">=</span> <span class="pre">Mod.Make</span> <span class="pre">(M1)</span> <span class="pre">(M2);;</span></code></td>
<td><code class="docutils literal"><span class="pre">module</span> <span class="pre">M</span> <span class="pre">=</span> <span class="pre">Mod.Make</span> <span class="pre">M1</span> <span class="pre">M2;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>It is possible to group several declarations together either in an
interface or in an implementation by enclosing them between
“declare” and “end” (this is useful when using syntax extensions to
generate several declarations from one). Example in an interface:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">declare</span>
  <span class="nb">type</span> <span class="n">foo</span> <span class="o">=</span> <span class="p">[</span> <span class="n">Foo</span> <span class="n">of</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Bar</span> <span class="p">];</span>
  <span class="n">value</span> <span class="n">f</span> <span class="p">:</span> <span class="n">foo</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">;</span>
<span class="n">end</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="expressions-and-patterns">
<h3>Expressions and Patterns<a class="headerlink" href="#expressions-and-patterns" title="Permalink to this headline">¶</a></h3>
<div class="section" id="imperative-constructions">
<h4>Imperative constructions<a class="headerlink" href="#imperative-constructions" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The sequence is introduced by the keyword “do” followed by “{” and
terminated by “}”; it is possible to put a semicolon after the last
expression:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">e1;</span> <span class="pre">e2;</span> <span class="pre">e3;</span> <span class="pre">e4</span></code></td>
<td><code class="docutils literal"><span class="pre">do</span> <span class="pre">{</span> <span class="pre">e1;</span> <span class="pre">e2;</span> <span class="pre">e3;</span> <span class="pre">e4</span> <span class="pre">}</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The “do” after the “while” loop and the “for” loop are followed by a
“{” and the loop end with “}”; it is possible to put a semicolon
after the last expression:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">while</span> <span class="pre">e1</span> <span class="pre">do</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">e2;</span> <span class="pre">e3;</span> <span class="pre">e4</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">done</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">while</span> <span class="pre">e1</span> <span class="pre">do</span> <span class="pre">{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">e2;</span> <span class="pre">e3;</span> <span class="pre">e4</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">}</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">e1</span> <span class="pre">to</span> <span class="pre">e2</span> <span class="pre">do</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">e3</span> <span class="pre">;</span> <span class="pre">e4</span> <span class="pre">;</span> <span class="pre">e5</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">done</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">=</span> <span class="pre">e1</span> <span class="pre">to</span> <span class="pre">e2</span> <span class="pre">do</span> <span class="pre">{</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">e3</span> <span class="pre">;</span> <span class="pre">e4</span> <span class="pre">;</span> <span class="pre">e5</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">}</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tuples-and-lists">
<h4>Tuples and Lists<a class="headerlink" href="#tuples-and-lists" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Parentheses are required in tuples:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">1,</span> <span class="pre">&quot;hello&quot;,</span> <span class="pre">World</span></code></td>
<td><code class="docutils literal"><span class="pre">(1,</span> <span class="pre">&quot;hello&quot;,</span> <span class="pre">World)</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Lists are always enclosed with brackets. A list is a left bracket,
followed by a list of elements separated with semicolons, optionally
followed by colon-colon and an element, and ended by a right
bracket. Warning: the colon-colon is not an infix but is just part
of the syntactic construction.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">::</span> <span class="pre">y</span></code></td>
<td><code class="docutils literal"><span class="pre">[x</span> <span class="pre">::</span> <span class="pre">y]</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">[x;</span> <span class="pre">y;</span> <span class="pre">z]</span></code></td>
<td><code class="docutils literal"><span class="pre">[x;</span> <span class="pre">y;</span> <span class="pre">z]</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">::</span> <span class="pre">y</span> <span class="pre">::</span> <span class="pre">z</span> <span class="pre">::</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">[x;</span> <span class="pre">y;</span> <span class="pre">z</span> <span class="pre">::</span> <span class="pre">t]</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="records">
<h4>Records<a class="headerlink" href="#records" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>In record update, parentheses are required around the initial
expression:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{e</span> <span class="pre">with</span> <span class="pre">field</span> <span class="pre">=</span> <span class="pre">a}</span></code></td>
<td><code class="docutils literal"><span class="pre">{(e)</span> <span class="pre">with</span> <span class="pre">field</span> <span class="pre">=</span> <span class="pre">a}</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>It is allowable to use function binding syntax in record field
definitions:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="59%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{field</span> <span class="pre">=</span> <span class="pre">fun</span> <span class="pre">a</span> <span class="pre">-&gt;</span> <span class="pre">e}</span></code></td>
<td><code class="docutils literal"><span class="pre">{field</span> <span class="pre">a</span> <span class="pre">=</span> <span class="pre">e}</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="irrefutable-patterns">
<h4>Irrefutable patterns<a class="headerlink" href="#irrefutable-patterns" title="Permalink to this headline">¶</a></h4>
<p>An <em>irrefutable pattern</em> is a pattern which is
syntactically visible and never fails. They are used in some
syntactic constructions. It is either:</p>
<ul class="simple">
<li>A variable,</li>
<li>The wildcard “_”,</li>
<li>The constructor “()”,</li>
<li>A tuple with irrefutable patterns,</li>
<li>A record with irrefutable patterns,</li>
<li>A type constraint with an irrefutable pattern.</li>
</ul>
<p>Notice that this definition is only syntactic: a constructor
belonging to a type having only one constructor is not considered as
an irrefutable pattern (except “()”).</p>
</div>
<div class="section" id="constructions-with-matching">
<h4>Constructions with matching<a class="headerlink" href="#constructions-with-matching" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The keyword “function” no longer exists. Only “fun” is used.</li>
<li>The pattern matching, in constructions with “fun”, “match” and “try”
is closed with brackets: an open bracket “[” before the first case,
and a close bracket “]” after the last case:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">match</span> <span class="pre">e</span> <span class="pre">with</span></code>
<code class="docutils literal"><span class="pre">p1</span> <span class="pre">-&gt;</span> <span class="pre">e1</span></code>
<code class="docutils literal"><span class="pre">|</span> <span class="pre">p2</span> <span class="pre">-&gt;</span> <span class="pre">e2</span></code></td>
<td><code class="docutils literal"><span class="pre">match</span> <span class="pre">e</span> <span class="pre">with</span></code>
<code class="docutils literal"><span class="pre">[</span> <span class="pre">p1</span> <span class="pre">-&gt;</span> <span class="pre">e1</span></code>
<code class="docutils literal"><span class="pre">|</span> <span class="pre">p2</span> <span class="pre">-&gt;</span> <span class="pre">e2</span> <span class="pre">]</span></code></td>
</tr>
</tbody>
</table>
<blockquote>
<div>If there is only one case and if the pattern is irrefutable, the
brackets are not required. These examples work identically in OCaml
and in revised syntax:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x</span></code></td>
<td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">x</span> <span class="pre">-&gt;</span> <span class="pre">x</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">{foo=(y,</span> <span class="pre">_)}</span> <span class="pre">-&gt;</span> <span class="pre">y</span></code></td>
<td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">{foo=(y,</span> <span class="pre">_)}</span> <span class="pre">-&gt;</span> <span class="pre">y</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>It is possible to write the empty function which always raises the
exception “Match_failure” when a parameter is applied.  It is also
possible to write and empty “match”, raising “Match_failure” after
having evaluated its expression and the empty “try”, equivalent to
its expression without try:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">fun</span> <span class="p">[]</span>
<span class="n">match</span> <span class="n">e</span> <span class="k">with</span> <span class="p">[]</span>
<span class="k">try</span> <span class="n">e</span> <span class="k">with</span> <span class="p">[]</span>
</pre></div>
</div>
<ul class="simple">
<li>The patterns after “let” and “value” must be irrefutable. The
following OCaml expression:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">f</span> <span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">must</span> <span class="n">be</span> <span class="n">written</span><span class="p">:</span>
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fun</span> <span class="p">[</span> <span class="p">[</span><span class="n">x</span><span class="p">::</span><span class="n">y</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="o">...</span>
</pre></div>
</div>
<ul class="simple">
<li>It is possible to use a construction “where”, equivalent to “let”,
but usable only when where is only one binding. The expression:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e1</span> <span class="n">where</span> <span class="n">p</span> <span class="o">=</span> <span class="n">e</span>
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">let</span> <span class="n">p</span> <span class="o">=</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">e1</span>
</pre></div>
</div>
</div>
<div class="section" id="mutables-and-assignment">
<h4>Mutables and Assignment<a class="headerlink" href="#mutables-and-assignment" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The statement <code class="docutils literal"><span class="pre">&lt;-</span></code> is written <code class="docutils literal"><span class="pre">:=</span></code>:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x.f</span> <span class="pre">&lt;-</span> <span class="pre">y</span></code></td>
<td><code class="docutils literal"><span class="pre">x.f</span> <span class="pre">:=</span> <span class="pre">y</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The “ref” type is declared as a record type with one field named
“val”, instead of “contents”. The operator “!” does not exist any
more, and references are assigned like the other mutables:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">!x</span> <span class="pre">+</span> <span class="pre">y</span></code></td>
<td><code class="docutils literal"><span class="pre">x.val</span> <span class="pre">:=</span> <span class="pre">x.val</span> <span class="pre">+</span> <span class="pre">y</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id34">
<h4>Miscellaneous<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">else</span></code> is required in the <code class="docutils literal"><span class="pre">if</span></code> statement:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">if</span> <span class="pre">a</span> <span class="pre">then</span> <span class="pre">b</span></code></td>
<td><code class="docutils literal"><span class="pre">if</span> <span class="pre">a</span> <span class="pre">then</span> <span class="pre">b</span> <span class="pre">else</span> <span class="pre">()</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The boolean operations <code class="docutils literal"><span class="pre">or</span></code> and <code class="docutils literal"><span class="pre">and</span></code> can only    be written with <code class="docutils literal"><span class="pre">||</span></code> and <code class="docutils literal"><span class="pre">&amp;&amp;</span></code>:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">a</span> <span class="pre">or</span> <span class="pre">b</span> <span class="pre">&amp;</span> <span class="pre">c</span></code></td>
<td><code class="docutils literal"><span class="pre">a</span> <span class="pre">||</span> <span class="pre">b</span> <span class="pre">&amp;&amp;</span> <span class="pre">c</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">a</span> <span class="pre">||</span> <span class="pre">b</span> <span class="pre">&amp;&amp;</span> <span class="pre">c</span></code></td>
<td><code class="docutils literal"><span class="pre">a</span> <span class="pre">||</span> <span class="pre">b</span> <span class="pre">&amp;&amp;</span> <span class="pre">c</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>No more <code class="docutils literal"><span class="pre">begin</span> <span class="pre">end</span></code> construction. One must use parentheses.</li>
<li>The operators as values may be written with an backslash, but can
still be written with parentheses:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">(+)</span></code></td>
<td><code class="docutils literal"><span class="pre">\+</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">(+)</span></code></td>
<td><code class="docutils literal"><span class="pre">(+)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">(mod)</span></code></td>
<td><code class="docutils literal"><span class="pre">\mod</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">(mod)</span></code></td>
<td><code class="docutils literal"><span class="pre">(mod)</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Nested “as” patterns require parenthesis:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">function</span> <span class="pre">Some</span> <span class="pre">a</span> <span class="pre">as</span> <span class="pre">b,</span> <span class="pre">c</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">fun</span> <span class="pre">[</span> <span class="pre">((Some</span> <span class="pre">a</span> <span class="pre">as</span> <span class="pre">b),</span> <span class="pre">c)</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span> <span class="pre">]</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<blockquote>
<div>But they are not required before the right arrow:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="53%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">function</span> <span class="pre">Some</span> <span class="pre">a</span> <span class="pre">as</span> <span class="pre">b</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">fun</span> <span class="pre">[</span> <span class="pre">Some</span> <span class="pre">a</span> <span class="pre">as</span> <span class="pre">b</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...]</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The operators with special characters are not automatically
infix. To define infixes, use syntax extensions.</li>
</ul>
</div>
</div>
<div class="section" id="types-and-constructors">
<h3>Types and Constructors<a class="headerlink" href="#types-and-constructors" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The type constructors are before their type parameters, which are
curryfied:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">int</span> <span class="pre">list</span></code></td>
<td><code class="docutils literal"><span class="pre">list</span> <span class="pre">int</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">('a,</span> <span class="pre">bool)</span> <span class="pre">Hashtbl.t</span></code></td>
<td><code class="docutils literal"><span class="pre">Hashtbl.t</span> <span class="pre">'a</span> <span class="pre">bool</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">'a</span> <span class="pre">foo</span> <span class="pre">=</span> <span class="pre">'a</span> <span class="pre">list</span> <span class="pre">list</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">foo</span> <span class="pre">'a</span> <span class="pre">=</span> <span class="pre">list</span> <span class="pre">(list</span> <span class="pre">'a)</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The abstract types are represented by an unbound type variable:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">'a</span> <span class="pre">foo;;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">foo</span> <span class="pre">'a</span> <span class="pre">=</span> <span class="pre">'b;</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">bar;;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">bar</span> <span class="pre">=</span> <span class="pre">'a;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Parentheses are required in tuples of types:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">int</span> <span class="pre">*</span> <span class="pre">bool</span></code></td>
<td><code class="docutils literal"><span class="pre">(int</span> <span class="pre">*</span> <span class="pre">bool)</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>In declarations of a concrete type, brackets must enclose the
constructor declarations:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">of</span> <span class="pre">i</span> <span class="pre">|</span> <span class="pre">B;;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[</span> <span class="pre">A</span> <span class="pre">of</span> <span class="pre">i</span> <span class="pre">|</span> <span class="pre">B</span> <span class="pre">];</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>It is possible to make the empty type, without constructor:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">foo</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>
</div>
<ul>
<li><p class="first">There is a syntax difference between data constructors with several
parameters and data constructors with one parameter of type tuple:</p>
<p>The declaration of a data constructor with several parameters is
done by separating the types with “and”. In expressions and
patterns, these constructor parameters must be curryfied:</p>
</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">C</span> <span class="pre">of</span> <span class="pre">t1</span> <span class="pre">*</span> <span class="pre">t2;;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[</span> <span class="pre">C</span> <span class="pre">of</span> <span class="pre">t1</span> <span class="pre">and</span> <span class="pre">t2</span> <span class="pre">];</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">C</span> <span class="pre">(x,</span> <span class="pre">y);;</span></code></td>
<td><code class="docutils literal"><span class="pre">C</span> <span class="pre">x</span> <span class="pre">y;</span></code></td>
</tr>
</tbody>
</table>
<blockquote>
<div>The declaration of a data constructor with one parameter of type
tuple is done by using a tuple type. In expressions and patterns,
the parameter must not to be curryfied, since it is alone. In that
case the syntax of constructor parameters is the same between the
two syntaxes:</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">D</span> <span class="pre">of</span> <span class="pre">(t1</span> <span class="pre">*</span> <span class="pre">t2);;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[</span> <span class="pre">D</span> <span class="pre">of</span> <span class="pre">(t1</span> <span class="pre">*</span> <span class="pre">t2)</span> <span class="pre">];</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">D</span> <span class="pre">(x,</span> <span class="pre">y);;</span></code></td>
<td><code class="docutils literal"><span class="pre">D</span> <span class="pre">(x,</span> <span class="pre">y);</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The bool constructors start with an uppercase letter. The
identifiers “true” and “false” are not keywords:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">true</span> <span class="pre">&amp;amp;&amp;amp;</span> <span class="pre">false</span></code></td>
<td><code class="docutils literal"><span class="pre">True</span> <span class="pre">&amp;amp;&amp;amp;</span> <span class="pre">False</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>In record types, the keyword “mutable” must appear after the colon:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">{mutable</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">t1};;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">{x</span> <span class="pre">:</span> <span class="pre">mutable</span> <span class="pre">t1};</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Manifest types are with “==”:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">'a</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">'a</span> <span class="pre">option</span> <span class="pre">=</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">None</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">|</span> <span class="pre">Some</span> <span class="pre">of</span> <span class="pre">'a</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">'a</span> <span class="pre">=</span> <span class="pre">option</span> <span class="pre">'a</span> <span class="pre">==</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[</span> <span class="pre">None</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">|</span> <span class="pre">Some</span> <span class="pre">of</span> <span class="pre">'a</span> <span class="pre">]</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Polymorphic types start with <code class="docutils literal"><span class="pre">!</span></code>:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">{</span> <span class="pre">f</span> <span class="pre">:</span> <span class="pre">'a</span> <span class="pre">.</span> <span class="pre">'a</span> <span class="pre">list</span> <span class="pre">}</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">{</span> <span class="pre">f</span> <span class="pre">:</span> <span class="pre">!</span> <span class="pre">'a</span> <span class="pre">.</span> <span class="pre">list</span> <span class="pre">'a</span> <span class="pre">}</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="streams-and-parsers">
<h3>Streams and Parsers<a class="headerlink" href="#streams-and-parsers" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The streams and the stream patterns are bracketed with <code class="docutils literal"><span class="pre">[:</span></code> and
<code class="docutils literal"><span class="pre">:]</span></code> instead of <code class="docutils literal"><span class="pre">[&lt;</span></code> and <code class="docutils literal"><span class="pre">&gt;]</span></code>.</li>
<li>The stream component “terminal” is written with a back-quote instead
of a quote:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[&lt;</span> <span class="pre">'1;</span> <span class="pre">'2;</span> <span class="pre">s;</span> <span class="pre">'3</span> <span class="pre">&gt;]</span></code></td>
<td><code class="docutils literal"><span class="pre">[:</span> <span class="pre">`1;</span> <span class="pre">`2;</span> <span class="pre">s;</span> <span class="pre">`3</span> <span class="pre">:]</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The cases of parsers are bracketed with <code class="docutils literal"><span class="pre">[</span></code> and <code class="docutils literal"><span class="pre">]</span></code>, as with
“fun”, “match” and “try”. If there is one case, the brackets are not
required:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="55%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">&amp;nbsp;&amp;nbsp;[&lt;</span> <span class="pre">'Foo</span> <span class="pre">&gt;]</span> <span class="pre">-&gt;</span> <span class="pre">e</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">|</span> <span class="pre">[&lt;</span> <span class="pre">p</span> <span class="pre">=</span> <span class="pre">f</span> <span class="pre">&gt;]</span> <span class="pre">-&gt;</span> <span class="pre">f;;</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[</span> <span class="pre">[:</span> <span class="pre">`Foo</span> <span class="pre">:]</span> <span class="pre">-&gt;</span> <span class="pre">e</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">|</span> <span class="pre">[:</span> <span class="pre">p</span> <span class="pre">=</span> <span class="pre">f</span> <span class="pre">:]</span> <span class="pre">-&gt;</span> <span class="pre">f</span> <span class="pre">];</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span> <span class="pre">[&lt;</span> <span class="pre">'x</span> <span class="pre">&gt;]</span> <span class="pre">-&gt;</span> <span class="pre">x;;</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span> <span class="pre">[:</span> <span class="pre">`x</span> <span class="pre">:]</span> <span class="pre">-&gt;</span> <span class="pre">x;</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>It is possible to write the empty parser raising the exception
“Stream.Failure” whatever parameter is applied, and the empty stream
matching always raising “Stream.Failure”:</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">parser</span> <span class="p">[]</span>
<span class="n">match</span> <span class="n">e</span> <span class="k">with</span> <span class="n">parser</span> <span class="p">[]</span>
</pre></div>
</div>
<ul class="simple">
<li>In normal syntax, the error indicator starts with a double question
mark, in revised syntax with a simple question mark:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[&lt;</span> <span class="pre">'1;</span> <span class="pre">'2</span> <span class="pre">??</span> <span class="pre">&quot;error&quot;</span> <span class="pre">&gt;]</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[:</span> <span class="pre">`1;</span> <span class="pre">`2</span> <span class="pre">?</span> <span class="pre">&quot;error&quot;</span> <span class="pre">:]</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>In normal syntax, the component optimization starts with <code class="docutils literal"><span class="pre">?!</span></code>, in
revised syntax with <code class="docutils literal"><span class="pre">!</span></code>:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[&lt;</span> <span class="pre">'1;</span> <span class="pre">'2</span> <span class="pre">?!</span> <span class="pre">&gt;]</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">parser</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">[:</span> <span class="pre">`1;</span> <span class="pre">`2</span> <span class="pre">!</span> <span class="pre">:]</span> <span class="pre">-&gt;</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="classes-and-objects">
<h3>Classes and Objects<a class="headerlink" href="#classes-and-objects" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Object items end with a single semicolon which is required.</li>
<li>Class type parameters follow the class identifier:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">class</span> <span class="pre">['a,</span> <span class="pre">'b]</span> <span class="pre">point</span> <span class="pre">=</span> <span class="pre">...</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">point</span> <span class="pre">['a,</span> <span class="pre">'b]</span> <span class="pre">=</span> <span class="pre">...</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">class</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">[int]</span> <span class="pre">color;;</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">c</span> <span class="pre">=</span> <span class="pre">color</span> <span class="pre">[int];</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>In the type of class with parameters, the type of the parameters are
between brackets. Example in signature:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="49%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">class</span> <span class="pre">c</span> <span class="pre">:</span> <span class="pre">int</span> <span class="pre">-&gt;</span> <span class="pre">point;;</span></code></td>
<td><code class="docutils literal"><span class="pre">class</span> <span class="pre">c</span> <span class="pre">:</span> <span class="pre">[int]</span> <span class="pre">-&gt;</span> <span class="pre">point;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The keywords “virtual” and “private” must be in this order:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">private</span> <span class="pre">m</span> <span class="pre">:</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">private</span> <span class="pre">m</span> <span class="pre">:</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">method</span> <span class="pre">private</span> <span class="pre">virtual</span> <span class="pre">m</span> <span class="pre">:</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
<td><div class="first last line-block">
<div class="line"><code class="docutils literal"><span class="pre">method</span> <span class="pre">virtual</span> <span class="pre">private</span> <span class="pre">m</span> <span class="pre">:</span></code></div>
<div class="line"><code class="docutils literal"><span class="pre">...</span></code></div>
</div>
</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Object variables are introduced with “value” instead of “val”:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">object</span> <span class="pre">val</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">3</span> <span class="pre">end</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">value</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">3;</span> <span class="pre">end</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Type constraints in objects are introduced with “type” instead of
“constraint”:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">object</span> <span class="pre">constraint</span> <span class="pre">'a</span> <span class="pre">=</span> <span class="pre">int</span> <span class="pre">end</span></code></td>
<td><code class="docutils literal"><span class="pre">object</span> <span class="pre">type</span> <span class="pre">'a</span> <span class="pre">=</span> <span class="pre">int;</span> <span class="pre">end</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="labels-and-variants">
<h3>Labels and Variants<a class="headerlink" href="#labels-and-variants" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Labels in types must start with <code class="docutils literal"><span class="pre">~</span></code>:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">val</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">num:int</span> <span class="pre">-&gt;</span> <span class="pre">bool;;</span></code></td>
<td><code class="docutils literal"><span class="pre">value</span> <span class="pre">x</span> <span class="pre">:</span> <span class="pre">~num:int</span> <span class="pre">-&gt;</span> <span class="pre">bool;</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>Types whose number of variants are fixed start with <code class="docutils literal"><span class="pre">[</span> <span class="pre">=</span></code>:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="48%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[`On</span> <span class="pre">|</span> <span class="pre">`Off];;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[</span> <span class="pre">=</span> <span class="pre">`On</span> <span class="pre">|</span> <span class="pre">`Off];</span></code></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The <code class="docutils literal"><span class="pre">[</span></code> and the <code class="docutils literal"><span class="pre">&lt;</span></code> in variant types must not be sticked:</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Revised</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[&lt;</span> <span class="pre">`Foo</span> <span class="pre">|</span> <span class="pre">`Bar</span> <span class="pre">];;</span></code></td>
<td><code class="docutils literal"><span class="pre">type</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">[</span> <span class="pre">&lt;</span> <span class="pre">`Foo</span> <span class="pre">|</span> <span class="pre">`Bar</span> <span class="pre">];</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="scheme-and-lisp-syntaxes">
<span id="scheme"></span><h2>Scheme and Lisp syntaxes<a class="headerlink" href="#scheme-and-lisp-syntaxes" title="Permalink to this headline">¶</a></h2>
<p>It is possible to write OCaml programs with Scheme or Lisp
syntax. They are close to one another, both using parentheses
to identify and separate statements.</p>
<div class="section" id="common">
<h3>Common<a class="headerlink" href="#common" title="Permalink to this headline">¶</a></h3>
<p>The syntax extension kits are named <code class="docutils literal"><span class="pre">pa_scheme.cmo</span></code> and
<code class="docutils literal"><span class="pre">pa_lisp.cmo</span></code>. The sources (same names ending with “.ml”
in the Camlp5 sources), are written in their own syntax. They are
boostrapped thanks to the versions being written in revised syntax and to
the Camlp5 pretty printing system.</p>
<p>In the OCaml toplevel, it is possible to use them by loading
<code class="docutils literal"><span class="pre">camlp5r.cma</span></code> first, then <code class="docutils literal"><span class="pre">pa_lisp.cmo</span></code> or
<code class="docutils literal"><span class="pre">pa_scheme.cmo</span></code> after:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocaml</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="n">camlp5r</span><span class="o">.</span><span class="n">cma</span> <span class="n">pa_scheme</span><span class="o">.</span><span class="n">cmo</span>
        <span class="n">Objective</span> <span class="n">Caml</span> <span class="n">version</span> <span class="o">...</span>

        <span class="n">Camlp5</span> <span class="n">Parsing</span> <span class="n">version</span> <span class="o">...</span>

<span class="c1"># (let ((x 3)) (* 3 x))</span>
<span class="o">-</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span>
<span class="c1"># (values 3 4 5)</span>
<span class="o">-</span> <span class="p">:</span> <span class="p">(</span><span class="nb">int</span> <span class="o">*</span> <span class="nb">int</span> <span class="o">*</span> <span class="nb">int</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">ocaml</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="n">camlp5r</span><span class="o">.</span><span class="n">cma</span> <span class="n">pa_lisp</span><span class="o">.</span><span class="n">cmo</span>
        <span class="n">Objective</span> <span class="n">Caml</span> <span class="n">version</span> <span class="o">...</span>

        <span class="n">Camlp5</span> <span class="n">Parsing</span> <span class="n">version</span> <span class="o">...</span>

<span class="c1"># (let ((x 3)) (* 3 x))</span>
<span class="o">-</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span>
<span class="c1"># (, 3 4 5)</span>
<span class="o">-</span> <span class="p">:</span> <span class="p">(</span><span class="nb">int</span> <span class="o">*</span> <span class="nb">int</span> <span class="o">*</span> <span class="nb">int</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>The grammar of Scheme and Lisp are relatively simple, just reading
s-expressions. The syntax tree nodes are created in the semantic
actions. Because of this, these grammars are hardly extensible.</p>
<p>However, the syntax extension EXTEND (<code class="docutils literal"><span class="pre">pa_extend.cmo</span></code> in
&lt;a href=”grammars.html”&gt;extensible grammars&lt;/a&gt;) works for them:
only the semantic actions need be written with the Scheme or Lisp
syntax. Stream parsers are also implemented.</p>
<p>Warning: these syntaxes are incomplete, but can be completed, if
Camlp5 users are insterested.</p>
</div>
<div class="section" id="scheme-syntax">
<h3>Scheme syntax<a class="headerlink" href="#scheme-syntax" title="Permalink to this headline">¶</a></h3>
<p>Some examples are given to show the principles:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Scheme</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42;;</span></code></td>
<td><code class="docutils literal"><span class="pre">(define</span> <span class="pre">x</span>&#160; <span class="pre">42)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">f</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">0;;</span></code></td>
<td><code class="docutils literal"><span class="pre">(define</span> <span class="pre">(f</span> <span class="pre">x)</span> <span class="pre">0)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">rec</span> <span class="pre">f</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">0;;</span></code></td>
<td><code class="docutils literal"><span class="pre">(definerec</span> <span class="pre">(f</span> <span class="pre">x</span> <span class="pre">y)</span> <span class="pre">0)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42</span> <span class="pre">and</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">27</span> <span class="pre">in</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y;;&amp;nbsp;&amp;nbsp;</span></code></td>
<td><code class="docutils literal"><span class="pre">(let</span> <span class="pre">((x</span> <span class="pre">42)</span> <span class="pre">(y</span> <span class="pre">27))</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">y))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42</span> <span class="pre">in</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">27</span> <span class="pre">in</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y;;&amp;nbsp;&amp;nbsp;</span></code></td>
<td><code class="docutils literal"><span class="pre">(let*</span> <span class="pre">((x</span> <span class="pre">42)</span> <span class="pre">(y</span> <span class="pre">27))</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">y))</span></code></td>
</tr>
<tr class="row-odd"><td><a href="#id35"><span class="problematic" id="id36">``</span></a>module M = struct … end;; ``</td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">M</span> <span class="pre">(struct</span> <span class="pre">...))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">'a</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">of</span> <span class="pre">'a</span> <span class="pre">*</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">B</span></code></td>
<td><code class="docutils literal"><span class="pre">(type</span> <span class="pre">(t</span> <span class="pre">'a)</span> <span class="pre">(sum</span> <span class="pre">(A</span> <span class="pre">'a</span> <span class="pre">int)</span> <span class="pre">(B)))</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">-&gt;</span> <span class="pre">x</span></code></td>
<td><code class="docutils literal"><span class="pre">(lambda</span> <span class="pre">(x</span> <span class="pre">y)</span> <span class="pre">x)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x;</span> <span class="pre">y;</span> <span class="pre">z</span></code></td>
<td><code class="docutils literal"><span class="pre">(begin</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">f</span> <span class="pre">x</span> <span class="pre">y</span></code></td>
<td><code class="docutils literal"><span class="pre">(f</span> <span class="pre">x</span> <span class="pre">y)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[1;</span> <span class="pre">2;</span> <span class="pre">3]</span></code></td>
<td><code class="docutils literal"><span class="pre">[1</span> <span class="pre">2</span> <span class="pre">3]</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">::</span> <span class="pre">y</span> <span class="pre">::</span> <span class="pre">z</span> <span class="pre">::</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">[x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">::</span> <span class="pre">t]</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span></code></td>
<td><code class="docutils literal"><span class="pre">(values</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">match</span> <span class="pre">x</span> <span class="pre">with</span> <span class="pre">'A'..'Z'</span> <span class="pre">-&gt;</span> <span class="pre">&quot;x&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">(match</span> <span class="pre">x</span> <span class="pre">((range</span> <span class="pre">'A'</span> <span class="pre">'Z')</span> <span class="pre">&quot;x&quot;)))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{x</span> <span class="pre">=</span> <span class="pre">y;</span> <span class="pre">z</span> <span class="pre">=</span> <span class="pre">t}</span></code></td>
<td><code class="docutils literal"><span class="pre">{(x</span> <span class="pre">y)</span> <span class="pre">(z</span> <span class="pre">t)}</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="lisp-syntax">
<h3>Lisp syntax<a class="headerlink" href="#lisp-syntax" title="Permalink to this headline">¶</a></h3>
<p>The same examples:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ocaml</th>
<th class="head">Lisp</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42;;</span></code></td>
<td><code class="docutils literal"><span class="pre">(value</span> <span class="pre">x</span>&#160; <span class="pre">42)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">f</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">0;;</span></code></td>
<td><code class="docutils literal"><span class="pre">(value</span> <span class="pre">f</span> <span class="pre">(lambda</span> <span class="pre">x</span> <span class="pre">0))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">rec</span> <span class="pre">f</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">0;;</span></code></td>
<td><code class="docutils literal"><span class="pre">(value</span> <span class="pre">rec</span> <span class="pre">f</span> <span class="pre">(lambda</span> <span class="pre">(x</span> <span class="pre">y)</span> <span class="pre">0))</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42</span> <span class="pre">and</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">27</span> <span class="pre">in</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y;;&amp;nbsp;&amp;nbsp;</span></code></td>
<td><code class="docutils literal"><span class="pre">(let</span> <span class="pre">((x</span> <span class="pre">42)</span> <span class="pre">(y</span> <span class="pre">27))</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">y))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">let</span> <span class="pre">x</span> <span class="pre">=</span> <span class="pre">42</span> <span class="pre">in</span> <span class="pre">let</span> <span class="pre">y</span> <span class="pre">=</span> <span class="pre">27</span> <span class="pre">in</span> <span class="pre">x</span> <span class="pre">+</span> <span class="pre">y;;&amp;nbsp;&amp;nbsp;</span></code></td>
<td><code class="docutils literal"><span class="pre">(let*</span> <span class="pre">((x</span> <span class="pre">42)</span> <span class="pre">(y</span> <span class="pre">27))</span> <span class="pre">(+</span> <span class="pre">x</span> <span class="pre">y))</span></code></td>
</tr>
<tr class="row-odd"><td><a href="#id37"><span class="problematic" id="id38">``</span></a>module M = struct … end;; ``</td>
<td><code class="docutils literal"><span class="pre">(module</span> <span class="pre">M</span> <span class="pre">(struct</span> <span class="pre">...))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">type</span> <span class="pre">'a</span> <span class="pre">t</span> <span class="pre">=</span> <span class="pre">A</span> <span class="pre">of</span> <span class="pre">'a</span> <span class="pre">*</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">B</span></code></td>
<td><code class="docutils literal"><span class="pre">(type</span> <span class="pre">(t</span> <span class="pre">'a)</span> <span class="pre">(sum</span> <span class="pre">(A</span> <span class="pre">'a</span> <span class="pre">int)</span> <span class="pre">(B)))</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fun</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">-&gt;</span> <span class="pre">x</span></code></td>
<td><code class="docutils literal"><span class="pre">(lambda</span> <span class="pre">(x</span> <span class="pre">y)</span> <span class="pre">x)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">x;</span> <span class="pre">y;</span> <span class="pre">z</span></code></td>
<td><code class="docutils literal"><span class="pre">(progn</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">f</span> <span class="pre">x</span> <span class="pre">y</span></code></td>
<td><code class="docutils literal"><span class="pre">(f</span> <span class="pre">x</span> <span class="pre">y)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">[1;</span> <span class="pre">2;</span> <span class="pre">3]</span></code></td>
<td><code class="docutils literal"><span class="pre">(list</span> <span class="pre">1</span> <span class="pre">2</span> <span class="pre">3)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">x</span> <span class="pre">::</span> <span class="pre">y</span> <span class="pre">::</span> <span class="pre">z</span> <span class="pre">::</span> <span class="pre">t</span></code></td>
<td><code class="docutils literal"><span class="pre">(list</span> <span class="pre">x</span> <span class="pre">y</span> <span class="pre">z</span> <span class="pre">::</span> <span class="pre">t)</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span></code></td>
<td><code class="docutils literal"><span class="pre">(,</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c)</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">match</span> <span class="pre">x</span> <span class="pre">with</span> <span class="pre">'A'..'Z'</span> <span class="pre">-&gt;</span> <span class="pre">&quot;x&quot;</span></code></td>
<td><code class="docutils literal"><span class="pre">(match</span> <span class="pre">x</span> <span class="pre">((range</span> <span class="pre">'A'</span> <span class="pre">'Z')</span> <span class="pre">&quot;x&quot;)))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">{x</span> <span class="pre">=</span> <span class="pre">y;</span> <span class="pre">z</span> <span class="pre">=</span> <span class="pre">t}</span></code></td>
<td><code class="docutils literal"><span class="pre">({}</span> <span class="pre">(x</span> <span class="pre">y)</span> <span class="pre">(z</span> <span class="pre">t))</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="macros">
<span id="id39"></span><h2>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h2>
<p>Camlp5 provides a system of macros, added by the parsing kit
<code class="docutils literal"><span class="pre">pa_macro.cmo</span></code>. Macros are values evaluated at parsing
time.</p>
<p>When loaded, the parsing kit extends the syntax of the language and
adds command options.</p>
<div class="section" id="added-syntax">
<h3>Added syntax<a class="headerlink" href="#added-syntax" title="Permalink to this headline">¶</a></h3>
<p>The parsing kit <code class="docutils literal"><span class="pre">pa_macro.cmo</span></code> extends the structure items
(= toplevel phrases), the expressions and the patterns by the
following grammar rules:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>          str-item ::= str-macro-def
          sig-item ::= sig-macro-def
              expr ::= macro-expr
              patt ::= macro-patt
         cons-decl ::= macro-cons-decl
      rec-lab-decl ::= macro-rec-lab-decl
       match-assoc ::= macro-match-assoc
     str_macro-def ::= &quot;DEFINE&quot; uident
                     | &quot;DEFINE&quot; uident &quot;=&quot; expr
                     | &quot;DEFINE&quot; uident params &quot;=&quot; expr
                     | &quot;UNDEF&quot; uident
                     | &quot;IFDEF&quot; dexpr &quot;THEN&quot; st-or-mac else-str &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; st-or-mac else-str &quot;END&quot;
          else-str ::= &quot;ELSIFDEF&quot; dexpr &quot;THEN&quot; st-or-mac else-str
                     | &quot;ELSIFNDEF&quot; dexpr &quot;THEN&quot; st-or-mac else-str
                     | &quot;ELSE&quot; st-or-mac else-str
                     | &lt;nothing&gt;
     sig_macro-def ::= &quot;DEFINE&quot; uident
                     | &quot;DEFINE&quot; uident params &quot;=&quot; type
                     | &quot;UNDEF&quot; uident
                     | &quot;IFDEF&quot; dexpr &quot;THEN&quot; sg-or-mac else-sig &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; sg-or-mac else-sig &quot;END&quot;
          else-sig ::= &quot;ELSIFDEF&quot; dexpr &quot;THEN&quot; sg-or-mac else-sig
                     | &quot;ELSIFNDEF&quot; dexpr &quot;THEN&quot; sg-or-mac else-sig
                     | &quot;ELSE&quot; st-or-mac else-sig
                     | &lt;nothing&gt;
        macro-expr ::= &quot;IFDEF&quot; dexpr &quot;THEN&quot; expr else-expr &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; expr else-expr &quot;END&quot;
                     | &quot;__FILE__&quot;
                     | &quot;__LOCATION__&quot;
         else-expr ::= &quot;ELSIFDEF&quot; dexpr &quot;THEN&quot; expr else-expr
                     | &quot;ELSIFNDEF&quot; dexpr &quot;THEN&quot; expr else-expr
                     | &quot;ELSE&quot; expr else-expr
        macro-patt ::= &quot;IFDEF&quot; dexpr &quot;THEN&quot; patt &quot;ELSE&quot; patt &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; patt &quot;ELSE&quot; patt &quot;END&quot;
   macro-cons-decl ::= &quot;IFDEF&quot; dexpr &quot;THEN&quot; cons-decl &quot;END&quot;
                     | &quot;IFDEF&quot; dexpr &quot;THEN&quot; cons-decl
                       &quot;ELSE&quot; cons-decl &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; cons-decl &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; cons-decl
                       &quot;ELSE&quot; cons-decl &quot;END&quot;
macro-rec-lab-decl ::= &quot;IFDEF&quot; dexpr &quot;THEN&quot; rec-lab-decl &quot;END&quot;
                     | &quot;IFDEF&quot; dexpr &quot;THEN&quot; rec-lab-decl
                       &quot;ELSE&quot; rec-lab-decl &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; rec-lab-decl &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; rec-lab-decl
                       &quot;ELSE&quot; rec-lab-decl &quot;END&quot;
 macro-match-assoc ::= &quot;IFDEF&quot; dexpr &quot;THEN&quot; match_assoc &quot;END&quot;
                     | &quot;IFDEF&quot; dexpr &quot;THEN&quot; match-assoc
                       &quot;ELSE&quot; match-assoc &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; match-assoc &quot;END&quot;
                     | &quot;IFNDEF&quot; dexpr &quot;THEN&quot; match-assoc
                       &quot;ELSE&quot; match-assoc &quot;END&quot;
         st-or-mac ::= str_macro-def
                     | structure
         sg-or-mac ::= sig-macro-def
                     | signature
            params ::= ident params
                     | ident
             dexpr ::= dexpr &quot;OR&quot; dexpr
                     | dexpr &quot;AND&quot; dexpr
                     | &quot;NOT&quot; dexpr
                     | uident
                     | &quot;(&quot; dexpr &quot;)&quot;
            uident ::= &#39;A&#39;-&#39;Z&#39; ident
             ident ::= ident-char*
        ident-char ::= (&#39;a&#39;-&#39;a&#39; | &#39;A&#39;-&#39;Z&#39; | &#39;0&#39;-&#39;9&#39; | &#39;_&#39; | &#39;&#39;&#39; |
                        misc-byte)
         misc-byte ::= &#39;\128&#39;-&#39;\255&#39;
</pre></div>
</div>
<p>When a macro has been defined, as name e.g. “NAME”, the expressions
and patterns are extended this way:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>      <span class="n">expr</span> <span class="p">::</span><span class="o">=</span> <span class="s2">&quot;NAME&quot;</span>
             <span class="o">|</span> <span class="s2">&quot;NAME&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="n">expr</span><span class="o">-</span><span class="n">params</span> <span class="s2">&quot;)&quot;</span>
      <span class="n">patt</span> <span class="p">::</span><span class="o">=</span> <span class="s2">&quot;NAME&quot;</span>
             <span class="o">|</span> <span class="s2">&quot;NAME&quot;</span> <span class="s2">&quot;(&quot;</span> <span class="n">patt</span><span class="o">-</span><span class="n">params</span> <span class="s2">&quot;)&quot;</span>
<span class="n">expr</span><span class="o">-</span><span class="n">params</span> <span class="p">:</span><span class="o">=</span> <span class="n">expr</span> <span class="s2">&quot;,&quot;</span> <span class="n">expr</span><span class="o">-</span><span class="n">params</span>
             <span class="o">|</span> <span class="n">expr</span>
<span class="n">patt</span><span class="o">-</span><span class="n">params</span> <span class="p">:</span><span class="o">=</span> <span class="n">patt</span> <span class="s2">&quot;,&quot;</span> <span class="n">patt</span><span class="o">-</span><span class="n">params</span>
             <span class="o">|</span> <span class="n">patt</span>
</pre></div>
</div>
<p>Notice that the identifiers <code class="docutils literal"><span class="pre">DEFINE</span></code>, <code class="docutils literal"><span class="pre">UNDEF</span></code>,
<code class="docutils literal"><span class="pre">IFDEF</span></code>, <code class="docutils literal"><span class="pre">IFNDEF</span></code>, <code class="docutils literal"><span class="pre">ELSE</span></code>,
<code class="docutils literal"><span class="pre">END</span></code>, <code class="docutils literal"><span class="pre">OR</span></code>, <code class="docutils literal"><span class="pre">AND</span></code> and <code class="docutils literal"><span class="pre">NOT</span></code> are
new keywords (they cannot be used as identifiers of constructors or
modules.</p>
<p>However, the identifiers <code class="docutils literal"><span class="pre">__FILE__</span></code> and
<code class="docutils literal"><span class="pre">__LOCATION__</span></code> and the new defined macro names are not new
identifiers.</p>
</div>
<div class="section" id="added-command-options">
<h3>Added command options<a class="headerlink" href="#added-command-options" title="Permalink to this headline">¶</a></h3>
<p>The parsing kit <code class="docutils literal"><span class="pre">pa_macro.cmo</span></code> also add two options usable
in all Camlp5 commands:</p>
<ul class="simple">
<li>Define the uident in question like would have been a DEFINE (without
parameter) in the code.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">D</span> <span class="n">uident</span>
</pre></div>
</div>
<ul class="simple">
<li>Undefine the uident in question like would have been a UNDEF in the
code.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">U</span> <span class="n">uident</span>
</pre></div>
</div>
<ul class="simple">
<li>Print the defined macros and exit.</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">-</span><span class="n">defined</span>
</pre></div>
</div>
</div>
<div class="section" id="semantics">
<h3>Semantics<a class="headerlink" href="#semantics" title="Permalink to this headline">¶</a></h3>
<p>The statement <code class="docutils literal"><span class="pre">DEFINE</span></code> defines a new macro with optional
parameters and an optional value. The macro name must start with an
uppercase letter.</p>
<p>The test of a macro can be done either:</p>
<ul class="simple">
<li>in structure items</li>
<li>in signature items</li>
<li>in expressions</li>
<li>in patterns</li>
<li>in a constructor declaration</li>
<li>in a match case</li>
</ul>
<p>using the statement <code class="docutils literal"><span class="pre">IFDEF</span></code>. Its non-existence can be
tested by <code class="docutils literal"><span class="pre">IFNDEF</span></code>.  In expressions and patterns, the
<code class="docutils literal"><span class="pre">ELSE</span></code> part is required, not in structure items.</p>
<p>The expression behind the <code class="docutils literal"><span class="pre">IFDEF</span></code> or the <code class="docutils literal"><span class="pre">IFNDEF</span></code>
statement may use the operators <code class="docutils literal"><span class="pre">OR</span></code>, <code class="docutils literal"><span class="pre">AND</span></code> and
<code class="docutils literal"><span class="pre">NOT</span></code> and contain parentheses.</p>
<p>Notice that in an <code class="docutils literal"><span class="pre">IFDEF</span></code> where the value is True
(resp. False), the <code class="docutils literal"><span class="pre">ELSE</span></code> (resp <code class="docutils literal"><span class="pre">THEN</span></code>) part does
not need to be semantically correct (well typed), since it does not
appear in the resulting syntax tree. Same for <code class="docutils literal"><span class="pre">IFNDEF</span></code> and
for possible macros parameters which are not used in the
associated expression.</p>
<p>If a macro is defined twice, its first version is lost.</p>
<p>The statement <code class="docutils literal"><span class="pre">UNDEF</span></code> removes a macro definition.</p>
<p>When associated with a value, the <code class="docutils literal"><span class="pre">DEFINE</span></code> macro acts like
a variable (or like a function call if it has parameters), except that
the parameters are evaluated at parse time and can also be used also
in pattern positions. Notice that this is a way to define constants
by name in patterns. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DEFINE</span> <span class="n">WW1</span> <span class="o">=</span> <span class="mi">1914</span><span class="p">;</span>
<span class="n">DEFINE</span> <span class="n">WW2</span> <span class="o">=</span> <span class="mi">1939</span><span class="p">;</span>
<span class="n">value</span> <span class="n">war_or_year</span> <span class="o">=</span>
  <span class="n">fun</span>
  <span class="p">[</span> <span class="n">WW1</span> <span class="o">-&gt;</span> <span class="s2">&quot;world war I&quot;</span>
  <span class="o">|</span> <span class="n">WW2</span> <span class="o">-&gt;</span> <span class="s2">&quot;world war II&quot;</span>
  <span class="o">|</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="s2">&quot;not a war&quot;</span> <span class="p">]</span>
<span class="p">;</span>
</pre></div>
</div>
<p>In the definition of a macro, if the expression contains an
evaluation, the evaluation is not done by Camlp5 but just
transmitted as code. In this case, it does not work in pattern
position. Example in the toplevel:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># DEFINE PLUS(x, y) = x + y;</span>
<span class="c1"># PLUS(3, 4);</span>
<span class="o">-</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span>
<span class="c1">#   fun [ PLUS(3, 4) -&gt; () ];</span>
<span class="n">Toplevel</span> <span class="nb">input</span><span class="p">:</span>
<span class="c1">#   fun [ PLUS(3, 4) -&gt; () ];</span>
          <span class="o">^^^^^^^^^^</span>
<span class="n">Failure</span><span class="p">:</span> <span class="n">this</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">a</span> <span class="n">constructor</span><span class="p">,</span> <span class="n">it</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">applied</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">pattern</span>
</pre></div>
</div>
<p>On the other hand, if the expression does not contain evaluation,
this is possible:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># DEFINE FOO(x, y) = (x, Some y);</span>
<span class="c1"># FOO(True, &quot;bar&quot;);</span>
<span class="o">-</span> <span class="p">:</span> <span class="p">(</span><span class="nb">bool</span> <span class="o">*</span> <span class="n">option</span> <span class="n">string</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">Some</span> <span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="c1"># fun [ FOO(_, &quot;hello&quot;) -&gt; 0 | _ -&gt; 1 ];</span>
<span class="o">-</span> <span class="p">:</span> <span class="p">(</span><span class="s1">&#39;a * option string) -&gt; int = &lt;fun&gt;</span>
</pre></div>
</div>
<p>The macro <code class="docutils literal"><span class="pre">__FILE__</span></code> is replaced by the current compiled source
file name. In the OCaml toplevel, its value is the empty string.</p>
<p>The macro <code class="docutils literal"><span class="pre">__LOCATION__</span></code> is replaced by the the current location
(two integers in number of characters from the beginning of the file,
starting at zero) of the macro itself.</p>
<p>In signatures, the macro definitions can return types which can be
used in type definitions.</p>
<p>In constructor declarations and in match cases, it is possible to
conditionally define some cases by <code class="docutils literal"><span class="pre">IFDEF</span></code> or
<code class="docutils literal"><span class="pre">IFNDEF</span></code>. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">t</span> <span class="o">=</span>
  <span class="p">[</span> <span class="n">A</span> <span class="n">of</span> <span class="nb">int</span>
  <span class="o">|</span> <span class="n">IFNDEF</span> <span class="n">FOO</span> <span class="n">THEN</span>
      <span class="n">B</span> <span class="n">of</span> <span class="n">string</span>
    <span class="n">END</span>
  <span class="o">|</span> <span class="n">C</span> <span class="n">of</span> <span class="nb">bool</span> <span class="p">]</span>
<span class="p">;</span>

<span class="n">match</span> <span class="n">x</span> <span class="k">with</span>
<span class="p">[</span> <span class="n">A</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="n">j</span>
<span class="o">|</span> <span class="n">IFNDEF</span> <span class="n">FOO</span> <span class="n">THEN</span>
    <span class="n">B</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="n">toto</span>
  <span class="n">END</span>
<span class="o">|</span> <span class="n">C</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">e</span> <span class="p">];</span>
</pre></div>
</div>
</div>
<div class="section" id="predefined-macros">
<h3>Predefined macros<a class="headerlink" href="#predefined-macros" title="Permalink to this headline">¶</a></h3>
<p>The macro <code class="docutils literal"><span class="pre">CAMLP5</span></code> is always predefined.</p>
<p>The macro <code class="docutils literal"><span class="pre">OCAML_oversion</span></code> is predefined, where
<code class="docutils literal"><span class="pre">oversion</span></code> is the OCaml version the Camlp5 program has been
compiled with, where all characters but numbers are replaced by
underscores. For example, if using OCaml 3.09.3, the macro
<code class="docutils literal"><span class="pre">OCAML_3_09_3</span></code> is defined.</p>
<p>Moreover, for <em>some</em> Camlp5 versions (and all the versions
which follows them), the macro <code class="docutils literal"><span class="pre">CAMLP5_version</span></code> is defined
where <code class="docutils literal"><span class="pre">version</span></code> is the Camlp5 version where all characters
but numbers are replaced by underscores. For example, in version
4.02, the macro <code class="docutils literal"><span class="pre">CAMLP5_4_02</span></code> had been defined and this
macro have appeared in all versions of Camlp5 since 4.02.</p>
<p>To see which macros are predefined, type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">camlp5r</span> <span class="n">pa_macro</span><span class="o">.</span><span class="n">cmo</span> <span class="o">-</span><span class="n">defined</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pragma-directive">
<span id="pragma"></span><h2>Pragma directive<a class="headerlink" href="#pragma-directive" title="Permalink to this headline">¶</a></h2>
<p>The directive <code class="docutils literal"><span class="pre">#pragma</span></code> allows to evaluate expressions
at parse time, useful, for example, to test syntax extensions by the
statement EXTEND without having to compile it in a separate file.</p>
<p>To use it, add the syntax extension <code class="docutils literal"><span class="pre">pa_pragma.cmo</span></code> in
the Camlp5 command line. It adds the ability to use this directive.</p>
<p>As an example, let’s add syntax for the statement ‘repeat’ and
use it immediately:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#pragma
  EXTEND
    GLOBAL: expr;
    expr: LEVEL &quot;top&quot;
      [ [ &quot;repeat&quot;; e1 = sequence; &quot;until&quot;; e2 = SELF -&gt;
            &lt;:expr&lt; do { $e1$; while not $e2$ do { $e1$ } } &gt;&gt; ] ]
    ;
    sequence:
      [ [ el = LIST1 expr_semi -&gt; &lt;:expr&lt; do { $list:el$ } &gt;&gt; ] ]
    ;
    expr_semi:
      [ [ e = expr; &quot;;&quot; -&gt; e ] ]
    ;
  END;

let i = ref 1 in
repeat print_int i.val; print_endline &quot;&quot;; incr i; until i.val = 10;
</pre></div>
</div>
<p>The compilation of this example (naming it “foo.ml”) can be done with
the command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">ocamlc</span> <span class="o">-</span><span class="n">pp</span> <span class="s2">&quot;camlp5r q_MLast.cmo pa_extend.cmo pa_pragma.cmo&quot;</span> <span class="o">-</span><span class="n">I</span> <span class="o">+</span><span class="n">camlp5</span> <span class="n">foo</span><span class="o">.</span><span class="n">ml</span>
</pre></div>
</div>
<p>Notice that it is still experimental and probably incomplete, for the
moment.</p>
</div>
<div class="section" id="extensible-functions">
<span id="extfun"></span><h2>Extensible functions<a class="headerlink" href="#extensible-functions" title="Permalink to this headline">¶</a></h2>
<p>Extensible functions allows the definition of pattern matching functions
which are extensible by adding new cases that are inserted
automatically at the proper place by comparing the patterns. The pattern
cases are ordered according to syntax trees representing them, “when”
statements being inserted before the cases without “when”.</p>
<p>Notice that extensible functions are functional: when extending a
function, a new function is returned.</p>
<p>The extensible functions are used in
the <a class="reference internal" href="prtools.html#pretty"><span class="std std-ref">pretty printing</span></a> system of Camlp5.</p>
<p>&lt;div id=”tableofcontents”&gt;
&lt;/div&gt;</p>
<div class="section" id="syntax">
<h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<p>The syntax of the extensible functions, when loading
“pa_extfun.cmo”, is the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>         <span class="n">expression</span> <span class="p">::</span><span class="o">=</span> <span class="n">extensible</span><span class="o">-</span><span class="n">function</span>
<span class="n">extensible</span><span class="o">-</span><span class="n">function</span> <span class="p">::</span><span class="o">=</span> <span class="s2">&quot;extfun&quot;</span> <span class="n">expression</span> <span class="s2">&quot;with&quot;</span> <span class="s2">&quot;[&quot;</span> <span class="n">match</span><span class="o">-</span><span class="n">cases</span> <span class="s2">&quot;]&quot;</span>
        <span class="n">match</span><span class="o">-</span><span class="n">cases</span> <span class="p">::</span><span class="o">=</span> <span class="n">match</span><span class="o">-</span><span class="n">case</span> <span class="s2">&quot;|&quot;</span> <span class="n">match</span><span class="o">-</span><span class="n">cases</span>
         <span class="n">match</span><span class="o">-</span><span class="n">case</span> <span class="p">::</span><span class="o">=</span> <span class="n">pattern</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="n">expression</span>
                      <span class="o">|</span> <span class="n">pattern</span> <span class="s2">&quot;when&quot;</span> <span class="n">expression</span> <span class="s2">&quot;-&gt;&quot;</span> <span class="n">expression</span>
</pre></div>
</div>
<p>It is an extension of the same syntax as the “match” and “try”
constructions.</p>
</div>
<div class="section" id="id40">
<h3>Semantics<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>The statement “extend” defined by the syntax takes an extensible
function and return another extensible function with the new match
cases inserted at the proper place within the initial extensible
function.</p>
<p>Extensible functions are of type <code class="docutils literal"><span class="pre">Extfun.t</span> <span class="pre">a</span> <span class="pre">b</span></code>, which
is an abstract type, where <code class="docutils literal"><span class="pre">a</span></code> and <code class="docutils literal"><span class="pre">b</span></code> are
respectively the type of the patterns and the type of the
expressions. It corresponds to a function of type <code class="docutils literal"><span class="pre">a</span> <span class="pre">-&gt;</span>
<span class="pre">b</span></code>.</p>
<p>The function <code class="docutils literal"><span class="pre">Extfun.apply</span></code> takes an extensible
function as parameter and returns a function which can be applied
like a normal function.</p>
<p>The value <code class="docutils literal"><span class="pre">Extfun.empty</span></code> is an empty extensible
function, of type <code class="docutils literal"><span class="pre">Extfun.t</span> <span class="pre">'a</span> <span class="pre">'b</span></code>. When applied with
<code class="docutils literal"><span class="pre">Extfun.apply</span></code> and a parameter, it raises the exception
<code class="docutils literal"><span class="pre">Extfun.Failure</span></code> whatever the parameter.</p>
<p>For debugging, it is possible to use the function
<code class="docutils literal"><span class="pre">Extfun.print</span></code> which displays the match cases of the
extensible functions. (Only the patterns are displayed in
clear text, the associated expressions are not.)</p>
<p>The match cases are inserted according to the following rules:</p>
<ul class="simple">
<li>The match cases are inserted in the order they are defined in the
syntax <code class="docutils literal"><span class="pre">extend</span></code></li>
<li>A match case pattern with “when” is inserted before a match case
pattern without “when”.</li>
<li>Two match cases patterns both with “when” or both without “when” are
inserted according to the alphabetic order of some internal syntax
tree of the patterns where bound variables names are <em>not</em> taken
into account.</li>
<li>If two match cases patterns without “when” have the same patterns
internal syntax tree, the initial one is silently removed.</li>
<li>If two match cases patterns with “when” have the same patterns
internal syntax tree, the new one is inserted before the old one.</li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="appendix.html" class="btn btn-neutral float-right" title="Appendix" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="prtools.html" class="btn btn-neutral" title="Printing tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Daniel de Rauglaudre.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'7.10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>